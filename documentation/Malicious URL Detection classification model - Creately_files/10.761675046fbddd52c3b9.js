(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{Toew:function(t,e,n){"use strict";n.r(e);var i=n("LoAr"),r=n("xpZS"),o=n("D57K"),a=n("/6pf"),s=n("5xGT"),l=n("g3Dv"),c=n("nsO7"),u=n("pN2L"),p=n("z5yO"),h=n("G2Mx"),d=n("U3QC"),f=n("QoSw"),b=n("Voii"),g=n("SBw3"),v=n("Fqp3"),y=n("vg1f"),m=n("yn08"),O=n("2m+3"),S=n("lu3Q"),x=n("elRR"),C=n("0itG"),P=n("s9Xn"),w=n("sKtG"),E=n("IGWl"),j=n("aSzn"),I=n("AouM"),T=n("Jg5f"),M=n("W/Ou"),D=n("pday"),A=n("lqvn"),k=n("flPR"),L=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.toolbarGap=10,e}return o.d(e,t),Object.defineProperty(e.prototype,"toolbar",{get:function(){return this.toolbarManager.get("shape-text-toolbar")},enumerable:!0,configurable:!0}),e.prototype.listenToChanges=function(){var t=this;return this.duringTextEdit({action:"quickhide"},{action:"quickshow"}).pipe(Object(I.a)(function(e){return t.isShowAction(e.action)?t.state.changes("TextEditorState").pipe(Object(T.a)(function(t){return t.selection?{action:"quickshow"}:{action:"quickhide"}})):Object(u.a)(e)}),Object(I.a)(function(e){return t.isShowAction(e.action)?t.duringPan({action:"quickshow"},{action:"quickhide"}).pipe(Object(M.a)(e)):Object(u.a)(e)}),Object(D.a)(1),Object(A.a)())},e.prototype.positionToolbar=function(){var t=this.state.get("TextEditorState");if(t.selection){var e=this.state.get("DiagramZoomLevel"),n=this.state.get("DiagramPan"),i=e/t.zoom,r=n.x-t.pan.x*i,o=n.y-t.pan.y*i,a=t.editorBounds.x*i+r+(t.selection.x+t.selection.width/2)*e,s=t.editorBounds.y*i+o+(t.selection.y-this.toolbarGap)*i;this.toolbar.position({x:a,y:s},"bottomcenter")}return Object(u.a)({})},e.prototype.getToolbarItems=function(){var t=this,e=this.state.get("Selected");return e.length>0?this.getTextToolbarItems(e[0]).pipe(Object(I.a)(function(e){return t.state.changes("TextEditorState").pipe(Object(T.a)(function(t){return t.styles}),Object(T.a)(function(n){return e.map(function(e){return e.data.value=void 0===n[e.data.style]?null:n[e.data.style],t.handleListData(e,n[e.data.style]),Object(c.cloneDeep)(e)})}))})):Object(u.a)([])},e.prototype.handleListData=function(t,e){if(t.data.data){var n=t.data.data;if(n.forEach(function(t){return t.selected=!1}),"object"!=typeof e||!Object(c.isEmpty)(e)){var i=n.find(function(t){return""+t.value==""+e});if(i)i.selected=!0;else{var r=n.find(function(t){return t.custom});r?(r.id=e,r.label=e,r.buttonLabel=e,r.value=e,r.selected=!0):n.push({id:e,label:e,buttonLabel:e,value:e,custom:!0,selected:!0})}}}},e.prototype.getTextToolbarItems=function(t){return this.ll.forCurrent(!1).getShapeOnce(t).pipe(Object(T.a)(function(t){return t.getContextualToolbarItemsForTextEdit()}))},e.prototype.updateShowMethod=function(t){return t},e.prototype.getUIControlType=function(t){if(!t||t===l.c.BINARY)return E.a;if(t===l.c.OPTION_LIST)return w.a;if(t===l.c.OPTION_IMAGES)return P.a;throw new Error("A contextual toolbar UI control is not available for "+t)},e=o.c([Object(k.a)()],e)}(j.a);Object.defineProperty(L,"name",{value:"ShapeTextToolbarHandler"});var F=n("2ZsA"),H=n("ujvC"),R=n("c7W3"),B=n("2zxM"),N=n("13fK"),_=n("1U5y"),G=n("wf7V"),V=n("zFpY"),Y=n("C3qL"),U=n("aSB4"),X=n("euU2"),Z=n("k0Sg"),K=n("zsv6"),z=n("dFmy"),q=n("gQst"),W=n("iUUs"),J=n("4HYP"),Q=n("mhnT"),$=n("Wpmq"),tt=n("MvFr"),et=function(t){function e(e,n,i,r){void 0===i&&(i=!0),void 0===r&&(r=!0);var o=t.call(this,e,n,i,r)||this;return o.setRelatedShape(n),o}return o.d(e,t),e}(tt.a),nt=n("LLEj"),it=n("cs9O"),rt=n("h1tj"),ot=n("d9YI"),at=n("S83/"),st=n("blAi"),lt=n("12aA"),ct=function(t){function e(n,i,r){var o=t.call(this)||this;return o.gluePointId=n,o.shapeId=i,o.model=r,o.visibilityAnimationTime=200,o.activationAnimationTime=300,o.expandedRadius=13,o.retractedRadius=6,o.radius=o.retractedRadius,o.type="defined",o._active=!1,o.subs=[],o.name=i+e.idSplitter+n,o.prepare(),o}return o.d(e,t),e.getShapeId=function(t){return t.indexOf(this.idSplitter)>-1?t.split(this.idSplitter)[0]:""},e.getGluePointId=function(t){return t.indexOf(this.idSplitter)>-1?t.split(this.idSplitter)[1]:""},e.prototype.getCursor=function(t){return{cursor:"pointer",tail:null,type:"css"}},e.prototype.prepare=function(){this.alpha=0,this.redraw(),this.drawHitArea()},e.prototype.createShape=function(){return new rt.Shape},e.prototype.drawHitArea=function(){if(!this.hitArea){var t=this.createShape();t.graphics.beginFill("white"),t.graphics.drawCircle(0,0,10),t.graphics.endFill(),t.setBounds(-5,-5,10,10),this.hitArea=t}},e.prototype.redraw=function(){this.graphics.clear(),this.graphics.beginFill("#787878"),this.graphics.drawCircle(0,0,this.radius),this.graphics.beginFill("white"),this.graphics.drawCircle(0,0,2),this.graphics.endFill()},e.prototype.show=function(){return this.getVisibilityAnimation(.7)},e.prototype.hide=function(){return this.getVisibilityAnimation(0)},e.prototype.getVisibilityAnimation=function(t){var e=this;return this.visibilityAnimation&&this.visibilityAnimation.cancel(),this.visibilityAnimation=at.a.get(this).to({alpha:t},this.visibilityAnimationTime,rt.Ease.sineOut),this.visibilityAnimation.changes().pipe(Object(d.a)({complete:function(){return e.visibilityAnimation=void 0}}),Object(lt.a)(this))},Object.defineProperty(e.prototype,"isActive",{get:function(){return this._active},enumerable:!0,configurable:!0}),e.prototype.expand=function(){return this._active?Object(ot.b)():(this._active=!0,this.getActivationAnimation(this.expandedRadius))},e.prototype.retract=function(){return this._active?(this._active=!1,this.getActivationAnimation(this.retractedRadius)):Object(ot.b)()},e.prototype.getActivationAnimation=function(t){var e=this;return this.activationAnimation&&this.activationAnimation.cancel(),this.activationAnimation=at.a.get(this).to({radius:t},this.activationAnimationTime,rt.Ease.sineOut),this.activationAnimation.changes().pipe(Object(d.a)({next:function(){return e.redraw()},complete:function(){return e.activationAnimation=void 0}}),Object(lt.a)(this))},e.prototype.setPosition=function(t){this.x=t.x,this.y=t.y},e.prototype.addSubscription=function(t){this.subs.push(t)},e.prototype.destroy=function(){for(;this.subs.length>0;)this.subs.pop().unsubscribe()},e.idSplitter="&",e}(rt.Shape),ut=function(t){function e(n,i){var r=t.call(this,e.id,n,i)||this;return r.expandedRadius=18,r}return o.d(e,t),Object.defineProperty(e,"id",{get:function(){return"SCijFyR8ijq"},enumerable:!0,configurable:!0}),e.createModel=function(){return Object.assign(new st.a,{id:this.id,x:.5,y:.5})},e.prototype.getCursor=function(t){return{cursor:"pointer",tail:null,type:"css"}},e.prototype.drawHitArea=function(){this.hitArea||(this.hitArea=this.createShape(),this.hitArea.setBounds(0,0,0,0))},e}(ct),pt=function(t){function e(e,n,i,r,o){var a=t.call(this,e,o)||this;return a.commandService=e,a.ll=n,a.random=i,a.state=r,a.vToDcoordinate=o,a}return o.d(e,t),e.prototype.initialize=function(e,n,i){var r=this,o=t.prototype.initialize.call(this,e,n,i),a=this.getShapeOver().pipe(Object(d.a)(function(t){return r.shapeOver(t)})),s=this.getAllCanvasMouseCapture().pipe(Object(d.a)(function(t){return t.stopPropagation()}),Object(p.a)(function(t){return"mousedown"===t.type}),Object(d.a)(function(t){r.state.set("MouseControlState",m.b.Normal),r.createConnector(t).subscribe()}));return Object(q.a)(o,s,a)},Object.defineProperty(e.prototype,"defaultCursor",{get:function(){return{cursor:"crosshair",tail:null,type:"css"}},enumerable:!0,configurable:!0}),e.prototype.getCursor=function(){var t=this;return this.pointerMove().pipe(Object(M.a)({x:this.interactionCanvas.getMouseX(),y:this.interactionCanvas.getMouseY()}),Object(T.a)(function(e){var n=t.getObjectsUnderPoint(e).filter(function(t){return t.parent instanceof it.a||t instanceof ct});return t.getCursorByContext(n,["editor","createConnector"])}),Object(A.a)(function(t,e){return t.cursor===e.cursor&&t.tail===e.tail}))},e.prototype.createConnector=function(t){var e=t.nativeEvent,n=e.offsetX,i=e.offsetY,r=this.random.shapeId();return this.addConnector(r,{x:n,y:i},t.target)},e.prototype.addConnector=function(t,e,n){var i=this,r={id:t,points:[o.a({},e),o.a({},e)]},a=r.points[0];return n&&this.isValidTarget(n)?this.ll.forCurrent(!1).getShapeOnce(n.name).pipe(Object(I.a)(function(t){return n instanceof ct?(a.shapeId=n.shapeId,a.gluepointId=n.gluePointId,a.gluepointLocked=!0):n&&t&&(a.shapeId=n.name,a.gluepointId=null,a.gluepointLocked=!1),i.commandService.dispatch(R.a.addConnector,r)})):this.commandService.dispatch(R.a.addConnector,r)},e.prototype.isValidTarget=function(t){return t instanceof ct||t instanceof it.a},e.prototype.getShapeOver=function(){var t=this;return this.getShapes().pipe(Object(J.a)(function(e){return Object(q.a)(Object(W.a)(e,"rollover"),Object(W.a)(e,"rollout")).pipe(Object(Q.a)(Object(W.a)(t.diagramCanvas,"childRemoved").pipe(Object(p.a)(function(t){return t.child===e}))))}),Object(T.a)(function(t){return t}))},e.prototype.shapeOver=function(t){var e="rollover"===t.type?"shapeRollOver":"shapeRollOut";this.interactionCanvas.dispatchEvent(new et(e,t))},e}(nt.a);Object.defineProperty(pt,"name",{value:"ConnectorInteractionHandler"});var ht,dt={cursors:{rotate:'<svg xmlns="http://www.w3.org/2000/svg" width="16.83" height="15" ><title>cursors-tails</title><path d="M16.83,7.5A7.51,7.51,0,0,1,9.33,15a1,1,0,1,1,0-2A5.5,5.5,0,1,0,4.25,5.4l2.69,1c.26.09.34.34.16.45L2.39,9.51a.44.44,0,0,1-.57-.21L0,4.2C-.06,4,.17,3.87.42,4l2,.73A7.5,7.5,0,0,1,16.83,7.5Z"/></svg>',selectable:'<svg xmlns="http://www.w3.org/2000/svg" data-ox="8.5" data-oy="8.5" width="17.41" height="24.69" ><title>cursors-tails</title><circle cx="8.56" cy="8.56" r="2.03" style="fill:rgb(198,198,198)"/><polygon points="17.41 17.58 8.56 8.56 8.56 21.19 11.31 18.81 13.71 24.69 16.18 23.67 13.78 17.8 17.41 17.58"/><path d="M6.67,16.89H6.55A8.56,8.56,0,1,1,17.12,8.56a8.45,8.45,0,0,1-1.81,5.26.5.5,0,1,1-.79-.62,7.44,7.44,0,0,0,1.6-4.64A7.56,7.56,0,1,0,6.78,15.9a.5.5,0,0,1,.37.61A.49.49,0,0,1,6.67,16.89Z" style="fill:rgb(198,198,198)"/><path d="M6.67,13.46a.45.45,0,0,1-.2,0,5.32,5.32,0,1,1,6.54-2,.49.49,0,0,1-.69.15.5.5,0,0,1-.15-.69,4.29,4.29,0,1,0-5.3,1.63.5.5,0,0,1-.2,1Z" style="fill:rgb(198,198,198)"/></svg>'},tails:{textEdit:'<svg xmlns="http://www.w3.org/2000/svg" width="6.54" height="15.36"><path id="_Path_" d="M6.54.54V0A3.64,3.64,0,0,0,3.27,1.72,3.67,3.67,0,0,0,0,0V.54c1.65,0,3,1,3,2.25V7.9H1.35v.54H3v4.13c0,1.24-1.35,2.25-3,2.25v.54a3.65,3.65,0,0,0,3.27-1.73,3.66,3.66,0,0,0,3.27,1.73v-.54c-1.65,0-3-1-3-2.25V8.44H5.19V7.9H3.54V2.79C3.53,1.55,4.88.54,6.54.54Z"/></svg>',text:'<svg xmlns="http://www.w3.org/2000/svg" width="10.65" height="12.21" ><title>cursors-tails</title><path d="M.11,0H10.55l.1,3.14H10.2a3.76,3.76,0,0,0-.82-1.93A3.39,3.39,0,0,0,7.27.77h-1v9.44q0,1.06.33,1.32A2.91,2.91,0,0,0,8,11.87v.34H2.66v-.34a2.52,2.52,0,0,0,1.46-.39A2.39,2.39,0,0,0,4.41,10V.77h-1a3.5,3.5,0,0,0-2.09.44A3.28,3.28,0,0,0,.45,3.14H0Z"/></svg>',connector:'<svg xmlns="http://www.w3.org/2000/svg" width="14.93" height="12.35" ><title>cursors-tails</title><path d="M12.68,0a2.25,2.25,0,0,0-2.12,1.5H6.65V9.35H4.37a2.25,2.25,0,1,0,0,1.5H8.15V3h2.41a2.25,2.25,0,1,0,2.12-3ZM2.25,10.85A.75.75,0,1,1,3,10.1.76.76,0,0,1,2.25,10.85ZM12.68,3a.75.75,0,1,1,.75-.75A.75.75,0,0,1,12.68,3Z" style="fill:rgb(21,20,21)"/></svg>',move:'<svg xmlns="http://www.w3.org/2000/svg" width="12.6" height="12.6"><title>move-tail</title><path d="M6.3,4.87a.5.5,0,0,1-.5-.5V2.45A.5.5,0,0,1,6.3,2a.5.5,0,0,1,.5.5V4.37A.5.5,0,0,1,6.3,4.87Z" style="fill:rgb(21,20,21)"/><path d="M6.3,10.54a.5.5,0,0,1-.5-.5V8.46A.51.51,0,0,1,6.3,8a.5.5,0,0,1,.5.5V10A.5.5,0,0,1,6.3,10.54Z" style="fill:rgb(21,20,21)"/><path d="M6.48.07l2,2.39c.08.1,0,.22-.18.22h-4c-.16,0-.25-.12-.18-.22l2-2.39A.26.26,0,0,1,6.48.07Z" style="fill:rgb(21,20,21)"/><path d="M6.13,12.53l-2-2.39c-.07-.09,0-.21.18-.21h4c.16,0,.26.12.18.21l-2,2.39A.24.24,0,0,1,6.13,12.53Z" style="fill:rgb(21,20,21)"/><path d="M10.16,6.8H8.35a.5.5,0,0,1-.5-.5.5.5,0,0,1,.5-.5h1.81a.51.51,0,0,1,.5.5A.5.5,0,0,1,10.16,6.8Z" style="fill:rgb(21,20,21)"/><path d="M4.26,6.8H2.56a.5.5,0,0,1-.5-.5.5.5,0,0,1,.5-.5h1.7a.51.51,0,0,1,.5.5A.5.5,0,0,1,4.26,6.8Z" style="fill:rgb(21,20,21)"/><path d="M12.53,6.48l-2.39,2c-.09.08-.21,0-.21-.18v-4c0-.16.12-.25.21-.18l2.39,2A.24.24,0,0,1,12.53,6.48Z" style="fill:rgb(21,20,21)"/><path d="M.07,6.13l2.39-2c.1-.07.22,0,.22.18v4c0,.16-.12.26-.22.18l-2.39-2A.26.26,0,0,1,.07,6.13Z" style="fill:rgb(21,20,21)"/></svg>',resizeTopLeft:'<svg xmlns="http://www.w3.org/2000/svg" width="10.64" height="10.52" ><title>cursors-tails</title><path d="M10.64,10.15a.38.38,0,0,1-.36.37l-4.53-.34c-.18,0-.2-.23,0-.4L7.22,8.22,2.36,3.36.85,4.92c-.16.16-.38.15-.4,0L0,.37A.37.37,0,0,1,.36,0L4.89.34c.18,0,.2.23,0,.39L3.42,2.29,8.27,7.15,9.79,5.59c.16-.16.38-.14.4,0Z"/></svg>',resizeTopRight:'<svg xmlns="http://www.w3.org/2000/svg" width="10.52" height="10.64" ><title>cursors-tails</title><path d="M10.52.36l-.34,4.53c0,.18-.23.2-.4,0L8.23,3.41,3.37,8.27,4.92,9.79c.17.16.15.38,0,.4l-4.52.45A.37.37,0,0,1,0,10.28L.34,5.75c0-.18.23-.2.4,0L2.29,7.23,7.15,2.37,5.6.85c-.17-.16-.15-.38,0-.4L10.15,0A.37.37,0,0,1,10.52.36Z"/></svg>',resizeVertical:'<svg xmlns="http://www.w3.org/2000/svg" width="6.44" height="14.65" ><title>cursors-tails</title><path d="M6.41,11,3.53,14.54a.37.37,0,0,1-.51,0l-3-3.45c-.12-.13,0-.3.25-.3l2.18,0V3.89L.3,3.92c-.22,0-.37-.16-.26-.3L2.92.1a.38.38,0,0,1,.52,0l3,3.44c.12.13,0,.31-.25.31L4,3.88v6.87l2.17,0C6.37,10.72,6.52,10.88,6.41,11Z"/></svg>',resizeHorizontal:'<svg xmlns="http://www.w3.org/2000/svg" width="14.65" height="6.44" ><title>cursors-tails</title><path d="M14.55,3.43l-3.44,3c-.14.11-.31,0-.31-.26l0-2.17H3.9l0,2.17c0,.23-.17.37-.31.26L.11,3.52A.36.36,0,0,1,.1,3L3.54,0c.14-.12.31,0,.31.25l0,2.18h6.87l0-2.17c0-.23.17-.38.3-.26l3.52,2.87A.37.37,0,0,1,14.55,3.43Z"/></svg>',break:'<svg width="10" height="10" ></svg>',delete:'<svg width="10" height="10" ></svg>',drop:'<svg xmlns="http://www.w3.org/2000/svg" width="13.04" height="10.79" ><title>cursors-tails</title><path d="M13,4.94v5.85H4.19V4.94H5.56V3.53a2,2,0,0,0-4.06,0V4.94a.75.75,0,0,1-1.5,0V3.53a3.53,3.53,0,0,1,7.06,0V4.94Z" style="fill:rgb(21,20,21)"/></svg>',lock:'<svg xmlns="http://www.w3.org/2000/svg" width="8.85" height="10.79" ><title>cursors-tails</title><path d="M8,4.94V3.53a3.54,3.54,0,0,0-7.07,0V4.94H0v5.85H8.85V4.94Zm-5.57,0V3.53a2,2,0,0,1,4.07,0V4.94Z" style="fill:rgb(21,20,21)"/></svg>'}};!function(t){t.start="multiselection-start",t.end="multiselection-end",t.drag="multiselection-drag"}(ht||(ht={}));var ft,bt=function(t){function e(e,n){var i=t.call(this,e,!1,!1)||this;return i.relatedEvent=n,i}return o.d(e,t),e}(rt.Event),gt=n("deqJ"),vt=n("ljsB"),yt=n("wOpJ"),mt=function(t){function e(e,n,i,r){return void 0===i&&(i=!0),void 0===r&&(r=!0),t.call(this,e,n,i,r)||this}return o.d(e,t),e}(tt.a),Ot=function(t){function e(e,n,i,r){return void 0===i&&(i=!0),void 0===r&&(r=!0),t.call(this,e,n,i,r)||this}return o.d(e,t),e}(mt),St=n("d62g"),xt=n("8Fqk"),Ct=function(t){function e(e,n,i,r){void 0===i&&(i=!0),void 0===r&&(r=!0);var o=t.call(this,e,n,i,r)||this;return o.setRelatedShape(n),o}return o.d(e,t),e}(mt),Pt=n("BQpn");!function(t){t.over="endpoint-over",t.out="endpoint-out"}(ft||(ft={}));var wt,Et=function(t){function e(e,n,i){var r=t.call(this,e,!0,!0)||this;return r.type=e,r.handle=n,r.targetOver=i,r}return o.d(e,t),e}(rt.Event),jt=function(){function t(){this.collisionCanvas=document.createElement("canvas"),this.collisionCtx=this.collisionCanvas.getContext("2d"),this.collisionCtx.save()}return t.prototype.getColliding=function(t,e){var n=this;return t.filter(function(t){return n.doesCollide(t,e)})},t.prototype.doesCollide=function(t,e){var n=this.intersection(t,e);if(!this.isValidRect(n))return!1;n.pad(1,1,1,1);var i=this.getHitPoints(t),r=this.getHitPoints(e);if(i||r){var o=void 0,a=void 0;return i&&r?i.length>r.length?(o=t,a=r):(o=e,a=i):i?(o=e,a=i):(o=t,a=r),this.isPointColliding(this.pointsToRectangle(n,a),this.getImageData(n,o))}return!1},t.prototype.doesBoxCollide=function(t,e){var n=this.intersection(t,e);return this.isValidRect(n)},t.prototype.intersection=function(t,e){var n=t.hitArea||t,i=e.hitArea||e,r=this.getGlobalBounds(n,t),o=this.getGlobalBounds(i,e);if(!r||!o)throw new Error("Collision Detection is not possible on shapes that dont have bounds set");return r.intersection(o)},t.prototype.isValidRect=function(t){return!!t&&t.width>0&&t.height>0},t.prototype.pointsToRectangle=function(t,e){return e.filter(function(e){return t.contains(e.x,e.y)}).map(function(e){return{x:e.x-t.x,y:e.y-t.y}})},t.prototype.isPointColliding=function(t,e){var n=e.data;return!!t.find(function(t){var i=Math.round(t.x),r=Math.round(t.y)*e.width*4+4*i-1;return n[r]>0})},t.prototype.getImageData=function(t,e){this.collisionCanvas.width=t.width,this.collisionCanvas.height=t.height,this.collisionCtx.restore(),this.collisionCtx.save();var n=e.getConcatenatedMatrix();return n.tx-=t.x,n.ty-=t.y,this.collisionCtx.setTransform(n.a,n.b,n.c,n.d,n.tx,n.ty),e.draw(this.collisionCtx),this.collisionCtx.getImageData(0,0,t.width,t.height)},t.prototype.getHitPoints=function(t){if(t.getHitPoints){var e=t;return t.getHitPoints().map(function(t){return e.localToGlobal(t.x,t.y)})}},t.prototype.getGlobalBounds=function(t,e){var n=t.getBounds();if(n){var i=s.I.fromMatrix(e.getConcatenatedMatrix()),r=i.transform(n.x,n.y),o=i.transform(n.x+n.width,n.y),a=i.transform(n.x,n.y+n.height),l=i.transform(n.x+n.width,n.y+n.height),c=r.min(o).min(a).min(l),u=r.max(o).max(a).max(l);return new rt.Rectangle(c.x,c.y,u.x-c.x,u.y-c.y)}},t}(),It=n("oxTG"),Tt=function(){function t(t){this.target=t}return t.prototype.change=function(t,e){var n=this.target.getMatrix().transformPoint(t,e);this.target.regX=t,this.target.regY=e,this.target.x=n.x,this.target.y=n.y},t.prototype.reset=function(){var t=this.target.getMatrix();this.target.regX=0,this.target.regY=0,this.target.x=t.tx,this.target.y=t.ty},t.prototype.translateTo=function(t,e){var n=this.target.getMatrix();n.tx=0,n.ty=0;var i=n.transformPoint(this.target.regX,this.target.regY);this.target.x=t-this.target.regX+i.x,this.target.y=e-this.target.regY+i.y},t}(),Mt=n("ZtqW"),Dt=function(t){function e(e){var n=t.call(this)||this;return n.name=e.id,n}return o.d(e,t),e.prototype.getCurrentMatrix=function(){var t=this.getConcatenatedMatrix().clone(),e=this.parent.parent.getConcatenatedMatrix().clone().invert();return s.I.fromMatrix(t.prependMatrix(e))},e}(rt.Shape),At=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o.d(e,t),e.prototype.setTranslation=function(t){var e=this.parent.getTranslation();this.x=t.x-e.x,this.y=t.y-e.y},e.prototype.setDefaultBounds=function(t){this.setBounds(0,0,t.defaultBounds.width,t.defaultBounds.height)},e.prototype.setTransformation=function(t){this.scaleX=t.scaleX,this.scaleY=t.scaleY,this.rotation=t.angle},e.prototype.resetTransformation=function(){this.scaleX=1,this.scaleY=1,this.rotation=0},e}(Dt),kt=n("5vYS"),Lt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o.d(e,t),e.prototype.getMatrixDiff=function(t){var e=t||this.modelMatrix.clone();return this.updateModelMatrix(),{prev:e,next:this.modelMatrix.clone()}},e.prototype.setDefaultBounds=function(t){var e=t.bounds;this.setBounds(0,0,e.width,e.height),this.updateModelMatrix()},e.prototype.setTranslation=function(t){var e=t.bounds,n=this.parent.getTranslation();this.x=e.x-n.x,this.y=e.y-n.y,this.updateModelMatrix()},e.prototype.setTransformation=function(t){},e.prototype.resetTransformation=function(){},e.prototype.updateModelMatrix=function(){this.modelMatrix=this.getCurrentMatrix()},e}(Dt);!function(t){t[t.None=0]="None",t[t.SingleShape=1]="SingleShape",t[t.MultiShape=2]="MultiShape",t[t.Connector=3]="Connector"}(wt||(wt={}));var Ft=function(t){function e(e){var n=t.call(this)||this;return n.commandService=e,n.baseConnectorMatrices={},n.selectedShapes={},n.reg=new Tt(n),n}return o.d(e,t),e.prototype.cancelInteraction=function(){this.commandService.dispatch(R.a.resetDiagramPreview)},e.prototype.addChild=function(e){return t.prototype.addChild.call(this,e)},e.prototype.getChildByName=function(e){return t.prototype.getChildByName.call(this,e)},Object.defineProperty(e.prototype,"selectedIds",{get:function(){return this.selectedShapes?Object.keys(this.selectedShapes):[]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selectedShapeList",{get:function(){return Object(c.values)(this.selectedShapes)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selectionCount",{get:function(){return this.selectedIds.length},enumerable:!0,configurable:!0}),e.prototype.isSelected=function(t){return!!this.selectedShapes[t]},e.prototype.addModel=function(t){this.selectedShapes[t.id]=t},e.prototype.removeModel=function(t){delete this.selectedShapes[t.id]},e.prototype.addShape=function(t){if(this.addModel(t),t instanceof Mt.a){var e=new At(t);this.addChild(e)}if(t instanceof kt.a){e=new Lt(t);this.addChild(e),this.cacheConnectorMatrix(t)}},e.prototype.removeShape=function(t){this.removeModel(this.selectedShapes[t]);var e=this.getChildByName(t);this.removeChild(e)},e.prototype.changeShape=function(t){this.addModel(t)},e.prototype.getTranslation=function(){return this.getMatrix().transformPoint(0,0)},e.prototype.getShapeMatrices=function(){var t=this,e={};return this.selectedIds.forEach(function(n){if(t.selectedShapes[n]instanceof Mt.a){var i=t.getChildByName(n);e[n]=i.getCurrentMatrix()}}),e},e.prototype.cacheConnectorMatrix=function(t){var e=t.bounds;this.baseConnectorMatrices[t.id]=new s.I,this.baseConnectorMatrices[t.id].translate(e.x,e.y)},e.prototype.resetCachedConnectorMatrices=function(){var t=this;this.selectedIds.forEach(function(e){var n=t.selectedShapes[e];n instanceof kt.a&&t.cacheConnectorMatrix(n)})},e.prototype.getConnectorMatrices=function(t){var e=this;void 0===t&&(t=!0);var n={};return this.selectedIds.forEach(function(i){if(e.selectedShapes[i]instanceof kt.a){var r=e.getChildByName(i);if(t)n[i]=r.getMatrixDiff();else{var o=e.baseConnectorMatrices[i];n[i]=r.getMatrixDiff(o)}}}),n},e.prototype.destroy=function(){this.removeAllChildren(),this.selectedShapes=void 0},e}(rt.Container),Ht=n("d9KY"),Rt=function(t){function e(e){var n=t.call(this)||this;return n.ll=e,n}return o.d(e,t),Object.defineProperty(e,"implements",{get:function(){return["ICommand"]},enumerable:!0,configurable:!0}),Object.defineProperty(e,"dataDefinition",{get:function(){return{type:!1}},enumerable:!0,configurable:!0}),e.prototype.execute=function(){var t=this;return this.ll.forCurrent(this.eventData.scenario===s.p.PREVIEW).getDiagramOnce().pipe(Object(d.a)(function(e){if(t.data&&t.data.type){var n=[];Object(c.map)(e.shapes,function(e,i){e instanceof t.data.type&&n.push(i)}),t.resultData={shapeIds:n}}else t.resultData={shapeIds:Object(c.keys)(e.shapes)}}),Object(lt.a)(!0))},e=o.c([Object(s.l)(),o.f("design:paramtypes",[f.a])],e)}(s.a);Object.defineProperty(Rt,"name",{value:"GetShapeIds"});var Bt=n("rW6H"),Nt=n("kXwT"),_t=n("E/45"),Gt=n("5Nnh"),Vt=n("7/v2"),Yt=n("d0OC"),Ut=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o.d(e,t),e.prototype.prepareData=function(){for(var t=this.getShapeBounds(this.data.shapeIds),e=this.alignShapes(t,this.data.isVertical,this.data.alignment),n=0;n<this.data.shapeIds.length;++n){var i=e[n],r=this.data.shapeIds[n],o=this.changeModel.shapes[r];if(o.type===l.l.Connector)this.setConnectorPosition(o,i);else{var a=o.transform;a.angle<=0||a.angle>90&&a.angle<=180?(i.y=i.y+(a.y-o.bounds.y),i.x=i.x+(a.x-o.bounds.x)):a.angle>0&&a.angle<=90&&(i.x=i.x+o.bounds.width),this.setShapePosition(o,i)}}},e.prototype.getShapeBounds=function(t){var e,n,i=[];try{for(var r=o.k(t),a=r.next();!a.done;a=r.next()){var s=a.value,c=this.changeModel.shapes[s];c.type,l.l.Connector,i.push(c.bounds)}}catch(u){e={error:u}}finally{try{a&&!a.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}return i},e.prototype.alignShapes=function(t,e,n){return e?Object(s.fb)(t,n):Object(s.eb)(t,n)},e.prototype.setShapePosition=function(t,e){t.x=e.x,t.y=e.y},e.prototype.setConnectorPosition=function(t,e){var n,i;if(!t.fromEndpoint.shape&&!t.toEndpoint.shape){var r=t.bounds,a=e.x-r.x,s=e.y-r.y,l=t.getPoints(),u=Object(c.cloneDeep)(l);try{for(var p=o.k(u),h=p.next();!h.done;h=p.next()){var d=h.value;d.x+=a,d.y+=s,d.c1&&(d.c1.x+=a,d.c1.y+=s),d.c2&&(d.c2.x+=a,d.c2.y+=s)}}catch(f){n={error:f}}finally{try{h&&!h.done&&(i=p.return)&&i.call(p)}finally{if(n)throw n.error}}t.path=kt.a.createPathFromPoints(u)}},e=o.c([Object(s.l)()],e)}(Yt.a);Object.defineProperty(Ut,"name",{value:"AlignShapes"});var Xt=n("DBOR"),Zt=n("uWBd"),Kt=function(t){function e(e,n){var i=t.call(this,e)||this;return i.ds=e,i.pathingSvc=n,i}return o.d(e,t),e.prototype.prepareData=function(){var t,e;try{for(var n=o.k(this.data.connectorIds),i=n.next();!i.done;i=n.next()){var r=i.value,a=this.changeModel.shapes[r],s=this.pathingSvc.reverse(r,this.changeModel),l=kt.a.createPathFromPoints(s);Object(c.isEqual)(a.path,l)||(a.path=l)}}catch(u){t={error:u}}finally{try{i&&!i.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}},e=o.c([Object(s.l)(),o.f("design:paramtypes",[Xt.a,Zt.a])],e)}(Yt.a);Object.defineProperty(Kt,"name",{value:"FlipConnector"});var zt=n("Cm/l"),qt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o.d(e,t),Object.defineProperty(e,"dataDefinition",{get:function(){return{shapeId:!0,vectorId:!0,points:!0}},enumerable:!0,configurable:!0}),e.prototype.prepareData=function(){var t=this.changeModel.shapes[this.data.shapeId],e=t.defaultBounds,n=t.transform,i=t.vectors[this.data.vectorId];i.id=this.data.vectorId,i.movement=i.movement,i.withInBounds=i.withInBounds;var r=this.data.points.map(function(r,o){r=t.diagramToShapeCordinate(r);var a=i.points[o].x.type,s=i.points[o].y.type;return{x:{type:a,value:"relative"===a?r.x/(e.width*n.scaleX):r.x},y:{type:s,value:"relative"===s?r.y/(e.height*n.scaleY):r.y}}});i.points=r},e=o.c([Object(s.l)()],e)}(Yt.a);Object.defineProperty(qt,"name",{value:"MoveVisualVector"});var Wt=function(t){function e(e){var n=t.call(this)||this;return n.convert=e,n}return o.d(e,t),e.prototype.prepareData=function(){if(this.resultData={},this.data.shapes)for(var t in this.resultData.shapes={},this.data.shapes){var e=this.data.shapes[t];this.resultData.shapes[t]=this.convert.matrix(e)}if(this.data.connectors)for(var t in this.resultData.connectors={},this.data.connectors){var n=this.data.connectors[t],i=n.prev,r=n.next;this.resultData.connectors[t]={prev:this.convert.matrix(i),next:this.convert.matrix(r)}}},e.prototype.execute=function(){return!0},e=o.c([Object(s.l)(),o.f("design:paramtypes",[$.a])],e)}(s.a);Object.defineProperty(Wt,"name",{value:"ConvertViewportForTransform"});var Jt=n("9KTM"),Qt=function(t){function e(e,n){var i=t.call(this,e)||this;return i.ds=e,i.restriction=n,i}return o.d(e,t),e.prototype.prepareData=function(){var t=this,e=["ShapeBounds","GridService"];for(var n in this.data.shapes){var i=this.data.shapes[n].toTransform();i.skewX=0,i.skewY=0;var r=this.changeModel.shapes[n],o=this.restriction.shapeTransform(r,i,e);r.x!==o.x&&(r.x=o.x),r.y!==o.y&&(r.y=o.y),r.transformSettings.hScale&&r.scaleX!==o.scaleX&&(r.scaleX=o.scaleX),r.transformSettings.vScale&&r.scaleY!==o.scaleY&&(r.scaleY=o.scaleY),r.transformSettings.rotate&&r.angle!==o.angle&&(r.angle=o.angle),0!==r.skewX&&(r.skewX=0),0!==r.skewY&&(r.skewY=0)}var a=function(e){var n=l.changeModel.shapes[e];if(!l.shouldTransform(n))return"continue";var i=l.data.connectors[e],r=i.prev,o=i.next,a=s.I.fromMatrix(o.appendMatrix(r.invert())),u=n.getPoints().map(function(e){return t.transformPoint(e,a)}),p=kt.a.createPathFromPoints(u);Object(c.isEqual)(n.path,p)||(n.path=p)},l=this;for(var n in this.data.connectors)a(n)},e.prototype.shouldTransform=function(t){var e=t.getPoints(),n=e[0],i=e[e.length-1];return!!(!n.shapeId||this.data.shapes&&this.data.shapes[n.shapeId])&&!!(!i.shapeId||this.data.shapes&&this.data.shapes[i.shapeId])},e.prototype.transformPoint=function(t,e){var n=Object(c.cloneDeep)(t);return e.transformPoint(n.x,n.y,n),n.c1&&e.transformPoint(n.c1.x,n.c1.y,n.c1),n.c2&&e.transformPoint(n.c2.x,n.c2.y,n.c2),n.bumps=[],n},e=o.c([Object(s.l)(),o.f("design:paramtypes",[Xt.a,Jt.a])],e)}(Yt.a);Object.defineProperty(Qt,"name",{value:"TransformShapes"});var $t=function(t){function e(e,n){var i=t.call(this,e)||this;return i.ds=e,i.state=n,i}return o.d(e,t),e.prototype.prepareData=function(){this.addShapesToGroup(this.getShapeIds())},e.prototype.getShapeIds=function(){var t=void 0===this.data.shapeIds?[]:this.data.shapeIds;return(void 0===this.data.includeSelected||this.data.includeSelected)&&(t=t.concat(this.state.get("Selected"))),t},e.prototype.addShapesToGroup=function(t){var e=this;if(!this.changeModel.isShapeInGroup(t)){var n=[],i=[];t.forEach(function(t){if(e.changeModel.isShapeInGroup([t])){var r=e.changeModel.getGroupHierarchy(t);i.push(r[0])}else n.push(t)}),i=Object(c.uniq)(i);var r=s.O.groupId();this.changeModel.groups[r]={shapes:n,groups:i}}},e=o.c([Object(s.l)(),o.f("design:paramtypes",[Xt.a,s.Z])],e)}(Yt.a);Object.defineProperty($t,"name",{value:"GroupShapes"});var te=function(t){function e(e,n){var i=t.call(this,e)||this;return i.ds=e,i.state=n,i}return o.d(e,t),e.prototype.prepareData=function(){var t=this.getShapeIds();if(this.changeModel.isShapeInGroup(t)){var e=this.changeModel.getGroupHierarchy(t[0])[0];delete this.changeModel.groups[e]}},e.prototype.getShapeIds=function(){var t=void 0===this.data.shapeIds?[]:this.data.shapeIds;return(void 0===this.data.includeSelected||this.data.includeSelected)&&(t=t.concat(this.state.get("Selected"))),t},e=o.c([Object(s.l)(),o.f("design:paramtypes",[Xt.a,s.Z])],e)}(Yt.a);Object.defineProperty(te,"name",{value:"UnGroupShapes"});var ee=n("MRT2"),ne=function(t){function e(e,n){var i=t.call(this,e)||this;return i.ds=e,i.stateSvc=n,i}return o.d(e,t),e.prototype.prepareData=function(){var t,e,n,i,r,a,l,c;if(this.eventData.scenario!==s.p.PREVIEW){var u={};try{for(var p=o.k(Object.keys(this.changeModel.shapes)),h=p.next();!h.done;h=p.next()){var d=h.value,f=this.changeModel.shapes[d];if(this.isConnectorModel(f))try{for(var b=o.k(this.getConnectedGluepoints(f)),g=b.next();!g.done;g=b.next()){u[P=g.value]=!0}}catch(j){n={error:j}}finally{try{g&&!g.done&&(i=b.return)&&i.call(b)}finally{if(n)throw n.error}}else try{for(var v=o.k(Object.keys(f.gluepoints)),y=v.next();!y.done;y=v.next()){var m=y.value,O=f.gluepoints[m],S=f.id+"."+m;"custom"!==O.type||u[S]||(u[S]=!1)}}catch(I){r={error:I}}finally{try{y&&!y.done&&(a=v.return)&&a.call(v)}finally{if(r)throw r.error}}}}catch(T){t={error:T}}finally{try{h&&!h.done&&(e=p.return)&&e.call(p)}finally{if(t)throw t.error}}try{for(var x=o.k(Object.keys(u)),C=x.next();!C.done;C=x.next()){var P;if(!u[P=C.value]){var w=o.h(P.split("."),2);d=w[0],m=w[1];delete(f=this.changeModel.shapes[d]).gluepoints[m]}}}catch(M){l={error:M}}finally{try{C&&!C.done&&(c=x.return)&&c.call(x)}finally{if(l)throw l.error}}var E=this.stateSvc.get("CustomGluePoint");if(E&&E.shapeId&&E.gluepoint)(f=this.changeModel.shapes[E.shapeId]).gluepoints[E.gluepoint.id]=E.gluepoint}},e.prototype.isConnectorModel=function(t){return t.type===l.l.Connector},e.prototype.getConnectedGluepoints=function(t){var e,n,i=[],r=t.getPoints(),a=[r[0],r[r.length-1]],s=function(e){var n=l.data.changes[t.id];n&&n.find(function(t){return t.id===e.id})||i.push(e.shapeId+"."+e.gluepointId)},l=this;try{for(var c=o.k(a),u=c.next();!u.done;u=c.next()){s(u.value)}}catch(p){e={error:p}}finally{try{u&&!u.done&&(n=c.return)&&n.call(c)}finally{if(e)throw e.error}}return i},e=o.c([Object(s.l)(),o.f("design:paramtypes",[Xt.a,s.Z])],e)}(Yt.a);Object.defineProperty(ne,"name",{value:"UpdateCustomGluepoints"});var ie=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o.d(e,t),e.registerSelectAll=function(t){t.mapSequence(e.selectAll).add(Rt).add(Ht.a)},e.registerMoveVector=function(t){t.mapSequence(e.moveVisualVector).add(Nt.a).add(qt,{alter:function(t){return e.alterForModelChange(t)}}).add(ee.a)},e.registerTransformShapesAndConnectors=function(t){t.mapSequence(e.transformShapesAndConnectors).add(Wt).add(Qt,{alter:function(t){return e.alterForModelChange(t)}}).add(Gt.a,{transform:function(t){return{shapeIds:Object.keys(t.eventData.shapes||{})}}}).add(_t.a,{transform:function(t){var e,n,i=t.resultData[2];if(t.eventInfo.scenario===s.p.PREVIEW&&Math.random()<.1){var r={};try{for(var a=o.k(Object.keys(i)),l=a.next();!l.done;l=a.next()){var c=l.value;1===i[c].length&&(r[c]=i[c])}}catch(u){e={error:u}}finally{try{l&&!l.done&&(n=a.return)&&n.call(a)}finally{if(e)throw e.error}}return{changes:r}}return{changes:i}}}).add(Bt.a,{alter:function(t){return e.alterForModelChange(t)},transform:function(t){return{changes:t.resultData[3]}}}).add(zt.a,{alter:function(t){return e.alterForModelChange(t)},transform:function(t){var e,n;if(t.eventInfo.scenario===s.p.PREVIEW)return{changes:{}};var i=o.j(Object.keys(t.eventData.connectors||{}),Object.keys(t.resultData[3])),r={};try{for(var a=o.k(i),l=a.next();!l.done;l=a.next()){r[l.value]={}}}catch(c){e={error:c}}finally{try{l&&!l.done&&(n=a.return)&&n.call(a)}finally{if(e)throw e.error}}return{changes:r}}}).add(ee.a)},e.registerMoveConnectorEndPointOnViewport=function(t){t.mapSequence(e.moveConnectorEndPointOnViewport).add(Nt.a).add(ne,{alter:function(t){return e.alterForModelChange(t)},transform:function(t){var e,n=t.resultData[0];return{changes:(e={},e[n.id]=n.points,e)}}}).add(_t.a,{transform:function(t){var e,n=t.resultData[0];return{changes:(e={},e[n.id]=n.points,e)}}}).add(Bt.a,{alter:function(t){return e.alterForModelChange(t)},transform:function(t){return{changes:t.resultData[2]}}}).add(zt.a,{alter:function(t){return e.alterForModelChange(t)},transform:function(t){if(t.eventInfo.scenario===s.p.PREVIEW)return{changes:{}};var e=t.resultData[2],n={};return Object.keys(e).forEach(function(t){return n[t]={}}),{changes:n}}}).add(Vt.a,{alter:function(t){return e.alterForModelChange(t)},transform:function(t){var e;return{changes:(e={},e[t.resultData[0].id]=null,e),updateConnections:t.eventData.updateConnections,updateDefinitions:t.eventData.updateDefinitions}}}).add(ee.a)},e.registerMoveConnectorPathPointOnViewport=function(t){t.mapSequence(e.moveConnectorPathPointOnViewport).add(Nt.a).add(Bt.a,{alter:function(t){return e.alterForModelChange(t)},transform:function(t){var e,n=t.resultData[0];return{changes:(e={},e[n.id]=n.points,e)}}}).add(zt.a,{alter:function(t){return e.alterForModelChange(t)},transform:function(t){var e;return t.eventInfo.scenario===s.p.PREVIEW?{changes:{}}:{changes:(e={},e[t.resultData[0].id]={},e)}}}).add(ee.a)},e.registerChangeConnectedGluepoint=function(t){t.mapSequence(e.changeConnectedGluepoint).add(_t.a,{transform:function(t){var e,n=t.data[0],i={id:n.endpointId,shapeId:n.shapeId,gluepointId:n.gluepointId,gluepointLocked:!0};return{changes:(e={},e[n.connectorId]=[i],e)}}}).add(Bt.a,{alter:function(t){return e.alterForModelChange(t)},transform:function(t){return{changes:t.resultData[0]}}}).add(zt.a,{alter:function(t){return e.alterForModelChange(t)},transform:function(t){if(t.eventInfo.scenario===s.p.PREVIEW)return{changes:{}};var e=t.resultData[0],n={};return Object.keys(e).forEach(function(t){return n[t]={}}),{changes:n}}}).add(ee.a)},e.registerFlipConnector=function(t){t.mapSequence(e.flipConnector).add(Kt,{alter:function(t){return e.alterForModelChange(t)}})},e.registerAlignShapes=function(t){t.mapSequence(this.alignShapes).add(Ut,{alter:function(t){return e.alterForModelChange(t)}}).add(Gt.a,{transform:function(t){return{shapeIds:t.eventData.shapeIds}}}).add(_t.a,{transform:function(t){return{changes:t.resultData[1]}}}).add(Bt.a,{alter:function(t){return e.alterForModelChange(t)},transform:function(t){return{changes:t.resultData[2]}}}).add(zt.a,{alter:function(t){return e.alterForModelChange(t)},transform:function(t){var e,n,i=o.j(t.eventData.shapeIds,Object.keys(t.resultData[2])),r={};try{for(var a=o.k(i),s=a.next();!s.done;s=a.next()){r[s.value]={}}}catch(l){e={error:l}}finally{try{s&&!s.done&&(n=a.return)&&n.call(a)}finally{if(e)throw e.error}}return{changes:r}}})},e.registerGroupShapes=function(t){t.mapSequence(e.groupShapes).add($t,{alter:function(t){return e.alterForModelChange(t)}})},e.registerUnGroupShapes=function(t){t.mapSequence(e.unGroupShapes).add(te,{alter:function(t){return e.alterForModelChange(t)}})},e.alterForModelChange=function(t){return"completed"===t.stepStatus&&("UnsavedModelChangeExecutionStep"===t.stepName||"PreviewModelChangeExecutionStep"===t.stepName)},e.selectAll=new e("SelectAll"),e.moveVisualVector=new e("MoveVisualVector"),e.transformShapesAndConnectors=new e("TransformShapesAndConnectors"),e.moveConnectorEndPointOnViewport=new e("MoveConnectorEndPointOnViewport"),e.moveConnectorPathPointOnViewport=new e("MoveConnectorPathPointOnViewport"),e.changeConnectedGluepoint=new e("ChangeConnectedGluepoint"),e.flipConnector=new e("FlipConnector"),e.alignShapes=new e("AlignShapes"),e.groupShapes=new e("GroupShapes"),e.unGroupShapes=new e("UnGroupShapes"),e}(s.c),re=function(t){function e(e){var n=t.call(this,e)||this;return n.commandService=e,n.resetPreview(),n}return o.d(e,t),Object.defineProperty(e.prototype,"selectionType",{get:function(){return wt.Connector},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selectedShape",{get:function(){var t=this.selectedShapeList;if(t.length>1)throw new Error("Single connector container should not have mode than 1 connector");var e=t[0];return e||null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"connectorPath",{get:function(){var t=this.selectedShape;return t?t.getPoints():[]},enumerable:!0,configurable:!0}),e.prototype.getEndPoints=function(){var t=this.connectorPath;return t.length?[t[0],t[t.length-1]].map(function(t){return{id:t.id,position:t}}):[]},e.prototype.getPathPoints=function(){var t=this.connectorPath;return t.length?t.slice(1,t.length-1).map(function(t){return{id:t.id,position:t,movement:null}}):[]},e.prototype.getBreakPoints=function(){return[]},e.prototype.onMove=function(){this.previewData.hasMove=!0},e.prototype.onEndPointMove=function(t,e,n){this.previewData.endPoint=o.a({},t),e&&(this.previewData.endPoint.shapeId=e,n?(this.previewData.endPoint.gluepointId=n,this.previewData.endPoint.gluepointLocked=!0):(this.previewData.endPoint.gluepointId=null,this.previewData.endPoint.gluepointLocked=!1))},e.prototype.onEndPointDrop=function(t,e,n){this.previewData.endPoint=o.a({},t),e&&(this.previewData.endPoint.shapeId=e,n?(this.previewData.endPoint.gluepointId=n,this.previewData.endPoint.gluepointLocked=!0):(this.previewData.endPoint.gluepointId=null,this.previewData.endPoint.gluepointLocked=!1))},e.prototype.onPathPointMove=function(t,e){this.previewData.pathPoint=o.a({id:t},e)},e.prototype.onPathPointDrop=function(t,e){this.previewData.pathPoint=o.a({id:t},e)},e.prototype.onBreakPointMove=function(t,e){},e.prototype.position=function(){var t=this.selectedShape;this.getChildByName(t.id).setTranslation(t)},e.prototype.previewInteraction=function(){return Object(q.a)(this.fireTransformConnector(!0),this.fireMoveConnectorEndPoint(!0),this.fireMoveConnectorPathPoint(!0))},e.prototype.completeInteraction=function(){var t=Object(q.a)(this.fireTransformConnector(!1),this.fireMoveConnectorEndPoint(!1),this.fireMoveConnectorPathPoint(!1));return this.resetCachedConnectorMatrices(),t},e.prototype.cancelInteraction=function(){t.prototype.cancelInteraction.call(this),this.resetPreview()},e.prototype.fireTransformConnector=function(t){if(!this.previewData.hasMove)return Object(ot.b)();delete this.previewData.hasMove;var e=ie.transformShapesAndConnectors,n={connectors:this.getConnectorMatrices(t)};return this.fireCommandEvent(e,n,t)},e.prototype.fireMoveConnectorEndPoint=function(t){if(!this.previewData.endPoint||!this.selectedShape)return Object(ot.b)();var e=ie.moveConnectorEndPointOnViewport,n={id:this.selectedShape.id,points:[this.previewData.endPoint],updateConnections:!t,updateDefinitions:!t};return t?n.points=Object(c.cloneDeep)(n.points):delete this.previewData.endPoint,this.fireCommandEvent(e,n,t)},e.prototype.fireMoveConnectorPathPoint=function(t){if(!this.previewData.pathPoint||!this.selectedShape)return Object(ot.b)();var e=ie.moveConnectorPathPointOnViewport,n={id:this.selectedShape.id,points:[this.previewData.pathPoint]};return t?n.points=Object(c.cloneDeep)(n.points):delete this.previewData.pathPoint,this.fireCommandEvent(e,n,t)},e.prototype.fireCommandEvent=function(t,e,n){var i=n?"preview":"dispatch";return this.commandService[i](t,e)},e.prototype.resetPreview=function(){this.previewData={}},e}(Ft),oe=n("wk5G"),ae=function(){function t(t,e,n){this.container=t,this.state=e,this.restriction=n,this.subs=new Map}return t.prototype.register=function(t){var e=this,n=t.getInteractionStart().subscribe(function(t){return e.startHandler(t)}),i=t.getImmediateInteraction().subscribe(function(t){return e.immediateHandler(t)}),r=t.getInteraction().pipe(Object(It.b)(function(t){return e.onHandler(t).pipe(Object(p.a)(function(){return!1}))})).subscribe(),o=t.getInteractionEnd().subscribe(function(t){return e.endHandler(t)});this.subs.set(t,[n,i,r,o])},t.prototype.unregister=function(t){var e,n;if(this.subs.has(t)){var i=this.subs.get(t);this.subs.delete(t);try{for(var r=o.k(i),a=r.next();!a.done;a=r.next()){a.value.unsubscribe()}}catch(s){e={error:s}}finally{try{a&&!a.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}}},Object.defineProperty(t.prototype,"inProgress",{get:function(){return this._inProgress},enumerable:!0,configurable:!0}),t.prototype.getCancelInteraction=function(){return Object(W.a)(window,"keydown").pipe(Object(p.a)(function(t){return t.keyCode===l.e.Escape}))},t.prototype.startHandler=function(t){var e=this;this._inProgress=!0,this.cancelInteractionSubscription=this.getCancelInteraction().subscribe(function(){return e.cancelHandler(t)});var n=t.target;this.interactionStart(t),this.dispatchInteractionEvent(n,oe.b.interactionStart,t)},t.prototype.immediateHandler=function(t){this.dispatchInteractionEvent(t.handle,oe.b.interactionStart,t),this.dispatchInteractionEvent(t.handle,oe.b.interactionImmediate,t),this.interactionImmediate(t),this.dispatchInteractionEvent(t.handle,oe.b.interactionEnd,t),this.container.completeInteraction()},t.prototype.getDirectionByKeycode=function(t){var e=0,n=0;return t===l.e.ArrowUp&&(n=-1),t===l.e.ArrowDown&&(n=1),t===l.e.ArrowLeft&&(e=-1),t===l.e.ArrowRight&&(e=1),{xDirection:e,yDirection:n}},t.prototype.onHandler=function(t){if(!this._inProgress)return Object(ot.b)();var e=t.target;return this.interaction(t),this.dispatchInteractionEvent(e,oe.b.interaction,t),Object(St.a)(this.container.previewInteraction(),Object(W.a)(rt.Ticker,"tick").pipe(Object(h.a)(1)))},t.prototype.endHandler=function(t){if(this._inProgress){var e=t.target;this.interactionEnd(t),this.dispatchInteractionEvent(e,oe.b.interactionEnd,t),this.container.completeInteraction(),this._inProgress=!1,this.cancelInteractionSubscription.unsubscribe()}},t.prototype.cancelHandler=function(t){if(this._inProgress){var e=t.target;this.interactionCancel(t),this.dispatchInteractionEvent(e,oe.b.interactionCancel,t),this.container.cancelInteraction(),this._inProgress=!1,this.cancelInteractionSubscription.unsubscribe()}},t.prototype.dispatchInteractionEvent=function(t,e,n){t.dispatchEvent(new oe.a(e,this.name,t,null,n))},t.prototype.destroy=function(){var t,e,n,i;try{for(var r=o.k(this.subs.values()),a=r.next();!a.done;a=r.next()){var s=a.value;try{for(var l=o.k(s),c=l.next();!c.done;c=l.next()){c.value.unsubscribe()}}catch(u){n={error:u}}finally{try{c&&!c.done&&(i=l.return)&&i.call(l)}finally{if(n)throw n.error}}}}catch(p){t={error:p}}finally{try{a&&!a.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}this.subs=new Map},t.prototype.restrictMovement=function(t,e,n,i){if(!e||"free"===e)return i;var r=this.container.selectedShapeList.find(function(e){return e.id===t}).transform,o=s.I.fromTransform(r).invert().transformPoint(n.x,n.y);switch(e){case"horizontal":o={x:o.x+5,y:o.y};break;case"vertical":o={x:o.x,y:o.y+5};break;case"diagonal-nesw":o={x:o.x-5,y:o.y+5};break;case"diagonal-nwse":o={x:o.x+5,y:o.y+5}}var a=s.I.fromTransform(r).transformPoint(o.x,o.y),l=new s.E(n,a).perpendicularTo(i);return{x:l.x,y:l.y}},t}(),se=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o.d(e,t),Object.defineProperty(e.prototype,"name",{get:function(){return"MoveInteraction"},enumerable:!0,configurable:!0}),e.prototype.interactionStart=function(t){var e=this.restriction.pointOnViewport({x:t.stageX,y:t.stageY},["GridService"]),n=this.restriction.pointOnViewport({x:this.container.x,y:this.container.y},["GridService"]),i=e.x-n.x,r=e.y-n.y;this.container.reg.change(i,r)},e.prototype.interaction=function(t){var e=this.restriction.pointOnViewport({x:t.stageX,y:t.stageY},["GridService"]),n=e.x,i=e.y;this.container.reg.translateTo(n,i),this.container instanceof re&&this.container.onMove()},e.prototype.interactionImmediate=function(t){var e=O.a.gridSize*this.state.get("DiagramZoomLevel"),n=this.getDirectionByKeycode(t.keyCode),i=n.xDirection,r=n.yDirection,o=this.container.x+i*e,a=this.container.y+r*e,s=this.restriction.pointOnViewport({x:o,y:a},["GridService"]),l=s.x,c=s.y;this.container.reg.translateTo(l,c),this.interactionEnd(null)},e.prototype.interactionEnd=function(t){this.container.reg.reset(),this.container instanceof re&&this.container.onMove()},e.prototype.interactionCancel=function(t){this.container.reg.reset()},e}(ae),le=function(t){function e(e,n,i){var r=t.call(this,e,n,i)||this;return r.container=e,r.state=n,r.restriction=i,r}return o.d(e,t),Object.defineProperty(e.prototype,"name",{get:function(){return"ConnectorPointInteraction"},enumerable:!0,configurable:!0}),e.prototype.interactionStart=function(t){var e=this.getHandlePosition(t),n=e.x,i=e.y;this.container.reg.change(n,i)},e.prototype.interactionImmediate=function(t){},e.prototype.interactionEnd=function(t){this.container.reg.reset()},e.prototype.interactionCancel=function(t){this.container.reg.reset()},e.prototype.getHandlePosition=function(t){var e=t.target;return{x:e.x,y:e.y}},e.prototype.getPointerPosition=function(t){return{x:t.stageX,y:t.stageY}},e}(ae),ce=function(t){function e(e,n,i){var r=t.call(this,e,n,i)||this;return r.container=e,r.state=n,r.restriction=i,r.hoveredOver=[],r}return o.d(e,t),Object.defineProperty(e.prototype,"name",{get:function(){return"EndPointMoveInteraction"},enumerable:!0,configurable:!0}),e.prototype.register=function(e){var n=this;t.prototype.register.call(this,e);var i=e.getEndpointOver().subscribe(function(t){return n.onEndpointOver(t)}),r=e.getEndpointOut().subscribe(function(t){return n.onEndpointOut(t)});this.subs.set(e,[i,r])},e.prototype.onEndpointOver=function(t){this.hoveredOver.unshift(t.targetOver)},e.prototype.onEndpointOut=function(t){var e=t.targetOver,n=this.hoveredOver.findIndex(function(t){return t.name===e.name});n>=0&&this.hoveredOver.splice(n,1)},e.prototype.getHoveredTarget=function(t){return this.hoveredOver[0]},e.prototype.interactionStart=function(e){t.prototype.interactionStart.call(this,e)},e.prototype.interaction=function(t){var e=t.target,n=this.getHoveredTarget(e),i=this.getPointerPosition(t),r=i.x,o=i.y,a={};a.point={id:e.pointId,x:r,y:o,shapeId:null,gluepointId:null},n instanceof ct&&(a.shapeId=n.shapeId,a.gluepointId=n.gluePointId),this.container.onEndPointMove(a.point,a.shapeId,a.gluepointId)},e.prototype.interactionEnd=function(e){t.prototype.interactionEnd.call(this,e);var n=e.target,i=this.getHoveredTarget(n),r=this.getPointerPosition(e),o=r.x,a=r.y,s={};s.point={id:n.pointId,x:o,y:a,shapeId:null,gluepointId:null},i instanceof it.a&&(s.shapeId=i.name),i instanceof ct&&(s.shapeId=i.shapeId,s.gluepointId=i.gluePointId),this.container.onEndPointDrop(s.point,s.shapeId,s.gluepointId)},e}(le),ue=n("QagP"),pe=n("2Mvu"),he=n("3n3h"),de=n("R+ki"),fe=n("hX56"),be=n("55zG"),ge=n("qMyy"),ve=n("PeB7"),ye=n("kUiX"),me=function(t){function e(e,n,i,r,o,a,s,l){var c=t.call(this,e,s)||this;return c.commandService=e,c.ll=n,c.random=i,c.state=r,c.datastore=o,c.contextMenuController=a,c.vToDcoordinate=s,c.fileReceiver=l,c.endPointMoveThrottleTime=100,c}return o.d(e,t),e.prototype.initialize=function(e,n,i){var r=this,o=t.prototype.initialize.call(this,e,n,i),a=this.getShapePressMoveStart().pipe(Object(d.a)(function(t){r.hideComments(),r.selectShape(t)})),s=this.getShapeDrag().pipe(Object(d.a)(function(t){return r.interactionCanvas.dispatchEvent(t)})),l=this.getCanvasDrag(this.gridCanvas).pipe(Object(d.a)(function(t){return r.interactionCanvas.dispatchEvent(t)})),c=this.getStageMouseDown(this.gridCanvas).pipe(Object(p.a)(function(){return!r.state.get("EditingText").open}),Object(d.a)(function(t){r.hideComments(),r.selectShapes([])})),u=this.getSingleClickOnShape().pipe(Object(d.a)(function(t){r.handleSingleClickOnShape(t),r.selectShape(t)})),h=this.getCanvasDrop(this.interactionCanvas.canvas).pipe(Object(d.a)(function(t){return r.onDrop(t)}));return this.contextMenuController.registerEventSource("shape",this.getShapeRightClick()),this.contextMenuController.registerEventSource("stage",this.getStageRightClick(this.gridCanvas)),Object(q.a)(o,a,s,l,c,u,h,this.keepSelectionInViewport(),this.multiselectPanInteraction(),this.detectEndPointCollision())},Object.defineProperty(e.prototype,"defaultCursor",{get:function(){return{cursor:"default",tail:null,type:"css"}},enumerable:!0,configurable:!0}),e.prototype.hideComments=function(){this.state.set("CommentThreadData",{visible:!1})},e.prototype.getCursor=function(){var t=this;return this.getSelectionInteractionStartEnd().pipe(Object(M.a)(null),Object(I.a)(function(e){return e&&e.type===ht.start?Object(u.a)({cursor:"default",tail:null,type:"css"}):e&&e.type===oe.b.interactionStart?Object(u.a)({cursor:"default",tail:null,type:"css"}):t.getCursorByPosition()}),Object(A.a)(function(t,e){return t.cursor===e.cursor&&t.tail===e.tail}))},e.prototype.getSelectionInteractionStartEnd=function(){return Object(q.a)(Object(W.a)(this.interactionCanvas,oe.b.interactionStart),Object(W.a)(this.interactionCanvas,oe.b.interactionEnd),Object(W.a)(this.interactionCanvas,ht.start),Object(W.a)(this.interactionCanvas,ht.end))},e.prototype.getCursorByPosition=function(){var t=this,e=this.state.changes("Selected");return Object(q.a)(e.pipe(Object(T.a)(function(){return{x:t.interactionCanvas.getMouseX(),y:t.interactionCanvas.getMouseY()}})),this.pointerMove()).pipe(Object(T.a)(function(e){var n=["editor","normal"],i=t.getObjectsUnderPoint(e);return n.push.apply(n,o.j(t.getOnAndSelectedSubContexts(i))),t.getCursorByContext(i,n)}))},e.prototype.getOnAndSelectedSubContexts=function(t){var e=[],n=t.filter(function(t){return t.parent instanceof gt.a}).map(function(t){return t.parent});return n.forEach(function(t){!e.includes("onConnector")&&t.isConnectorView&&e.push("onConnector"),!e.includes("onShape")&&t.isShapeView&&e.push("onShape")}),n[0]&&this.isSelected(n[0].name)&&(e.push("selected"),this.state.get("Selected").length>1&&e.push("multiSelected")),e},e.prototype.isSelected=function(t){return this.state.get("Selected").findIndex(function(e){return e===t})>-1},e.prototype.keepSelectionInViewport=function(){var t=this,e=Object(W.a)(this.interactionCanvas,oe.b.interactionStart),n=Object(W.a)(this.interactionCanvas,oe.b.interactionEnd);return e.pipe(Object(I.a)(function(){return t.selectionHitsViewport().pipe(Object(Q.a)(n))}),Object(d.a)(function(e){var n=e.dx,i=e.dy;e.name,e.id,e.nativeEvent,e.bounds,e.type;t.dispatchPanCommand(n,i)}),Object(D.a)(20),Object(d.a)(function(e){e.dx,e.dy;var n=e.name,i=e.id,r=e.nativeEvent;e.bounds;e.type!==oe.b.interactionImmediate&&t.dispatchSimulatedInteraction(n,i,r)}))},e.prototype.multiselectPanInteraction=function(){var t=this,e=Object(W.a)(this.interactionCanvas,ht.start),n=Object(W.a)(this.interactionCanvas,ht.end);return e.pipe(Object(I.a)(function(){return t.multiSelectionHitsViewport().pipe(Object(Q.a)(n))}),Object(d.a)(function(e){var n=e.dx,i=e.dy;e.name,e.id,e.nativeEvent,e.bounds,e.type;t.dispatchPanCommand(n,i)}),Object(D.a)(20),Object(d.a)(function(e){e.dx,e.dy;var n=e.name,i=e.id,r=e.nativeEvent;e.bounds,e.type;t.dispatchSimulatedMultiSelectInt(n,i,r)}))},e.prototype.dispatchPanCommand=function(t,e){var n=this;Object(s.gb)(function(){return n.commandService.dispatch(vt.a.panDiagram,{dy:e,dx:t,animate:!1})})},e.prototype.dispatchSimulatedMultiSelectInt=function(t,e,n){var i=this.gridCanvas.getMouseX(),r=this.gridCanvas.getMouseY(),o=new rt.MouseEvent("stagemousemove",!1,!1,i,r,n,null,!0,i,r);o.data={isSimulated:!0};var a=new Ot("stageDragMove",o);this.interactionCanvas.dispatchEvent(a)},e.prototype.dispatchSimulatedInteraction=function(t,e,n){if("MoveInteraction"===t){var i=this.interactionCanvas.getMouseX(),r=this.interactionCanvas.getMouseY();(a=new rt.MouseEvent("stagemousemove",!1,!1,i,r,n,null,!0,i,r)).data={isSimulated:!0};var o=new Ct("shapeDragMove",a);o.relatedShape={name:e},this.interactionCanvas.dispatchEvent(o)}else{var a;i=this.interactionCanvas.mouseX,r=this.interactionCanvas.mouseY;(a=new rt.MouseEvent("stagemousemove",!1,!1,i,r,n,null,!0,i,r)).data={isSimulated:!0},this.interactionCanvas.dispatchEvent(a)}},e.prototype.multiSelectionHitsViewport=function(){var t=this;return Object(W.a)(this.interactionCanvas,ht.drag).pipe(Object(T.a)(function(e){var n=e.target.getTransformedBounds(),i=new s.R(n.x,n.y,n.width,n.height),r=e.relatedEvent.nativeEvent,o=t.getPanDeltaForMultiSelection(i,1,r),a=o.dx,l=o.dy;if(a||l)return{dx:a,dy:l,name:e.name,nativeEvent:r}}),Object(p.a)(function(t){return!!t}))},e.prototype.selectionHitsViewport=function(){var t=this,e=Object(W.a)(this.interactionCanvas,oe.b.interaction).pipe(Object(T.a)(function(e){return t.getDataFromInteractionEvent(e)}),Object(ue.a)(),Object(T.a)(function(e){var n=o.h(e,2),i=n[0],r=n[1];if(!r.isUserInteraction||JSON.stringify(i)!==JSON.stringify(r)){var a=t.getPanDelta(r.bounds,2),s=a.dx,l=a.dy;if(r.isUserInteraction){var c=t.isMovingOutside(i.bounds,r.bounds),u=c.x;l=c.y?l:0,s=u?s:0}return s||l?{dx:s,dy:l,name:r.name,id:r.id,nativeEvent:r.nativeEvent}:void 0}}),Object(p.a)(function(t){return!!t})),n=Object(W.a)(this.interactionCanvas,oe.b.interactionImmediate).pipe(Object(T.a)(function(e){var n=t.getDataFromInteractionEvent(e),i=n.id,r=n.nativeEvent,o=n.isUserInteraction,a=n.bounds,s=n.type,l=t.getPanDelta(a,10),c=l.dx,u=l.dy;if(o){var p=t.isMovingOutsideForKeys(e.relatedEvent.keyCode,a),h=p.x;u=p.y?u:0,c=h?c:0}if(c||u)return{dx:c,dy:u,name:name,id:i,isUserInteraction:o,nativeEvent:r,bounds:a,type:s}}),Object(p.a)(function(t){return!!t}));return Object(q.a)(e,n)},e.prototype.getDataFromInteractionEvent=function(t){var e=t.target,n=e.getTransformedBounds(),i=new s.R(n.x,n.y,n.width,n.height),r=null;"MoveInteraction"===t.interactionName&&(r=e.selectedIds[0]);var o=t.relatedEvent.nativeEvent,a=!t.relatedEvent.data||!t.relatedEvent.data.isSimulated;return{id:r,name:t.interactionName,type:t.type,nativeEvent:o,isUserInteraction:a,bounds:i}},e.prototype.getPanDelta=function(t,e){var n=this.state.get("DiagramViewPort"),i=t.y<n.top+10?e:0;i=t.bottom>n.bottom-10?-e:i;var r=t.x<n.left+10?e:0;return{dx:r=t.right>n.right-10?-e:r,dy:i}},e.prototype.getPanDeltaForMultiSelection=function(t,e,n){var i=0,r=0,o=this.state.get("DiagramViewPort");return n.movementY>0&&n.y>o.centerY&&(i=t.bottom>o.bottom-10?-e:0),n.movementY<0&&n.y<o.centerY&&(i=t.y<o.top+10?e:0),n.movementX>0&&n.x>o.centerX&&(r=t.right>o.right-10?-e:0),n.movementX<0&&n.x<o.centerX&&(r=t.x<o.left+10?e:0),{dx:r,dy:i}},e.prototype.isMovingOutside=function(t,e){var n=this.state.get("DiagramViewPort");return{x:Math.abs(n.centerX-t.centerX)<Math.abs(n.centerX-e.centerX),y:Math.abs(n.centerY-t.centerY)<Math.abs(n.centerY-e.centerY)}},e.prototype.isMovingOutsideForKeys=function(t,e){var n=this.state.get("DiagramViewPort");return t===l.e.ArrowUp?{x:!1,y:n.centerY>e.centerY}:t===l.e.ArrowDown?{x:!1,y:n.centerY<e.centerY}:t===l.e.ArrowLeft?{x:n.centerX>e.centerX,y:!1}:t===l.e.ArrowRight?{x:n.centerX<e.centerX,y:!1}:void 0},e.prototype.getDoubleClickOnShape=function(){var t=this;return this.getShapes().pipe(Object(J.a)(function(e){return Object(W.a)(e,"dblclick").pipe(Object(Q.a)(Object(W.a)(t.diagramCanvas,"childRemoved").pipe(Object(p.a)(function(t){return t.child===e}))))}),Object(T.a)(function(t){return t}))},e.prototype.getSingleClickOnShape=function(){var t=this;return this.getShapes().pipe(Object(J.a)(function(e){return Object(W.a)(e,"mousedown").pipe(Object(I.a)(function(){return Object(W.a)(e,"pressup").pipe(Object(Q.a)(Object(W.a)(e,"pressmove")))}),Object(Q.a)(Object(W.a)(t.diagramCanvas,"childRemoved").pipe(Object(p.a)(function(t){return t.child===e}))))}),Object(T.a)(function(t){return t}))},e.prototype.getShapePressMoveStart=function(){var t=this;return this.getShapes().pipe(Object(J.a)(function(e){return Object(W.a)(e,"mousedown").pipe(Object(I.a)(function(){return Object(W.a)(e,"pressmove").pipe(Object(h.a)(1))}),Object(Q.a)(Object(W.a)(t.diagramCanvas,"childRemoved").pipe(Object(p.a)(function(t){return t.child===e}))))}),Object(T.a)(function(t){return t}))},e.prototype.handleSingleClickOnShape=function(t){if(2!==t.nativeEvent.button&&!this.state.get("PlusCreateState").inProgress){var e,n,i;if(t.target instanceof yt.a){var r=t.target;e=r.name,i=r.parent.name}else i=t.target.name;n={x:t.localX,y:t.localY},this.state.get("Selected").includes(i)&&this.openTextEditor(i,e,n)}},e.prototype.openTextEditor=function(t,e,n){var i=this.state.get("EditingText");!0===i.open&&(i.open=!1,this.commandService.dispatch(R.a.openTextEditor,i)),this.commandService.dispatch(R.a.openTextEditor,{open:!0,textId:e,point:n,shapeId:t})},e.prototype.getShapeDrag=function(){var t=this,e=Object(W.a)(this.interactionCanvas,"stagemouseup").pipe(Object(h.a)(1));return this.getShapes().pipe(Object(J.a)(function(n){return Object(W.a)(n,"mousedown").pipe(Object(I.a)(function(n){return Object(q.a)(Object(W.a)(t.interactionCanvas,"stagemousemove").pipe(Object(Q.a)(e)),e).pipe(Object(T.a)(function(t){var e="stagemousemove"===t.type?"shapeDragMove":"shapeDragEnd",i=new Ct(e,n);return i.relatedMouseEvent=t,i}))}),Object(Q.a)(Object(W.a)(t.diagramCanvas,"childRemoved").pipe(Object(p.a)(function(t){return t.child===n}))))}))},e.prototype.selectShape=function(t){var e=t.nativeEvent.metaKey||t.nativeEvent.shiftKey||t.nativeEvent.ctrlKey;this.selectShapes([t.currentTarget.name],e)},e.prototype.selectShapes=function(t,e){this.commandService.dispatch(ge.a.selectShapes,this.state.get("CurrentDiagram"),{shapeIds:t,add:e})},e.prototype.getCanvasDrag=function(t){var e=Object(W.a)(t,"mousedown").pipe(Object(T.a)(function(t){return new Ot("stageDragStart",t)})),n=Object(W.a)(t,"pressup").pipe(Object(T.a)(function(t){return new Ot("stageDragEnd",t)})),i=Object(W.a)(t,"pressmove").pipe(Object(T.a)(function(t){return new Ot("stageDragMove",t)})),r=Object(W.a)(t,"click").pipe(Object(T.a)(function(t){return new Ot("stageDragEnd",t)}));return e.pipe(Object(I.a)(function(t){return Object(q.a)(i.pipe(Object(M.a)(t),Object(Q.a)(n)),i.pipe(Object(pe.a)(),Object(he.a)(n)),r)}))},e.prototype.getCanvasDrop=function(t){var e=Object(W.a)(t,"dragenter").pipe(Object(d.a)(function(t){return t.preventDefault()})),n=Object(W.a)(t,"dragover").pipe(Object(d.a)(function(t){return t.preventDefault()})),i=Object(W.a)(t,"drop").pipe(Object(d.a)(function(t){return t.preventDefault()}));return e.pipe(Object(he.a)(Object(q.a)(n.pipe(Object(p.a)(function(){return!1})),i.pipe(Object(h.a)(1)))))},e.prototype.onDrop=function(t){var e=t.dataTransfer;e.getData("Text")?this.onTextDrop(t):e.files&&e.files.length>0&&this.onFileDrop(e.files)},e.prototype.onTextDrop=function(t){var e=JSON.parse(t.dataTransfer.getData("Text"));s.bb.track("left.library.shape.drop",{value1Type:"defId",value1:e.defId}),"template"===e.type?this.addTemplate(e,t.offsetX,t.offsetY):this.addShape(e,t.offsetX,t.offsetY)},e.prototype.onFileDrop=function(t){if(t&&!(t.length<1)){for(var e=[],n=0;n<t.length;n++)e.push(new ve.a(t[n]));this.fileReceiver.receiveFiles(e).subscribe()}},e.prototype.addShape=function(t,e,n){var i,r={id:s.O.shapeId(),defId:t.defId,version:t.version,x:this.vToDcoordinate.x(e),y:this.vToDcoordinate.y(n)};this.commandService.dispatch(R.a.addDiagramShape,{shapes:(i={},i[r.id]=r,i)})},e.prototype.addTemplate=function(t,e,n){var i=this,r=t.defId+":"+t.version;Object(St.a)(this.commandService.dispatch(R.a.getTemplate,t.diagram,{templateId:r}),Object(xt.a)(function(){return i.datastore.findOneLatest(be.a,{id:r}).pipe(Object(I.a)(function(t){var r=t.clone({x:i.vToDcoordinate.x(e),y:i.vToDcoordinate.y(n)});return i.commandService.dispatch(R.a.addDiagramShape,{cloned:!0,shapes:r.shapes,groups:r.groups,connections:r.connections})}))})).subscribe()},e.prototype.detectEndPointCollision=function(){var t=this;return Object(W.a)(this.interactionCanvas,oe.b.interactionStart).pipe(Object(p.a)(function(t){return t.interactionName===ce.prototype.name}),Object(d.a)(function(e){return t.handleEndPointMoveStart(e)}),Object(I.a)(function(){return Object(W.a)(t.interactionCanvas,oe.b.interaction).pipe(Object(p.a)(function(t){return t.interactionName===ce.prototype.name}),Object(de.a)(t.endPointMoveThrottleTime),Object(d.a)(function(e){return t.handleEndPointMove(e)}),Object(Q.a)(Object(q.a)(Object(W.a)(t.interactionCanvas,oe.b.interactionEnd),Object(W.a)(t.interactionCanvas,oe.b.interactionCancel)).pipe(Object(p.a)(function(t){return t.interactionName===ce.prototype.name}),Object(d.a)(function(e){return t.handleEndPointMoveEnd(e)}))))}))},e.prototype.handleEndPointMoveStart=function(t){this.endPointCollision=new jt,this.endPointCollisionChildren=this.diagramCanvas.children.filter(function(t){return t.isShapeView})},e.prototype.handleEndPointMove=function(t){var e,n=this.createFilterByMousePosition(t),i=this.interactionCanvas.children.filter(function(t){return t instanceof ct&&n(t)});if(i.length>0&&(e=this.endPointCollision.getColliding(i,t.handle))&&e.length>0){var r=e[e.length-1];this.fireEndPointHoverEvent(t.handle,r)}else if((e=this.endPointCollision.getColliding(this.endPointCollisionChildren,t.handle))&&e.length>0){r=e[e.length-1];this.fireEndPointHoverEvent(t.handle,r)}else this.fireEndPointHoverEvent(t.handle)},e.prototype.createFilterByMousePosition=function(t){var e=t.relatedEvent,n=e.stageX,i=e.stageY,r=new s.M(n,i),o=t.handle.getBounds().width/2;return function(t){return r.distanceTo(t)<o+t.radius}},e.prototype.fireEndPointHoverEvent=function(t,e){if(this.endPointOverShape!==e){var n=this.endPointOverShape;e?(this.endPointOverShape=e,this.dispatchEndPointHoverEvent(ft.over,t,e)):this.endPointOverShape=void 0,n&&this.dispatchEndPointHoverEvent(ft.out,t,n)}},e.prototype.dispatchEndPointHoverEvent=function(t,e,n){n.stage===this.interactionCanvas?n.dispatchEvent(new Et(t,e,n)):this.interactionCanvas.dispatchEvent(new Et(t,e,n))},e.prototype.handleEndPointMoveEnd=function(t){this.endPointOverShape&&this.fireEndPointHoverEvent(t.handle),this.endPointOverShape=void 0,this.endPointCollision=void 0,this.endPointCollisionChildren=void 0},e.prototype.destroy=function(){t.prototype.destroy.call(this),this.contextMenuController.unregisterEventSource("shape"),this.contextMenuController.unregisterEventSource("stage")},e}(nt.a);Object.defineProperty(me,"name",{value:"EditorInteractionHandler"});var Oe,Se=n("fQLH"),xe=n("diMa"),Ce=n("7XY+"),Pe=n("wx9+"),we=n("HnWI"),Ee=n("LR82"),je=n("ZJHl"),Ie=function(){function t(t){this.handler=t,this.rules={},this.operations={}}return t.prototype.define=function(t,e){var n=this.getActionMethodName(t);if(!this.handler[n])throw Error("AsyncActionController: The handler object should contain a function named "+n+" of type AsyncActionFunction to define the action "+t);if(e||(e={}),e.queuesTo)throw Error("AsyncActionController: queuing operations are not implemented");this.rules[t]=e},t.prototype.run=function(t){for(var e,n=this,i=[],r=1;r<arguments.length;r++)i[r-1]=arguments[r];if(!this.rules[t])throw Error('AsyncActionController: the action "'+t+'" has not been defined. Please define before use.');this.rules[t].cancels&&this.rules[t].cancels.forEach(function(t){return n.cancelOperation(t)});var a=this.getActionMethodName(t),s=(e=this.handler)[a].apply(e,o.j(i));return this.addOperation(t,s)},t.prototype.getActionMethodName=function(t){return"run"+t.substr(0,1).toUpperCase()+t.substr(1)},t.prototype.addOperation=function(t,e){var n=this,i=(Array.isArray(e)?e:[e]).map(function(e){if(e instanceof at.a)return n.instertOperation(t,e),(r=e.changes().pipe(Object(d.a)({complete:function(){return n.removeOperation(t,e)}}),Object(je.a)())).connect(),r;if(e instanceof we.a){var i,r=e.pipe(Object(d.a)({complete:function(){return n.removeOperation(t,i)}}),Object(je.a)());return i=r.connect(),n.instertOperation(t,i),r}throw Error('AsyncActionController: the function for action "'+t+'" returned an invalid value. action functions must return AsyncOperation type')});return q.a.apply(void 0,o.j(i))},t.prototype.cancelOperation=function(t){if(this.operations[t]){for(var e=this.operations[t];e.length;){var n=e.pop();n instanceof at.a?n.cancel():n instanceof Ee.a&&n.unsubscribe()}delete this.operations[t]}},t.prototype.instertOperation=function(t,e){this.operations[t]||(this.operations[t]=[]),this.operations[t].push(e)},t.prototype.removeOperation=function(t,e){if(this.operations[t]){var n=this.operations[t],i=n.indexOf(e);i>=0&&(1===n.length?delete this.operations[t]:n.splice(i,1))}},t}(),Te=n("0fSw"),Me=n("19Zn"),De=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.defaultWidth=30,e.defaultHeight=30,e.hitAreaWidth=20,e.hitAreaHeight=20,e.backgroundColor="rgba( 255, 255, 255, 0.9 )",e.backgroundColorHover="#FFFFFF",e.iconColor="#627281",e.iconColorHover="#ED963E",e}return o.d(e,t),e.prototype.initialize=function(){return this.drawHitArea(),this.drawButton(!1)},e.prototype.getCursor=function(t){return{cursor:"pointer",tail:null,type:"css"}},e.prototype.drawButton=function(t){return this.graphics.clear(),this.drawBackground(t),this.drawIcon(t)},e.prototype.drawIcon=function(t){return this.graphics.beginStroke(t?this.iconColorHover:this.iconColor),this.graphics.setStrokeStyle(2,"round"),this.graphics.moveTo(-3,0).lineTo(3,0).moveTo(0,-3).lineTo(0,3),this.graphics.endStroke(),Object(ot.b)()},e.prototype.drawBackground=function(t){this.graphics.beginFill(t?this.backgroundColorHover:this.backgroundColor),this.graphics.beginStroke("#dcdcdc"),this.graphics.setStrokeStyle(1),this.graphics.drawCircle(0,0,8),this.graphics.endStroke(),this.graphics.endFill()},e.prototype.drawHitArea=function(){var t=new rt.Shape;t.graphics.beginFill("black"),t.graphics.drawRect(-this.hitAreaWidth/2,-this.hitAreaHeight/2,this.hitAreaWidth,this.hitAreaHeight),t.graphics.endFill(),this.hitArea=t},e}(rt.Shape),Ae=function(t){function e(e,n){void 0===n&&(n=!1);var i=t.call(this)||this;return i.def=e,i.primary=n,i.hitAreaWidth=40,i.hitAreaHeight=40,i}return o.d(e,t),e.prototype.drawIcon=function(t){var e=this;return this.graphics.beginStroke(t?this.iconColorHover:this.iconColor),this.graphics.setStrokeStyle(2,"round"),Me.v.instance.renderThumbnail(this.graphics,this.def.defId,this.def.version,new s.R(-8,-8,17,17)).pipe(Object(d.a)({complete:function(){return e.graphics.endStroke()}}))},e.prototype.drawBackground=function(t){this.graphics.beginFill(t?this.backgroundColorHover:this.backgroundColor),this.graphics.beginStroke("#dcdcdc"),this.graphics.setStrokeStyle(1,"round"),this.graphics.drawCircle(0,0,14),this.graphics.endFill()},e}(De),ke=n("RtDN"),Le=function(t){function e(){var e=t.call(this)||this;return e.verticalGap=10,e.horizontalGap=10,e.padding=.2,e.displacement=20,e}return o.d(e,t),e.prototype.getPositions=function(t,e){var n=this,i=o.j([[{x:1,y:0}],[{x:0,y:-1},{x:0,y:1}],[{x:1,y:0},{x:0,y:-1},{x:0,y:1}],[{x:0,y:-1},{x:0,y:1},{x:0,y:-2},{x:0,y:2}],[{x:1,y:0},{x:0,y:-1},{x:0,y:1},{x:0,y:-2},{x:0,y:2}],[{x:1,y:-.5},{x:1,y:.5},{x:0,y:-1},{x:0,y:1},{x:0,y:-2},{x:0,y:2}],[{x:1,y:0},{x:0,y:-1},{x:0,y:1},{x:1,y:-1},{x:1,y:1},{x:0,y:-2},{x:0,y:2}],[{x:1,y:-.5},{x:1,y:.5},{x:0,y:-1},{x:0,y:1},{x:1,y:-1.5},{x:1,y:1.5},{x:0,y:-2},{x:0,y:2}],[{x:1,y:0},{x:0,y:-1},{x:0,y:1},{x:1,y:-1},{x:1,y:1},{x:1,y:-2},{x:1,y:2},{x:0,y:-2},{x:0,y:2}]][t]);return i.map(function(t){n.updatePointDirection(t,e)}),i},e.prototype.updatePointDirection=function(t,e){if("left"===e&&(t.x=-1*t.x,t.x-=this.padding),"right"===e&&(t.x+=this.padding),"bottom"===e){var n=t.x;t.x=t.y,t.y=n,t.y+=this.padding}if("top"===e){var i=t.y;t.y=-1*t.x,t.x=i,t.y-=this.padding}},e.prototype.getPaddedPointsPrimary=function(t,e){return"left"===e&&(t.x=-1*(1-this.padding)*this.horizontalGap),"right"===e&&(t.x=(1-this.padding)*this.horizontalGap),"bottom"===e&&(t.y=(1-this.padding)*this.verticalGap),"top"===e&&(t.y=-1*(1-this.padding)*this.verticalGap),t},e.prototype.position=function(t){var e=this;if(!(this.cluster.length<2)){var n=this.getPositions(this.cluster.length-2,t),i=0;this.cluster.forEach(function(r){if(r.primary){var o=e.getPaddedPointsPrimary({x:r.x,y:r.y},t);r.x=o.x,r.y=o.y}else{var a=n[i];r.x=a.x*(e.horizontalGap+r.defaultWidth),r.y=a.y*(e.verticalGap+r.defaultHeight),i++}e.displace(t,r)})}},e.prototype.displace=function(t,e){"left"===t&&(e.x-=this.displacement),"right"===t&&(e.x+=this.displacement),"bottom"===t&&(e.y+=this.displacement),"top"===t&&(e.y-=this.displacement)},e}(function(t){function e(){var e=t.call(this)||this;return e.delay=300,e.childAlpha=0,e.alpha=0,e.subs=[],e._actionEmitter=new Se.a,e._animationEmitter=new Se.a,e}return o.d(e,t),e.prototype.getCursor=function(t){return{cursor:"pointer",tail:null,type:"css"}},e.prototype.addShape=function(t,e){var n=this;if(!t.create.defs||!t.create.defs.length)throw Error("Model must have at lease one definition in the create options to create a PlusCreateButton");this.plus=new De,this.plus.initialize(),this.addChild(this.plus),this.cluster=t.create.defs.map(function(e,i){var r=n.createOptionButton(e,t.create.primary===i);return r.initialize().subscribe(),r.alpha=0,n.subs.push(Object(W.a)(r,"mousedown").subscribe(function(){return n._actionEmitter.next(r)})),n.subs.push(n.mouseRollEvents(r).pipe(Object(I.a)(function(t){return r.drawButton(t).pipe(Object(ke.a)(!0))})).subscribe(function(){return n._animationEmitter.next(n)})),r}),this.subs.push(this.mouseRollEvents(this).pipe(Object(I.a)(function(t){return t?Object(u.a)({}).pipe(Object(D.a)(n.delay),Object(I.a)(function(){return n.expand(e)})):n.retract()})).subscribe()),this.setVisibility(this,1)},e.prototype.removeShape=function(){this.setVisibility(this,0)},e.prototype.show=function(){this.setVisibility(this,1)},e.prototype.hide=function(){this.setVisibility(this,0)},e.prototype.expand=function(t){return this.showCluster(t)},e.prototype.retract=function(){return this.hideCluster()},e.prototype.showCluster=function(t){var e=this;return this.cluster.forEach(function(t){e.addChild(t)}),this.position(t),this.updateClusterAlpha(1),Object(ot.b)()},e.prototype.hideCluster=function(){var t=this;return this.updateClusterAlpha(0),this.cluster.forEach(function(e){t.removeChild(e)}),Object(ot.b)()},e.prototype.updateClusterAlpha=function(t){this.childAlpha=t,this.plus.alpha=1-t,this.cluster.forEach(function(e){e.alpha=t}),this._animationEmitter.next(this)},e.prototype.mouseRollEvents=function(t){return Object(q.a)(Object(W.a)(t,"rollover").pipe(Object(lt.a)(!0)),Object(W.a)(t,"rollout").pipe(Object(lt.a)(!1)))},Object.defineProperty(e.prototype,"actionEmitter",{get:function(){return this._actionEmitter},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"animationEmitter",{get:function(){return this._animationEmitter},enumerable:!0,configurable:!0}),e.prototype.setVisibility=function(t,e){t.alpha=e},e.prototype.createOptionButton=function(t,e){return new Ae(t,e)},e.prototype.addSubscription=function(){for(var t,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];(t=this.subs).push.apply(t,o.j(e))},e.prototype.destroy=function(){for(;this.subs.length;)this.subs.pop().unsubscribe();for(;this.cluster.length;){var t=this.cluster.pop();this.removeChild(t)}this.removeChild(this.plus),this.plus=null},e}(rt.Container));!function(t){t[t.None=0]="None",t[t.Visible=1]="Visible",t[t.Showing=2]="Showing",t[t.Hidden=3]="Hidden",t[t.Hiding=4]="Hiding"}(Oe||(Oe={}));var Fe=function(t){function e(e,n,i,r,o,a){var s=t.call(this,e)||this;return s.stateService=e,s.commandService=n,s.viewport=i,s.vToDcoordinate=r,s.toolbarManager=o,s.ll=a,s.status=Oe.None,s.addSource=new Se.a,s.changeSource=new Se.a,s.removeSource=new Se.a,s.asyncActions=new Ie(s),s}return o.d(e,t),Object.defineProperty(e.prototype,"locator",{get:function(){return this.ll.forCurrent(!1)},enumerable:!0,configurable:!0}),e.prototype.initialize=function(){var t=this;this.defineAsyncActions();var e=this.duringSelectionChange().pipe(Object(I.a)(function(e){if("add"===e.action){var n=[e];return t.status!==Oe.Visible&&t.status!==Oe.Showing||n.unshift({action:"remove"}),u.a.apply(void 0,o.j(n)).pipe(Object(Ce.a)(Object(q.a)(t.duringInteractions({action:"show"},{action:"hide"}),t.duringShapeChange(e.model.id))))}return Object(u.a)(e)})).subscribe(function(e){return t.asyncActions.run(e.action,e)});this.subs.push(e)},e.prototype.defineAsyncActions=function(){this.asyncActions.define("add",{cancels:["add","show","hide","change","remove"]}),this.asyncActions.define("change",{completes:["add"],ignoresTo:["remove"]}),this.asyncActions.define("remove",{cancels:["add","show","hide","change"],ignoresTo:["remove"]}),this.asyncActions.define("show",{cancels:["show","hide"],ignoresTo:["add","remove"]}),this.asyncActions.define("hide",{cancels:["show","hide","add"],ignoresTo:["remove"]})},e.prototype.duringSelectionChange=function(){var t=this;return this.stateService.changes("Selected").pipe(Object(I.a)(function(e){return e&&1===e.length?t.viewport.getShapeOnce(e[0]):Object(u.a)(null)}),Object(T.a)(function(t){return t&&t.create?{action:"add",model:t}:{action:"remove"}}))},e.prototype.duringShapeChange=function(t){return this.viewport.getShapeChanges(t).pipe(Object(p.a)(function(t){return t.model&&s.K.hasChanges(t.modifier,"x")||s.K.hasChanges(t.modifier,"y")||s.K.hasChanges(t.modifier,"scaleX")||s.K.hasChanges(t.modifier,"scaleY")||s.K.hasChanges(t.modifier,"angle")}),Object(T.a)(function(t){return{action:"change",model:t.model}}))},e.prototype.duringInteractions=function(e,n){var i=this;return t.prototype.duringInteractions.call(this,e,n).pipe(Object(I.a)(function(t){return i.model&&"show"===t.action?i.viewport.getShapeOnce(i.model.id).pipe(Object(T.a)(function(e){return t.model=e,t})):Object(u.a)(t)}))},Object.defineProperty(e.prototype,"indicators",{get:function(){return Object(c.values)(this.buttonClusters)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"contextualToolbar",{get:function(){return this.toolbarManager.get("contextual-toolbar")},enumerable:!0,configurable:!0}),e.prototype.createAddSource=function(){return this.addSource},e.prototype.createRemoveSource=function(){return this.removeSource},e.prototype.createChangeSource=function(){return this.changeSource},e.prototype.runAdd=function(t){if(!t.model)throw Error('Plus Create: Shape model was not provided for the "add" action');return this.model=t.model,this.setup(),this.position(),Object(ot.b)()},e.prototype.runChange=function(t){var e=this;if(!t.model)throw Error('Plus Create: Shape model was not provided for the "change" action');return this.hasModelDefChanged(this.model,t.model)?Object(ot.b)(xe.a).pipe(Object(Ce.a)(Object(xt.a)(function(){return e.asyncActions.run("remove",{action:"remove"})}),Object(xt.a)(function(){return e.asyncActions.run("add",{action:"add",model:t.model})}))):(this.model=t.model,this.position(),Object(ot.b)())},e.prototype.runRemove=function(t){var e=this;return this.status=Oe.Hiding,Object(c.values)(this.buttonClusters).map(function(t){t.removeShape(),e.changeSource.next(t)}),this.clear(),Object(ot.b)()},e.prototype.runShow=function(t){var e=this;return this.status===Oe.Showing||this.status===Oe.Visible?Object(ot.b)():(t&&t.model&&(this.model=t.model),Object(c.values)(this.buttonClusters).map(function(t){t.show(),e.changeSource.next(t)}),this.position(),this.status=Oe.Visible,Object(ot.b)())},e.prototype.runHide=function(t){var e=this;return this.status===Oe.Hiding||this.status===Oe.Hidden?Object(ot.b)():(Object(c.values)(this.buttonClusters).map(function(t){t.hide(),e.changeSource.next(t)}),this.status=Oe.Hidden,Object(ot.b)())},e.prototype.hasModelDefChanged=function(t,e){return t.defId!==e.defId||t.version!==e.version},e.prototype.setup=function(){var t=this;this.status=Oe.Showing,this.buttonClusters={};["right","left","top","bottom"].map(function(e){return t.addButton(e,"directional")}),this.changeSource.next({}),this.status=Oe.Visible},e.prototype.addButton=function(t,e){var n=this,i=this.createButton(e);i.addShape(this.model,t),this.buttonClusters[t]=i,this.addSource.next(i),i.addSubscription(i.actionEmitter.subscribe(function(t){return n.dispatchPlusCreate(t.def)}),i.animationEmitter.subscribe(function(t){return n.changeSource.next(t)}),Object(q.a)(Object(W.a)(i,"rollover").pipe(Object(lt.a)("hide")),Object(W.a)(i,"rollout").pipe(Object(lt.a)("show"))).pipe(Object(I.a)(function(t){return n.contextualToolbar[t](!0)})).subscribe())},e.prototype.createButton=function(t){if("directional"===t)return new Le},e.prototype.position=function(){var t=this.buttonClusters.right,e=s.N.onRect({x:{type:"fixed-end",value:-2},y:{type:"relative",value:.5}},this.model.defaultBounds,this.model.transform);t.x=e.x,t.y=e.y;var n=this.buttonClusters.left,i=s.N.onRect({x:{type:"fixed-start",value:-2},y:{type:"relative",value:.5}},this.model.defaultBounds,this.model.transform);n.x=i.x,n.y=i.y;var r=this.buttonClusters.top,o=s.N.onRect({x:{type:"relative",value:.5},y:{type:"fixed-start",value:-2}},this.model.defaultBounds,this.model.transform);r.x=o.x,r.y=o.y;var a=this.buttonClusters.bottom,l=s.N.onRect({x:{type:"relative",value:.5},y:{type:"fixed-end",value:-2}},this.model.defaultBounds,this.model.transform);a.x=l.x,a.y=l.y},e.prototype.clear=function(){var t=this;this.status=Oe.None,Object(c.values)(this.buttonClusters).forEach(function(e){return t.removeSource.next(e)}),this.model=void 0,this.buttonClusters=void 0},e.prototype.dispatchPlusCreate=function(t){var e=this,n=t.defId,i=t.version,r=t.connect;s.bb.track("canvas.shape.plusCreate.click",{value1Type:"currShapeId",value1:this.model.id,value2Type:"nextShapeId",value2:n}),this.locator.getShapeOnce(this.model.id).subscribe(function(t){var o={defId:n,version:i,id:s.O.shapeId(),x:e.vToDcoordinate.x(e.indicatorLayer.getMouseX())-e.model.defaultBounds.width/2,y:e.vToDcoordinate.y(e.indicatorLayer.getMouseY())-e.model.defaultBounds.height/2,center:!0,style:JSON.parse(JSON.stringify(t.style))};r?(o.points=[{id:s.O.pointId(),x:0,y:0,shapeId:e.model.id},{id:s.O.pointId(),x:0,y:0,shapeId:o.id}],e.commandService.dispatch(R.a.plusCreateConnectAndMove,o)):e.commandService.dispatch(R.a.plusCreateAndMove,o)})},e=o.c([Object(k.a)(),o.f("design:paramtypes",[s.Z,s.q,Pe.a,$.a,Te.a,f.a])],e)}(k.b),He=function(t){function e(e,n,i,r,o){var a=t.call(this,e,o)||this;return a.commandService=e,a.ll=n,a.random=i,a.state=r,a.vToDcoordinate=o,a}return o.d(e,t),e.prototype.initialize=function(e,n,i){var r=this,o=t.prototype.initialize.call(this,e,n,i),a=this.getAllCanvasMouseCapture().pipe(Object(d.a)(function(t){return t.stopPropagation()}),Object(p.a)(function(t){return"mousedown"===t.type}),Object(d.a)(function(t){return r.state.set("MouseControlState",m.b.Normal),r.addTextObject(t)}));return Object(q.a)(o,a)},e.prototype.addTextObject=function(t){var e,n=this.random.shapeId(),i={shapes:(e={},e[n]={id:n,defId:"creately.basic.text",version:"1",x:this.vToDcoordinate.x(t.nativeEvent.offsetX),y:this.vToDcoordinate.y(t.nativeEvent.offsetY)},e)};this.commandService.dispatch(R.a.addDiagramShape,i)},Object.defineProperty(e.prototype,"defaultCursor",{get:function(){return{cursor:"text",tail:null,type:"css"}},enumerable:!0,configurable:!0}),e}(nt.a);Object.defineProperty(He,"name",{value:"TextInteractionHandler"});var Re=n("iim9"),Be=n("LiEJ"),Ne=n("3riI"),_e=n("iJR/"),Ge=n("AqJ0"),Ve=n("cGAd"),Ye=n("TZl/"),Ue=function(t){function e(e,n,i){var r=t.call(this,e)||this;return r.commandService=n,r.viewport=i,r.customGluepoint=null,r._shapes={},r.addSource=new Se.a,r.changeSource=new Se.a,r.removeSource=new Se.a,r.isPreviewingConnect=new Be.a(!1),r}var n;return o.d(e,t),n=e,e.prototype.initialize=function(){var t=this;this.subs.push(this.listenToStates().subscribe(function(e){return t.changeShapes(e)}))},e.prototype.listenToStates=function(){var t=this;return this.state.changes("MouseControlState").pipe(Object(I.a)(function(e){return e===m.b.Connector?t.duringConnectorControlState():e===m.b.Normal?t.duringNormalControlState():Object(u.a)({})}))},e.prototype.duringConnectorControlState=function(){var t=Object(W.a)(this.indicatorLayer,"shapeRollOver").pipe(Object(p.a)(function(t){return t.relatedShape.isShapeView}),Object(T.a)(function(t){return{shapeId:t.relatedShape.name,visibility:"show"}})),e=Object(W.a)(this.indicatorLayer,"shapeRollOut").pipe(Object(p.a)(function(t){return t.relatedShape.isShapeView}),Object(T.a)(function(t){return{shapeId:t.relatedShape.name,visibility:"hide"}}));return Object(q.a)(t,e)},e.prototype.duringNormalControlState=function(){var t=this;return this.duringConnectorSelection().pipe(Object(I.a)(function(e){return e?t.duringEndPointMovement(e):Object(u.a)({})}))},e.prototype.duringConnectorSelection=function(){var t=this,e=Object(q.a)(Object(W.a)(this.indicatorLayer,oe.b.interactionEnd),Object(W.a)(this.indicatorLayer,oe.b.interactionCancel));return Object(q.a)(this.state.changes("Selected"),e.pipe(Object(D.a)(0),Object(T.a)(function(){return t.state.get("Selected")}))).pipe(Object(I.a)(function(e){return 1===e.length?t.getConnectorModel(e[0]):Object(u.a)(null)}))},e.prototype.getConnectorModel=function(t,e){void 0===e&&(e=!0);var n=this.viewport.getShapeModel(t);return e&&(n=n.pipe(Object(h.a)(1))),n.pipe(Object(T.a)(function(t){return t instanceof kt.a?t:null}))},e.prototype.duringEndPointMovement=function(t){var e=this,n=this.getEndpointInteraction().pipe(Object(Ge.a)(1));return Object(St.a)(Object(Ne.b)(this.getConnectorModel(t.id,!1),this.isPreviewingConnect).pipe(Object(p.a)(function(t){var e=o.h(t,2);e[0];return!e[1]}),Object(I.a)(function(t){var n=o.h(t,1)[0];return Object(St.a)(Object(u.a)({}),e.shapesAttachedToConnector(n))}),Object(Q.a)(n)),n)},e.prototype.getEndpointInteraction=function(){return Object(q.a)(this.getEndpointInteractionStart(),this.getEndpointOverInteraction(),this.getEndpointOutInteraction(),this.getCustomGluepointInteraction())},e.prototype.getEndpointInteractionStart=function(){return Object(W.a)(this.indicatorLayer,oe.b.interactionStart).pipe(Object(T.a)(function(){return{}}))},e.prototype.getEndpointOverInteraction=function(){var t=this;return Object(W.a)(this.indicatorLayer,ft.over).pipe(Object(T.a)(function(e){return t.onEndPointOver(e)}),Object(p.a)(function(t){return!!t}))},e.prototype.getEndpointOutInteraction=function(){var t=this;return Object(W.a)(this.indicatorLayer,ft.out).pipe(Object(T.a)(function(e){return t.onEndPointOut(e)}),Object(p.a)(function(t){return!!t}))},e.prototype.getCustomGluepointInteraction=function(){var t=this;return Object(W.a)(this.indicatorLayer,ft.over).pipe(Object(I.a)(function(e){return Object(St.a)(Object(q.a)(Object(u.a)(e),Object(W.a)(t.indicatorLayer,oe.b.interaction)).pipe(Object(I.a)(function(i){return Object(St.a)(Object(u.a)(t.onEndPointHoverEnd(e)),Object(u.a)(i).pipe(Object(D.a)(n.CUSTOM_HOVER_TIMEOUT),Object(T.a)(function(){return i.targetOver=e.targetOver,t.onEndPointHover(i)})))}),Object(p.a)(function(t){return!!t}),Object(Q.a)(Object(W.a)(t.indicatorLayer,ft.out))),Object(u.a)(t.onEndPointHoverEnd(e)))}))},e.prototype.onEndPointOver=function(t){if(t.targetOver instanceof gt.a)return{shapeId:t.targetOver.name,visibility:"showOne",expandOn:"endpoint"}},e.prototype.onEndPointOut=function(t){if(t.targetOver instanceof gt.a)return{shapeId:t.targetOver.name,visibility:"hide"}},e.prototype.onEndPointHover=function(t){if(t.targetOver instanceof gt.a){var e={x:t.currentTarget.mouseX,y:t.currentTarget.mouseY};return{shapeId:t.targetOver.name,visibility:"create",mousePosition:e}}},e.prototype.onEndPointHoverEnd=function(t){return{shapeId:t.targetOver.name,visibility:"remove"}},e.prototype.shapesAttachedToConnector=function(t){var e=[];return t.fromEndpoint.shape&&t.fromEndpoint.gluepoint&&e.push(this.getChangeForShape(t.fromEndpoint)),t.toEndpoint.shape&&t.toEndpoint.gluepoint&&e.push(this.getChangeForShape(t.toEndpoint)),Object(_e.a)(e)},e.prototype.getChangeForShape=function(t){var e=t.shape,n=Object.keys(e.gluepoints).filter(function(e){return e!==t.gluepoint.id});return{visibility:"show",shapeId:e.id,gluePointIds:n,connectOnMouse:!0}},Object.defineProperty(e.prototype,"indicators",{get:function(){return Object(c.flatten)(Object(c.values)(this._shapes).map(function(t){return t.gluePoints}))},enumerable:!0,configurable:!0}),e.prototype.createAddSource=function(){return this.addSource},e.prototype.createRemoveSource=function(){return this.removeSource},e.prototype.createChangeSource=function(){return this.changeSource},e.prototype.changeShapes=function(t){"show"===t.visibility||"showOne"===t.visibility?(this.addGluePointsFor(t.shapeId,t.gluePointIds,t.expandOn,t.connectOnMouse),this.setShapeActive(t.shapeId,!0),"showOne"===t.visibility&&this.removeAllGluePoints([t.shapeId])):"hide"===t.visibility?(this.setShapeActive(t.shapeId,!1),this.isAnyGluePointActive(t.shapeId)||this.removeGluePointsFor(t.shapeId),this.removeCustomGluepoint()):"create"===t.visibility?(this.removeCustomGluepoint(),this.createCustomGluepoint(t.shapeId,t.mousePosition)):"remove"===t.visibility?this.removeCustomGluepoint():(this.removeCustomGluepoint(),this.removeAllGluePoints())},e.prototype.addGluePointsFor=function(t,e,n,i){var r=this;void 0===n&&(n="mouse"),this.ensureShapeDataExists(t,n,!0),this.viewport.getShapeOnce(t).subscribe(function(o){r.ensureShapeDataExists(t,n),r.createGluePoints(o,e,i),e&&r.removeGluePointsFor(t,e)})},e.prototype.ensureShapeDataExists=function(t,e,n){var i=this;if(void 0===n&&(n=!1),!this.hasShape(t)){var r=n?this.viewport.getShapeModel(t).pipe(Object(Ve.a)(1)):this.viewport.getShapeModel(t);this._shapes[t]={gluePoints:[],expandOn:e},this._shapes[t].shapeSub=r.subscribe(function(t){return i.positionGluePoints(t)})}},e.prototype.removeGluePointsFor=function(t,e){var n=this;void 0===e&&(e=[]);var i=this._shapes[t];if(i){for(var r=[],a=i.gluePoints.length;a--;){var s=i.gluePoints[a];-1===e.indexOf(s.gluePointId)&&r.push(this.removeGluePoint(s))}q.a.apply(void 0,o.j(r)).subscribe({complete:function(){var e=n._shapes[t];e&&!e.gluePoints.length&&(e.shapeSub.unsubscribe(),delete n._shapes[t])}})}},e.prototype.removeAllGluePoints=function(t){var e=this;void 0===t&&(t=[]),Object.keys(this._shapes).forEach(function(n){-1!==t.indexOf(n)||e.isAnyGluePointActive(n)||e.removeGluePointsFor(n)})},e.prototype.createGluePoints=function(t,e,n){for(var i in t.gluepoints){var r=t.gluepoints[i];this.shouldCreateGluePoint(t.id,r.id,e)&&(this.createGluePoint(t.id,r,!1,n),this.positionGluePoint(t,r))}var o=ut.createModel();this.shouldCreateGluePoint(t.id,o.id,e)&&(this.createGluePoint(t.id,o,!0,n),this.positionGluePoint(t,o),this.updateGluePointFull(t.id)),0===this.getGluePoints(t.id).length&&this.removeGluePointsFor(t.id)},e.prototype.positionGluePoints=function(t){for(var e in t.gluepoints){var n=t.gluepoints[e];this.positionGluePoint(t,n)}this.positionGluePoint(t,ut.createModel())},e.prototype.createCustomGluepoint=function(t,e){var n=this;this.viewport.getShapeOnce(t).subscribe(function(i){var r=new st.a;r.id=s.O.gluepointId(),r.type="custom",n.positionCustomGluePoint(r,i,e);var a=new ct(r.id,t,r);a.type="custom",n.positionGluePoint(i,r,a),a.addSubscription(a.expand().subscribe(function(){return n.changeSource.next(a)})),n.customGluepoint=a,n.addSource.next(a),n.state.set("CustomGluePoint",{shapeId:t,gluepoint:o.a({},r)}),a.show().subscribe({next:function(){return n.changeSource.next(a)}})})},e.prototype.removeCustomGluepoint=function(){var t=this;if(this.customGluepoint){var e=this.customGluepoint;this.customGluepoint=null,this.removeSource.next(e),setTimeout(function(){t.state.set("CustomGluePoint",{})},300)}},e.prototype.positionCustomGluePoint=function(t,e,i){var r=e.getPositionOnShape(i,n.CUSTOM_SNAP_THRESHOLD);t.x=r.x.value,t.y=r.y.value},e.prototype.hasShape=function(t){return!!this._shapes[t]},e.prototype.getGluePoints=function(t){return this._shapes[t]?this._shapes[t].gluePoints:[]},e.prototype.getGluePoint=function(t,e){return this.getGluePoints(t).find(function(t){return t.gluePointId===e})},e.prototype.getGluePointFull=function(t){return this.getGluePoint(t,ut.id)},e.prototype.hasGluePoint=function(t,e){return!!this.getGluePoint(t,e)},e.prototype.addGluepoint=function(t,e){var n=this._shapes[t]&&this._shapes[t].gluePoints;if(!n)throw new Error("GluepointHandler: unexpected error: shape data not available");n.push(e)},e.prototype.shouldCreateGluePoint=function(t,e,n){return!this.hasGluePoint(t,e)&&(!n||n&&n.indexOf(e)>-1)},e.prototype.isShapeActive=function(t){return!!this.hasShape(t)&&!!this._shapes[t].shapeActive},e.prototype.isActive=function(t){return this.isShapeActive(t)||this.isAnyGluePointActive(t)},e.prototype.setShapeActive=function(t,e){this._shapes[t]&&(this._shapes[t].shapeActive=e,this.updateGluePointFull(t))},e.prototype.updateGluePointFull=function(t){var e=this,n=this.isShapeActive(t),i=this.getGluePointFull(t);i&&(n&&!i.isActive?i.expand().subscribe(function(){return e.changeSource.next(i)}):!n&&i.isActive&&i.retract().subscribe(function(){return e.changeSource.next(i)}))},e.prototype.isAnyGluePointActive=function(t){return!!this.hasShape(t)&&this.getGluePoints(t).reduce(function(t,e){return t||e.isActive},!1)},e.prototype.createGluePoint=function(t,e,n,i){var r=this;void 0===n&&(n=!1),void 0===i&&(i=!1);var o=n?new ut(t,e):new ct(e.id,t,e);this.addGluepoint(t,o),this.addSource.next(o),n||this.setupGluePointInteraction(o,i),o.show().subscribe(function(){return r.changeSource.next(o)})},e.prototype.removeGluePoint=function(t){var e=this,n=this._shapes[t.shapeId].gluePoints,i=n.indexOf(t);return n.splice(i,1),t.hide().pipe(Object(d.a)({next:function(){return e.changeSource.next(t)},complete:function(){e.removeSource.next(t),t.destroy()}}))},e.prototype.positionGluePoint=function(t,e,n){var i=n||this.getGluePoint(t.id,e.id);if(i){var r={x:{type:e.xType||"relative",value:e.x},y:{type:e.yType||"relative",value:e.y}},o=Ye.a.onViewportRect(r,t.defaultBounds,t.transform);i.setPosition(o),this.changeSource.next(i)}},e.prototype.setupGluePointInteraction=function(t,e){this.setupGluePointClickInteraction(t,e),this.setupGluePointRollOverInteraction(t,e),this.setupGluePointRollOutInteraction(t,e)},e.prototype.setupGluePointClickInteraction=function(t,e){var n=this;if(e){var i=Object(W.a)(t,"click").pipe(Object(I.a)(function(){return n.isPreviewingConnect.next(!1),n.connectToGluepoint(t,!1)})).subscribe();t.addSubscription(i)}},e.prototype.setupGluePointRollOverInteraction=function(t,e){var n=this,i=Object(W.a)(t,this.getOverEvent(t.shapeId)),r=i.pipe(Object(I.a)(function(e){return t.expand()})).subscribe(function(){return n.changeSource.next(t)});if(t.addSubscription(r),e){var o=i.pipe(Object(I.a)(function(){return n.isPreviewingConnect.next(!0),n.connectToGluepoint(t,!0)})).subscribe();t.addSubscription(o)}},e.prototype.setupGluePointRollOutInteraction=function(t,e){var n=this,i=Object(W.a)(t,this.getOutEvent(t.shapeId)),r=i.pipe(Object(I.a)(function(e){return t.retract().pipe(Object(d.a)({complete:function(){n.isActive(t.shapeId)||n.removeGluePointsFor(t.shapeId)}}))})).subscribe(function(){return n.changeSource.next(t)});if(t.addSubscription(r),e){var o=i.pipe(Object(I.a)(function(){return n.isPreviewingConnect.next(!1),n.resetDiagramPreview()})).subscribe();t.addSubscription(o)}},e.prototype.resetDiagramPreview=function(){return this.commandService.dispatch(R.a.resetDiagramPreview)},e.prototype.connectToGluepoint=function(t,e){var n=this;return void 0===e&&(e=!1),this.duringConnectorSelection().pipe(Object(p.a)(function(t){return Boolean(t)}),Object(I.a)(function(i){var r=[i.toEndpoint,i.fromEndpoint].find(function(e){return e.shape&&e.shape.id===t.shapeId});if(!r)return Object(ot.b)();var o={connectorId:i.id,endpointId:r.id,shapeId:t.shapeId,gluepointId:t.gluePointId};return e?n.commandService.preview(ie.changeConnectedGluepoint,o):n.commandService.dispatch(ie.changeConnectedGluepoint,o)}))},e.prototype.getOverEvent=function(t){return"mouse"===this._shapes[t].expandOn?"rollover":"endpoint-over"},e.prototype.getOutEvent=function(t){return"mouse"===this._shapes[t].expandOn?"rollout":"endpoint-out"},e.prototype.destroy=function(){var e=this;t.prototype.destroy.call(this),Object.keys(this._shapes).forEach(function(t){return e.removeGluePointsFor(t)})},e.CUSTOM_HOVER_TIMEOUT=500,e.CUSTOM_SNAP_THRESHOLD=5,e=n=o.c([Object(k.a)(),o.f("design:paramtypes",[s.Z,s.q,Pe.a])],e)}(k.b);Object.defineProperty(Ue,"name",{value:"GluePointHandler"});var Xe=n("0cIN"),Ze=n("vKrG"),Ke=function(t){function e(e,n){var i=t.call(this)||this;return i.vtod=e,i.dtov=n,i.bounds=new Se.a,i}return o.d(e,t),e.prototype.initialize=function(){this.subs=[],this.alpha=.3,this.subs.push(this.getIndicatorDraw().subscribe())},e.prototype.position=function(t){this.graphics.clear().beginFill("#b4b4b4").drawRect(t.x,t.y,t.width,t.height).endFill(),this.setBounds(t.x,t.y,t.width,t.height),this.bounds.next(t)},e.prototype.calculateBounds=function(t,e,n,i){var r=Math.min(t,n),o=Math.min(e,i),a=Math.abs(t-n),l=Math.abs(e-i);return new s.R(r,o,a,l)},e.prototype.getIndicatorDraw=function(){var t,e=this;return this.getDragStart().pipe(Object(I.a)(function(n){e.setBounds(0,0,0,0);var i=new rt.Point(n.stageX,n.stageY);t={x:e.vtod.x(i.x),y:e.vtod.y(i.y)};var r=e.getDragEnd().pipe(Object(d.a)(function(){return e.graphics.clear()}));return e.getDrag().pipe(Object(d.a)(function(n){var i=e.calculateBounds(e.dtov.x(t.x),e.dtov.y(t.y),n.stageX,n.stageY);e.position(i)}),Object(Q.a)(r))}))},Object.defineProperty(e.prototype,"changes",{get:function(){return this.bounds},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selectionEnd",{get:function(){var t=this;return Object(xt.a)(function(){return t.getDragEnd().pipe(Object(T.a)(function(){var e=t.getBounds();if(e)return new s.R(e.x,e.y,e.width,e.height)}),Object(p.a)(function(t){return Boolean(t)}))})},enumerable:!0,configurable:!0}),e.prototype.getDragStart=function(){var t=this;return this.getGridDragEvent("stageDragStart").pipe(Object(d.a)(function(e){return t.dispatchMultiselectEvent(new bt(ht.start,e))}))},e.prototype.getDrag=function(){var t=this;return this.getGridDragEvent("stageDragMove").pipe(Object(d.a)(function(e){return t.dispatchMultiselectEvent(new bt(ht.drag,e))}))},e.prototype.getDragEnd=function(){var t=this;return this.getGridDragEvent("stageDragEnd").pipe(Object(d.a)(function(e){return t.dispatchMultiselectEvent(new bt(ht.end,e))}))},e.prototype.dispatchMultiselectEvent=function(t){this.parent&&this.parent.dispatchEvent(t)},e.prototype.getGridDragEvent=function(t){return Object(W.a)(this.parent,t).pipe(Object(T.a)(function(t){return t.relatedMouseEvent}))},e.prototype.destroy=function(){for(;this.subs.length>0;)this.subs.pop().unsubscribe()},e}(rt.Shape),ze=n("w1VY"),qe=function(t){function e(e,n,i,r,o){var a=t.call(this,e)||this;return a.ll=n,a.commandService=i,a.dToVCordinate=r,a.vToDcoordinate=o,a.selection=new Ke(o,r),a.removeSource=new Se.a,a}return o.d(e,t),e.prototype.initialize=function(){},e.prototype.setupSelection=function(){var t=this;this.selection.initialize();var e=this.getMultiSelection().subscribe(function(e){return t.selectShapes(e,!0)});this.subs.push(e)},e.prototype.getMultiSelection=function(){var t=this;return this.selection.selectionEnd.pipe(Object(I.a)(function(e){return t.getContainedShapeIds(e)}))},e.prototype.getHightlight=function(){var t=this;return this.selection.changes.pipe(Object(I.a)(function(e){return t.getContainedShapeIds(e)}))},e.prototype.getContainedShapeIds=function(t){return t=this.vToDcoordinate.bounds(t),this.ll.forCurrent(!1).getDiagramOnce().pipe(Object(T.a)(function(e){return e.getEnclosedShapes(t).map(function(t){return t.id})}))},Object.defineProperty(e.prototype,"indicators",{get:function(){return[this.selection]},enumerable:!0,configurable:!0}),e.prototype.createAddSource=function(){var t=this;return Object(Xe.a)(0).pipe(Object(lt.a)(this.selection),Object(d.a)({complete:function(){return t.setupSelection()}}))},e.prototype.createRemoveSource=function(){return Object(Ze.b)()},e.prototype.createChangeSource=function(){return Object(St.a)(Object(Xe.a)(0),Object(q.a)(this.selection.changes,this.selection.selectionEnd)).pipe(Object(lt.a)(this.selection))},e.prototype.selectShapes=function(t,e){this.commandService.dispatch(ge.a.selectShapes,this.state.get("CurrentDiagram"),{shapeIds:t,add:e})},e.prototype.destroy=function(){t.prototype.destroy.call(this),this.selection.destroy()},e=o.c([Object(k.a)(),o.f("design:paramtypes",[s.Z,f.a,s.q,ze.a,$.a])],e)}(k.b);Object.defineProperty(qe,"name",{value:"MultiSelectionHandler"});var We,Je=n("cQOC"),Qe=n("HswR"),$e=n("6EBr"),tn=function(t){function e(e,n,i){var r=t.call(this)||this;return r.container=e,r.state=n,r.restriction=i,r.prepare(),r}return o.d(e,t),e.prototype.prepare=function(){this.addChild(this.container),this.move=new se(this.container,this.state,this.restriction),this.move.register(this)},e.prototype.isSingleSelection=function(t){return this.container.isSelected(t)&&1===this.container.selectionCount},Object.defineProperty(e.prototype,"selectedIds",{get:function(){return this.container.selectedIds},enumerable:!0,configurable:!0}),e.prototype.refresh=function(){this.container.selectionType!==wt.None&&this.redraw()},e.prototype.redraw=function(){this.container.selectionType!==wt.MultiShape?this.container.position():this.interactionInProgress||this.container.position()},e.prototype.destroy=function(){this.move.destroy(),this.container.destroy(),this.removeAllChildren()},e.prototype.getInteractionStart=function(){var t=this;return this.getShapeDragEvent("shapeDragMove").pipe(Object(p.a)(function(){return!t.move.inProgress}))},e.prototype.getImmediateInteraction=function(){var t=this;return Object(W.a)(this,"added").pipe(Object(I.a)(function(){return Object(W.a)(t.parent,"keyboardSelectionInteraction")}),Object(p.a)(function(t){return!t.relatedEvent.shiftKey}),Object(T.a)(function(e){var n=e.relatedEvent;return n.handle=t,n}))},e.prototype.getInteraction=function(){var t=this;return this.getShapeDragEvent("shapeDragMove").pipe(Object(p.a)(function(){return t.move.inProgress}))},e.prototype.getInteractionEnd=function(){return this.getShapeDragEvent("shapeDragEnd")},e.prototype.getShapeDragEvent=function(t){var e=this;return Object(W.a)(this,"added").pipe(Object(I.a)(function(){return Object(W.a)(e.parent,t)}),Object(p.a)(function(t){return e.container.isSelected(t.relatedShape.name)}),Object(T.a)(function(t){var n=t.relatedMouseEvent.clone();return n.data=t.relatedMouseEvent.data,n.target=e,n}))},e}(rt.Container),en=function(t){function e(){var n=t.call(this)||this;return n.radius=e.RADIOUS,n.refresh(),n.beginRender(),n.render(),n.endRender(),n}return o.d(e,t),e.prototype.setPosition=function(t,e){this.x=t,this.y=e},e.prototype.setMovement=function(t){this.movement=t},e.prototype.getMovement=function(){return this.movement},e.prototype.beginRender=function(){this.graphics.clear(),this.graphics.beginStroke($e.a.primarySelectionHandleColor),this.graphics.beginFill("white")},e.prototype.render=function(){this.graphics.drawCircle(0,0,this.radius),this.setBounds(-this.radius,-this.radius,2*this.radius,2*this.radius)},e.prototype.endRender=function(){this.graphics.endFill(),this.graphics.endStroke()},e.prototype.refresh=function(){this.beginRender(),this.render(),this.endRender()},e.prototype.getHitPoints=function(){var t=this;return Object(c.range)(0,360,22.5).map(function(e){return{x:t.radius*Math.sin(2*Math.PI*e/360),y:t.radius*Math.cos(2*Math.PI*e/360)}})},e.prototype.getInteractionStart=function(){var t=this;return this.waitUntilAddedToCanvas().pipe(Object(I.a)(function(){return Object(W.a)(t,"mousedown")}),Object(T.a)(function(t){return t.preventDefault(),t}))},e.prototype.getImmediateInteraction=function(){return Object(ot.b)()},e.prototype.getInteraction=function(){var t=this;return this.waitUntilAddedToCanvas().pipe(Object(I.a)(function(){return Object(W.a)(t,"mousedown")}),Object(I.a)(function(){return Object(W.a)(t.indicatorLayer,"stagemousemove").pipe(Object(T.a)(function(e){return e.target=t,e}),Object(Q.a)(Object(W.a)(t.indicatorLayer,"stagemouseup")))}))},e.prototype.getInteractionEnd=function(){var t=this;return this.waitUntilAddedToCanvas().pipe(Object(I.a)(function(){return Object(W.a)(t,"mousedown")}),Object(I.a)(function(){return Object(W.a)(t.indicatorLayer,"stagemouseup").pipe(Object(h.a)(1))}),Object(T.a)(function(e){return e.preventDefault(),e.target=t,e}))},Object.defineProperty(e.prototype,"selection",{get:function(){return this.parent},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"indicatorLayer",{get:function(){return this.selection.parent},enumerable:!0,configurable:!0}),e.prototype.waitUntilAddedToCanvas=function(){var t=this;return this.selection?this.indicatorLayer?Object(u.a)(null):Object(W.a)(this.selection,"added").pipe(Object(I.a)(function(){return t.waitUntilAddedToCanvas()})):Object(W.a)(this,"added").pipe(Object(I.a)(function(){return t.waitUntilAddedToCanvas()}))},e.RADIOUS=5,e}(rt.Shape),nn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o.d(e,t),e.getName=function(t,e){return"X"+t+"Y"+e},e.prototype.beginRender=function(){this.graphics.clear(),this.xPosition===s.P.Middle||this.yPosition===s.P.Middle?this.graphics.beginFill("rgba(0,0,0,0.01)"):t.prototype.beginRender.call(this)},e.prototype.render=function(){this.xPosition===s.P.Middle||this.yPosition===s.P.Middle?(this.graphics.drawRect(-this.radius,-this.radius,2*this.radius,2*this.radius),this.setBounds(-this.radius,-this.radius,2*this.radius,2*this.radius)):t.prototype.render.call(this)},e.prototype.getCursor=function(t){return this.getScaleHandleCursor()},e.prototype.getScaleHandleCursor=function(){var t="nwse-resize",e="nesw-resize",n="ew-resize",i="ns-resize";return(this.rotation>=45&&this.rotation<=135||this.rotation>=-135&&this.rotation<=-45)&&(t="nesw-resize",e="nwse-resize",n="ns-resize",i="ew-resize"),0===this.xPosition&&0===this.yPosition||1===this.xPosition&&1===this.yPosition?{cursor:t,tail:null,type:"css"}:1===this.xPosition&&0===this.yPosition||0===this.xPosition&&1===this.yPosition?{cursor:e,tail:null,type:"css"}:0===this.xPosition&&.5===this.yPosition||1===this.xPosition&&.5===this.yPosition?{cursor:n,tail:null,type:"css"}:{cursor:i,tail:null,type:"css"}},e.prototype.configurePosition=function(t,n){this.xPosition=t,this.yPosition=n,this.name=e.getName(this.xPosition,this.yPosition),this.refresh()},e.prototype.position=function(t,e){var n=e.decompose(),i=this.xPosition*t.width,r=this.yPosition*t.height,o=e.transformPoint(i,r),a=o.x,l=o.y;this.x=a,this.y=l,this.xPosition===s.P.Middle&&(this.scaleX=n.scaleX*t.width/(2*this.radius)),this.yPosition===s.P.Middle&&(this.scaleY=n.scaleY*t.height/(2*this.radius)),this.rotation=n.rotation},e.prototype.getImmediateInteraction=function(){var t=this;return"X1Y1"===e.getName(this.xPosition,this.yPosition)?this.waitUntilAddedToCanvas().pipe(Object(I.a)(function(e){return Object(W.a)(t.indicatorLayer,"keyboardSelectionInteraction").pipe(Object(p.a)(function(t){return t.relatedEvent.shiftKey}),Object(T.a)(function(e){var n=e.relatedEvent;return n.handle=t,n}))})):Object(ot.b)()},e}(en),rn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o.d(e,t),Object.defineProperty(e.prototype,"name",{get:function(){return"ScaleInteraction"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selectionContainer",{get:function(){return this.container},enumerable:!0,configurable:!0}),e.prototype.interactionStart=function(t){var e=t.target;this.setRegistration(e)},e.prototype.interactionEnd=function(t){s.bb.track("canvas.selection.scale.change"),this.container.reg.reset()},e.prototype.interactionCancel=function(t){this.container.reg.reset()},e.prototype.interaction=function(t){var e,n,i=t.target,r=this.restriction.pointOnViewport({x:t.stageX,y:t.stageY},["GridService"]),o=this.getOpposingXHandle(i),a=this.getOpposingYHandle(i),s=t.nativeEvent.shiftKey||this.selectionContainer.transformSettings&&this.selectionContainer.transformSettings.fixAspectRatio;if(i!==o&&(e=this.getScaleChangeToMouse(i,o,r)),i!==a&&(n=this.getScaleChangeToMouse(i,a,r)),s){var l=Math.max(e||0,n||0);return this.container.scaleX=this.container.scaleX*l,void(this.container.scaleY=this.container.scaleY*l)}void 0!==e&&(this.container.scaleX*=e),void 0!==n&&(this.container.scaleY*=n)},e.prototype.interactionImmediate=function(t){var e=O.a.gridSize*this.state.get("DiagramZoomLevel"),n=this.container.getTransformedBounds(),i=this.container.getBounds();if(i&&n){var r=this.getDirectionByKeycode(t.keyCode),o=r.xDirection,a=r.yDirection,s=n.width+n.x+e*o,l=n.height+n.y+e*a,c=this.restriction.pointOnViewport({x:s,y:l},["GridService"]),u=c.x,p=c.y;o&&u!==n.x&&(this.container.scaleX=(u-n.x)/i.width,this.selectionContainer.transformSettings&&this.selectionContainer.transformSettings.fixAspectRatio&&(this.container.scaleY=this.container.scaleX)),a&&p!==n.y&&(this.container.scaleY=(p-n.y)/i.height,this.selectionContainer.transformSettings&&this.selectionContainer.transformSettings.fixAspectRatio&&(this.container.scaleX=this.container.scaleY)),this.interactionEnd(null)}},e.prototype.setRegistration=function(t){var e=this.getOpposingHandle(t),n=this.container.getBounds();this.container.reg.change(e.xPosition*n.width,e.yPosition*n.height)},e.prototype.getOpposingHandle=function(t){var e=Math.abs(t.xPosition-1),n=Math.abs(t.yPosition-1);return t.parent.getChildByName(nn.getName(e,n))},e.prototype.getOpposingXHandle=function(t){var e=Math.abs(t.xPosition-1),n=t.yPosition;return t.parent.getChildByName(nn.getName(e,n))},e.prototype.getOpposingYHandle=function(t){var e=t.xPosition,n=Math.abs(t.yPosition-1);return t.parent.getChildByName(nn.getName(e,n))},e.prototype.getScaleChangeToMouse=function(t,e,n){var i=this.identifyThePointToScaleTo(t,e,n);return this.getScaleChange(t,e,i)},e.prototype.identifyThePointToScaleTo=function(t,e,n){return new s.E(new s.M(e.x,e.y),new s.M(t.x,t.y)).perpendicularTo(n)},e.prototype.getScaleChange=function(t,e,n){var i=new s.M(e.x,e.y),r=new s.M(t.x,t.y),o=0===i.distanceTo(r)?1:i.distanceTo(r),a=r.distanceTo(n),l=0===i.distanceTo(n)?1:i.distanceTo(n);return 2*a>o+l?-l/o:l/o},e}(ae),on=function(t){function e(e,n,i){var r=t.call(this,e,n,i)||this;return r.container=e,r.state=n,r.restriction=i,r}return o.d(e,t),Object.defineProperty(e.prototype,"name",{get:function(){return"VisualVectorInteraction"},enumerable:!0,configurable:!0}),e.prototype.interactionStart=function(t){},e.prototype.interaction=function(t){this.updatePreviewData(t)},e.prototype.interactionImmediate=function(t){},e.prototype.interactionEnd=function(t){this.updatePreviewData(t)},e.prototype.interactionCancel=function(t){},e.prototype.updatePreviewData=function(t){var e=this,n=t.target,i=this.container.selectedShape.id,r={vectorId:n.name,points:[]},o={x:t.stageX,y:t.stageY};n.isWithInBounds()&&(o=this.restrictWithInShapeBounds(i,o)),r.points=n.points.map(function(t){return e.restrictMovement(i,n.getMovement(),{x:t.x,y:t.y},o)}),this.container.previewVectorData=r},e.prototype.restrictWithInShapeBounds=function(t,e){var n=this.container.selectedShapeList.find(function(e){return e.id===t}),i=n.transform,r=n.defaultBounds,o=r.x,a=r.x+r.width,l=r.y,c=r.y+r.height;return(e=s.I.fromTransform(i).invert().transformPoint(e.x,e.y)).x=e.x<o?o:e.x>a?a:e.x,e.y=e.y<l?l:e.y>c?c:e.y,{x:(e=s.I.fromTransform(i).transform(e.x,e.y)).x,y:e.y}},e}(ae),an=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o.d(e,t),e.prototype.beginRender=function(){this.graphics.beginStroke($e.a.primarySelectionHandleColor),this.graphics.beginFill("white")},e.prototype.render=function(){t.prototype.render.call(this),this.graphics.setStrokeDash($e.a.selectionBoundDashStyle),this.graphics.moveTo(this.radius,-this.radius),this.graphics.lineTo(e.LINE_END,-e.LINE_END)},e.prototype.getCursor=function(t){return{cursor:"default",tail:null,type:"css"}},e.prototype.position=function(t,n){var i=s.I.fromMatrix(n).toTransform(),r=n.transformPoint(-e.DISTANCE/Math.abs(i.scaleX),t.height+e.DISTANCE/Math.abs(i.scaleY));this.x=r.x,this.y=r.y,this.rotation=i.angle+(i.scaleX<0?i.scaleY<0?0:-90:i.scaleY<0?90:0)},e.DISTANCE=25*Math.cos(Math.PI/4),e.LINE_END=e.DISTANCE-e.RADIOUS+1,e}(en),sn=function(t){function e(e,n,i){var r=t.call(this,e,n,i)||this;return r.container=e,r.state=n,r.restriction=i,r}return o.d(e,t),Object.defineProperty(e.prototype,"name",{get:function(){return"RotationInteraction"},enumerable:!0,configurable:!0}),e.prototype.interactionStart=function(t){this.setRegistration()},e.prototype.interaction=function(t){var e=t.target,n=this.container.getBounds(),i=this.container.getMatrix().transformPoint(n.width/2,n.height/2),r=new s.E(i,{x:e.x,y:e.y}).angle,o=new s.E(i,{x:t.stageX,y:t.stageY}).angle,a=this.container.rotation+(o-r);this.container.rotation=this.snapToAngle(a,t.nativeEvent.shiftKey)},e.prototype.snapToAngle=function(t,n){if(n)return Math.round(t/e.SNAP_ON_SHIFT_ANGLE)*e.SNAP_ON_SHIFT_ANGLE;var i=Math.abs(t%90);return i<e.SNAP_REGULAR_ANGLE||i>90-e.SNAP_REGULAR_ANGLE?90*Math.round(t/90):t},e.prototype.interactionImmediate=function(t){},e.prototype.interactionEnd=function(t){s.bb.track("canvas.selection.rotate.change"),this.container.reg.reset()},e.prototype.interactionCancel=function(t){this.container.reg.reset()},e.prototype.setRegistration=function(){var t=this.container.getBounds();this.container.reg.change(t.width/2,t.height/2)},e.SNAP_REGULAR_ANGLE=5,e.SNAP_ON_SHIFT_ANGLE=15,e}(ae),ln=function(t){function e(e){var n=t.call(this)||this;return n.name=e.id,n.movement=e.movement,n.withInBounds=e.withInBounds,n.updateHandle(e),n}return o.d(e,t),e.prototype.updateHandle=function(t){this.name=t.id,this.movement=t.movement,this.withInBounds=t.withInBounds,this.setPosition(t.points[0].x,t.points[0].y)},e.prototype.isWithInBounds=function(){return this.withInBounds},Object.defineProperty(e.prototype,"points",{get:function(){return[{x:this.x,y:this.y}]},enumerable:!0,configurable:!0}),e.prototype.beginRender=function(){this.graphics.beginStroke($e.a.secondarySelectionHandleColor),this.graphics.beginFill("white")},e.prototype.getCursor=function(t){switch(this.movement){case"vertical":return{cursor:"ns-resize",tail:null,type:"css"};case"horizontal":return{cursor:"ew-resize",tail:null,type:"css"};case"diagonal-nesw":return{cursor:"nesw-resize",tail:null,type:"css"};case"diagonal-nwse":return{cursor:"nwse-resize",tail:null,type:"css"};case"free":default:return{cursor:"default",tail:null,type:"css"}}},e}(en),cn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o.d(e,t),e.prototype.updateHandle=function(e){t.prototype.updateHandle.call(this,e),this.x2=e.points[1].x,this.y2=e.points[1].y,this.graphics.clear(),this.beginRender(),this.render(),this.endRender()},Object.defineProperty(e.prototype,"points",{get:function(){return[{x:this.x,y:this.y},{x:this.x2,y:this.y2}]},enumerable:!0,configurable:!0}),e.prototype.render=function(){var t=this.x2-this.x,e=this.y2-this.y,n=this.getDelta();this.graphics.moveTo(-n.x,-n.y),this.graphics.lineTo(t-n.x,e-n.y),this.graphics.lineTo(t+n.x,e+n.y),this.graphics.lineTo(n.x,n.y),this.graphics.lineTo(-n.x,-n.y),this.setBounds(0,0,t+2*n.x,e+2*n.y),this.alpha=.01},e.prototype.getHitPoints=function(){var t=this.x2-this.x,e=this.y2-this.y,n=this.getDelta();return[{x:-n.x,y:-n.y},{x:t-n.x,y:e-n.y},{x:t+n.x,y:e+n.y},{x:n.x,y:n.y}]},e.prototype.getDelta=function(){return this.x2-this.x>this.y2-this.y?{x:0,y:e.HANDLE_WIDTH}:{x:e.HANDLE_WIDTH,y:0}},e.HANDLE_WIDTH=2,e}(ln),un=function(){function t(){}return t.create=function(t){if(1===t.points.length)return new ln(t);if(2===t.points.length)return new cn(t);throw new Error("Invalid vector data.")},t}(),pn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o.d(e,t),e.prototype.position=function(t,e){var n=e.transformPoint(0,0),i=e.transformPoint(t.width,0),r=e.transformPoint(0,t.height),o=e.transformPoint(t.width,t.height);this.graphics.clear().beginStroke($e.a.primarySelectionLineColor).moveTo(n.x,n.y).lineTo(i.x,i.y).lineTo(o.x,o.y).lineTo(r.x,r.y).lineTo(n.x,n.y).closePath().endStroke()},e}(rt.Shape),hn=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.vectorHandles={},e}return o.d(e,t),e.prototype.startShapeMovement=function(t){var e=this;void 0===t&&(t=!1);var n=Object(q.a)(Object(W.a)(this.parent,"stagemousedown"),Object(u.a)(!0).pipe(Object(D.a)(200),Object(Qe.a)(function(){return Object(W.a)(e.parent,"stagemouseup")}))).pipe(Object(h.a)(1));return Object(q.a)(Object(W.a)(this.parent,"stagemousemove").pipe(Object(Q.a)(n)),n).pipe(Object(Q.a)(Object(W.a)(this,"removed")),Object(d.a)(function(n){if(t&&!e.move.inProgress){var i=e.container.getTransformedBounds();e.container.x=-i.width/2+n.stageX,e.container.y=-i.height/2+n.stageY}var r="stagemousemove"===n.type?"shapeDragMove":"shapeDragEnd",o=new Ct(r,n);o.relatedShape={name:e.container.selectedShape.id},e.parent.dispatchEvent(o)}))},e.prototype.prepare=function(){t.prototype.prepare.call(this),this.border=new pn,this.addChild(this.border),this.createVectorHandles(),this.prepareScaleInteraction(),this.createRotationHandle()},Object.defineProperty(e.prototype,"interactionInProgress",{get:function(){return this.scale.inProgress||this.move.inProgress||this.rotationInteraction.inProgress},enumerable:!0,configurable:!0}),e.prototype.redraw=function(){t.prototype.redraw.call(this),this.border.position(this.container.getBounds(),this.container.getMatrix()),this.updateVectorHandles(),this.createScaleHandles(),this.positionScaleHandles(),this.updateRotationHandle()},e.prototype.prepareScaleInteraction=function(){this.scaleHandles={},this.scale=new rn(this.container,this.state,this.restriction)},e.prototype.createScaleHandles=function(){var t=this.container.isSingleSelection,e=t?this.container.selectedShape:null;!t||e.transformSettings.hScale?(this.createScaleHandle(s.P.Origin,s.P.Middle),this.createScaleHandle(s.P.End,s.P.Middle)):(this.removeScaleHandle(s.P.Origin,s.P.Middle),this.removeScaleHandle(s.P.End,s.P.Middle)),!t||e.transformSettings.vScale?(this.createScaleHandle(s.P.Middle,s.P.Origin),this.createScaleHandle(s.P.Middle,s.P.End)):(this.removeScaleHandle(s.P.Middle,s.P.Origin),this.removeScaleHandle(s.P.Middle,s.P.End)),!t||e.transformSettings.hScale||e.transformSettings.vScale?(this.createScaleHandle(s.P.Origin,s.P.Origin),this.createScaleHandle(s.P.Origin,s.P.End),this.createScaleHandle(s.P.End,s.P.Origin),this.createScaleHandle(s.P.End,s.P.End)):(this.removeScaleHandle(s.P.Origin,s.P.Origin),this.removeScaleHandle(s.P.Origin,s.P.End),this.removeScaleHandle(s.P.End,s.P.Origin),this.removeScaleHandle(s.P.End,s.P.End))},e.prototype.createScaleHandle=function(t,e){var n="X"+t+"Y"+e;if(!this.scaleHandles[n]){var i=new nn;i.configurePosition(t,e),this.addChild(i),this.scaleHandles[n]=i,this.scale.register(i)}},e.prototype.removeScaleHandle=function(t,e){var n="X"+t+"Y"+e,i=this.scaleHandles[n];i&&(this.removeChild(i),this.scale.unregister(i),delete this.scaleHandles[n])},e.prototype.positionScaleHandles=function(){var t=this.container.getBounds(),e=this.container.getMatrix();for(var n in this.scaleHandles){var i=this.scaleHandles[n];i.position(t,e),i.refresh()}this.sortChildren(function(t,e){return t instanceof nn&&!(e instanceof nn)?1:!(t instanceof nn)&&e instanceof nn?-1:0})},e.prototype.createAndRegisterVectorHandle=function(t){var e=un.create(t);return this.addChild(e),this.visualVector.register(e),e},e.prototype.createVectorHandles=function(){var t=this;this.visualVector=new on(this.container,this.state,this.restriction);var e=this.container.getVisualVectorData();Object(c.keys)(e).forEach(function(n){t.vectorHandles[n]={},Object(c.values)(e[n]).forEach(function(e){t.vectorHandles[n][e.id]=t.createAndRegisterVectorHandle(e)})})},e.prototype.updateVectorHandles=function(){var t=this,e=this.container.getVisualVectorData();this.destroyRemovedVectorHandles(e),Object(c.keys)(e).forEach(function(n){t.vectorHandles[n]?Object(c.keys)(e[n]).forEach(function(i){var r=e[n][i];t.vectorHandles[n][i]?t.vectorHandles[n][i].updateHandle(r):t.vectorHandles[n][i]=t.createAndRegisterVectorHandle(r)}):(t.vectorHandles[n]={},Object(c.values)(e[n]).forEach(function(e){t.vectorHandles[n][e.id]=t.createAndRegisterVectorHandle(e)}))})},e.prototype.destroyRemovedVectorHandles=function(t){var e=this;Object(c.keys)(this.vectorHandles).forEach(function(n){t[n]?Object(c.keys)(e.vectorHandles[n]).forEach(function(i){t[n][i]||(e.removeChild(e.vectorHandles[n][i]),delete e.vectorHandles[n][i])}):(Object(c.values)(e.vectorHandles[n]).forEach(function(t){return e.removeChild(t)}),delete e.vectorHandles[n])})},e.prototype.createRotationHandle=function(){this.createRotationInteraction(),this.rotationHandle=new an,this.addChild(this.rotationHandle),this.rotationInteraction.register(this.rotationHandle)},e.prototype.createRotationInteraction=function(){this.rotationInteraction=new sn(this.container,this.state,this.restriction)},e.prototype.updateRotationHandle=function(){if(this.rotationHandle&&this.container.canRotate){var t=this.container.getBounds(),e=this.container.getMatrix();this.rotationHandle.position(t,e)}},e.prototype.destroy=function(){t.prototype.destroy.call(this),this.scale.destroy(),this.visualVector.destroy(),this.rotationInteraction.destroy()},e}(tn),dn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o.d(e,t),Object.defineProperty(e.prototype,"selectionType",{get:function(){var t=this.selectionCount;return t>1?wt.MultiShape:1===t?wt.SingleShape:wt.None},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isSingleSelection",{get:function(){return this.selectionType===wt.SingleShape},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selectedShape",{get:function(){if(this.isSingleSelection)return this.selectedShapes[this.selectedIds[0]];throw Error("Single selected shape should not be used when there are multiple selected")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"transformSettings",{get:function(){return this.selectedShapeList.reduce(function(t,e){return e instanceof Mt.a&&e.transformSettings&&(t?(t.fixAspectRatio=t.fixAspectRatio||e.transformSettings.fixAspectRatio,t.hScale=t.hScale&&e.transformSettings.hScale,t.vScale=t.vScale&&e.transformSettings.vScale,t.rotate=t.rotate&&e.transformSettings.rotate):t=o.a({},e.transformSettings)),t},null)},enumerable:!0,configurable:!0}),e.prototype.position=function(){this.isSingleSelection?this.positionSingle():this.positionMultiple()},e.prototype.positionSingle=function(){var t=this.selectedShape;this.setTranslation(t),this.setTransformation(t),this.updateChild(t,!1)},e.prototype.positionMultiple=function(){var t=this;this.resetTransformation();var e=this.selectedShapeList,n=e.map(function(t){return t.bounds});this.setMinimumTranslation(n),e.forEach(function(e){t.updateChild(e,!0)})},e.prototype.updateChild=function(t,e){var n=this.getChildByName(t.id);n.setDefaultBounds(t),e?(n.setTranslation(t),n.setTransformation(t)):n.resetTransformation()},e.prototype.setTranslation=function(t){if(t instanceof Mt.a&&this.setTranslationByValues(t.x,t.y,t.scaleX,t.scaleY,t.angle),t instanceof kt.a){var e=t.bounds,n=e.x,i=e.y;this.setTranslationByValues(n,i)}},e.prototype.setTranslationByValues=function(t,e,n,i,r,o,a){void 0===n&&(n=1),void 0===i&&(i=1),void 0===r&&(r=0),void 0===o&&(o=0),void 0===a&&(a=0);var l=new s.I;l.appendTransform(t,e,n,i,r,o,a,0,0);var c=l.transformPoint(this.regX,this.regY);this.x=c.x,this.y=c.y},e.prototype.setMinimumTranslation=function(t){var e=t[0].x,n=t[0].y;t.forEach(function(t){e=Math.min(t.x,e),n=Math.min(t.y,n)}),this.setTranslationByValues(e,n)},e.prototype.setTransformation=function(t){t instanceof Mt.a&&(this.scaleX=t.scaleX,this.scaleY=t.scaleY,this.rotation=t.angle)},e.prototype.resetTransformation=function(){this.scaleX=1,this.scaleY=1,this.rotation=0},e.prototype.previewInteraction=function(){return this.previewVectorData?this.fireVectorChange(!0):this.fireTransformCommand(!0)},e.prototype.completeInteraction=function(){if(this.previewVectorData)return this.fireVectorChange(!1);var t=this.fireTransformCommand(!1);return this.resetCachedConnectorMatrices(),t},e.prototype.fireTransformCommand=function(t){var e=this.getShapeMatrices(),n=this.getConnectorMatrices(t);if(!Object.keys(e).length&&!Object.keys(n).length)return Object(ot.b)();var i=ie.transformShapesAndConnectors,r={shapes:e,connectors:n};return this.fireCommandEvent(i,r,t)},e.prototype.fireVectorChange=function(t){var e=ie.moveVisualVector,n={shapeId:this.selectedShape.id,vectorId:this.previewVectorData.vectorId,points:this.previewVectorData.points};return this.previewVectorData=null,this.fireCommandEvent(e,n,t)},e.prototype.fireCommandEvent=function(t,e,n){var i=n?"preview":"dispatch";return this.commandService[i](t,e)},e.prototype.getVisualVectorData=function(){var t={};return this.isSingleSelection&&this.selectedShapes?(Object(c.values)(this.selectedShapes).forEach(function(e){e instanceof Mt.a&&e.vectors&&(t[e.id]={},Object(c.values)(e.vectors).forEach(function(n){var i=n.getVectorData(e.defaultBounds,e.transform);t[e.id][i.id]=i}))}),t):t},e.prototype.canRotate=function(){return!this.selectedShapeList.find(function(t){return t instanceof Mt.a&&!t.transformSettings.rotate})},e}(Ft),fn=function(t){function e(e){var n=t.call(this)||this;return n.name=e,n}return o.d(e,t),e.prototype.getCursor=function(t){return{cursor:"default",tail:null,type:"css"}},Object.defineProperty(e.prototype,"pointId",{get:function(){return this.name},enumerable:!0,configurable:!0}),e}(en),bn=function(t){function e(e){var n=t.call(this)||this;return n.name=e,n}return o.d(e,t),e.prototype.getCursor=function(t){return{cursor:"default",tail:null,type:"css"}},Object.defineProperty(e.prototype,"pointId",{get:function(){return this.name},enumerable:!0,configurable:!0}),e.prototype.getEndpointOver=function(){var t=this;return this.waitUntilAddedToCanvas().pipe(Object(I.a)(function(){return Object(W.a)(t.indicatorLayer,"endpoint-over")}))},e.prototype.getEndpointOut=function(){var t=this;return this.waitUntilAddedToCanvas().pipe(Object(I.a)(function(){return Object(W.a)(t.indicatorLayer,"endpoint-out")}))},e}(en),gn=function(t){function e(e){var n=t.call(this)||this;return n.previousPointId=e,n.name="bp-"+e,n}return o.d(e,t),e.prototype.getCursor=function(t){return null},e}(en),vn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o.d(e,t),Object.defineProperty(e.prototype,"name",{get:function(){return"PathPointMoveInteraction"},enumerable:!0,configurable:!0}),e.prototype.interaction=function(t){var e=t.target,n=this.getPointerPosition(t),i=n.x,r=n.y;this.container.onPathPointMove(e.pointId,{x:i,y:r})},e.prototype.interactionEnd=function(e){t.prototype.interactionEnd.call(this,e);var n=e.target,i=this.getPointerPosition(e),r=i.x,o=i.y;this.container.onPathPointDrop(n.pointId,{x:r,y:o})},e}(le),yn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o.d(e,t),Object.defineProperty(e.prototype,"interactionInProgress",{get:function(){return!1},enumerable:!0,configurable:!0}),e.prototype.startEndpointMovement=function(t){var e=this.endPointHandles.get(t);if(!e)throw new Error("Unable to find endpoint handle with given id");var n=new rt.Event("mousedown",!1,!0);e.dispatchEvent(n),this.stage.dispatchEvent(new rt.MouseEvent("stagemousemove",!1,!0,this.stage.mouseX,this.stage.mouseY,null,null,!1,this.stage.mouseX,this.stage.mouseY))},e.prototype.prepare=function(){t.prototype.prepare.call(this),this.prepareInteractions(),this.prepareHandleMaps(),this.updateHandles()},e.prototype.redraw=function(){t.prototype.redraw.call(this),this.updateHandles()},e.prototype.prepareInteractions=function(){this.endPointMove=new ce(this.container,this.state,this.restriction),this.pathPointMove=new vn(this.container,this.state,this.restriction)},e.prototype.prepareHandleMaps=function(){this.endPointHandles=new s.H,this.endPointHandles.onCreate=this.createEndPointHandle.bind(this),this.endPointHandles.onUpdate=this.updateEndPointHandle.bind(this),this.endPointHandles.onDelete=this.deleteEndPointHandle.bind(this),this.pathPointHandles=new s.H,this.pathPointHandles.onCreate=this.createPathPointHandle.bind(this),this.pathPointHandles.onUpdate=this.updatePathPointHandle.bind(this),this.pathPointHandles.onDelete=this.deletePathPointHandle.bind(this),this.breakPointHandles=new s.H,this.breakPointHandles.onCreate=this.createBreakPointHandle.bind(this),this.breakPointHandles.onUpdate=this.updateBreakPointHandle.bind(this),this.breakPointHandles.onDelete=this.deleteBreakPointHandle.bind(this)},e.prototype.updateHandles=function(){this.endPointHandles.reset(Object(c.keyBy)(this.container.getEndPoints(),"id")),this.pathPointHandles.reset(Object(c.keyBy)(this.container.getPathPoints(),"id")),this.breakPointHandles.reset(Object(c.keyBy)(this.container.getBreakPoints(),"id"))},e.prototype.createEndPointHandle=function(t,e){var n=new bn(t);return n.setPosition(e.position.x,e.position.y),this.addChild(n),this.endPointMove.register(n),n},e.prototype.updateEndPointHandle=function(t,e,n){return t.setPosition(n.position.x,n.position.y),t},e.prototype.deleteEndPointHandle=function(t,e){this.removeChild(t)},e.prototype.createPathPointHandle=function(t,e){var n=new fn(t);return n.setPosition(e.position.x,e.position.y),n.setMovement(e.movement),this.addChild(n),this.pathPointMove.register(n),n},e.prototype.updatePathPointHandle=function(t,e,n){return t.setMovement(n.movement),t.setPosition(n.position.x,n.position.y),t},e.prototype.deletePathPointHandle=function(t,e){this.removeChild(t)},e.prototype.createBreakPointHandle=function(t,e){var n=new gn(t);return n.setPosition(e.position.x,e.position.y),this.addChild(n),n},e.prototype.updateBreakPointHandle=function(t,e,n){return t.setPosition(n.position.x,n.position.y),t},e.prototype.deleteBreakPointHandle=function(t,e){this.removeChild(t)},e}(tn),mn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o.d(e,t),e}(re),On=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o.d(e,t),e}(re),Sn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o.d(e,t),e}(re);!function(t){t.added="selection-added",t.removed="selection-removed",t.changed="selection-changed"}(We||(We={}));var xn=function(t){function e(e,n){var i=t.call(this,e,!0,!0)||this;return i.type=e,i.selection=n,i}return o.d(e,t),e}(rt.Event),Cn=function(t){function e(e,n,i,r,o){var a=t.call(this,e)||this;return a.ll=n,a.viewport=i,a.commandService=r,a.restriction=o,a.shapeChanges={},a.addSource=new Se.a,a.removeSource=new Se.a,a}return o.d(e,t),e.prototype.initialize=function(){var t=this;this.subs.push(this.state.changes("Selected").pipe(Object(Qe.a)(function(e){var n=t.selection;return t.resetSelection(e).pipe(Object(I.a)(function(){return t.selection?t.addShapes(e).pipe(Object(d.a)(function(){t.removeShapes(e),t.updateChanges(),t.emitSelectionEvent(n)})):Object(ot.b)()}))})).subscribe())},Object.defineProperty(e.prototype,"indicators",{get:function(){return[this.selection]},enumerable:!0,configurable:!0}),e.prototype.createAddSource=function(){var t=this;return Object(xt.a)(function(){var e=t.addSource;return t.selection&&(e=Object(St.a)(Object(u.a)(t.selection),e)),e})},e.prototype.createRemoveSource=function(){return this.removeSource},e.prototype.createChangeSource=function(){var t=this;return we.a.create(function(e){return t.changesObserver=e})},Object.defineProperty(e.prototype,"shapeIds",{get:function(){return Object.keys(this.shapeChanges)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"shapeCount",{get:function(){return this.shapeIds.length},enumerable:!0,configurable:!0}),e.prototype.addShapes=function(t){var e=this,n=[];return t.forEach(function(t){e.shapeChanges[t]||n.push(e.listenToShape(t))}),n.length?Object(Je.a)(n):Object(u.a)([])},e.prototype.removeShapes=function(t){var e=this;this.shapeIds.forEach(function(n){t.includes(n)||e.stopListeningToShape(n)})},e.prototype.listenToShape=function(t){var e=this;return Object(xt.a)(function(){var n=e.viewport.getShapeModel(t);return e.shapeChanges[t]=n.pipe(Object(Ve.a)(1)).subscribe(function(t){return e.shapeChanged(t)}),n.pipe(Object(h.a)(1),Object(d.a)(function(t){return e.shapeAdded(t)}))})},e.prototype.stopListeningToShape=function(t){this.selectionContainer.removeShape(t),this.shapeChanges[t].unsubscribe(),delete this.shapeChanges[t]},e.prototype.shapeAdded=function(t){this.selectionContainer.addShape(t)},e.prototype.shapeChanged=function(t){this.selectionContainer.changeShape(t),this.updateChanges()},e.prototype.updateChanges=function(){this.selection.refresh(),this.changesObserver.next(this.selection)},e.prototype.resetSelection=function(t){var e=this;return this.selectionTypeFor(t).pipe(Object(T.a)(function(t){var n=t.selectionType,i=t.containerType;return n?!(e.selection instanceof n&&e.selectionContainer instanceof i)&&(e.selection&&e.removeSelection(),e.createSelection(n,i),!0):!!e.selection&&(e.removeSelection(),!0)}))},e.prototype.selectionTypeFor=function(t){var e=this;return t.length?t.length>1?Object(u.a)({selectionType:hn,containerType:dn}):this.ll.forCurrent(!1).getShapeOnce(t[0]).pipe(Object(T.a)(function(t){return t instanceof Mt.a?{selectionType:hn,containerType:e.containerTypeForShape(t)}:t instanceof kt.a?{selectionType:yn,containerType:e.containerTypeForConnector(t)}:{selectionType:null,containerType:null}})):Object(u.a)({selectionType:null,containerType:null})},e.prototype.containerTypeForShape=function(t){return dn},e.prototype.containerTypeForConnector=function(t){var e=t.entryClassName;return"ConnectorStraight"===e?mn:"ConnectorCurved"===e?On:"ConnectorAngled"===e||"ConnectorSmoothAngled"===e?Sn:re},e.prototype.removeSelection=function(){this.removeSource.next(this.selection),this.destroySelection()},e.prototype.destroySelection=function(){var t=this;this.shapeIds.forEach(function(e){return t.stopListeningToShape(e)}),this.selection&&(this.selection.destroy(),this.selection=void 0),this.selectionContainer&&(this.selectionContainer.destroy(),this.selectionContainer=void 0)},e.prototype.createSelection=function(t,e){this.selectionContainer=new e(this.commandService),this.selection=new t(this.selectionContainer,this.state,this.restriction),this.addSource.next(this.selection)},e.prototype.emitSelectionEvent=function(t){var e;t?e=this.selection?We.changed:We.removed:this.selection&&(e=We.added);var n=new xn(e,this.selection);this.indicatorLayer.dispatchEvent(n),this.state.set("CurrentSelection",this.selection||{})},e.prototype.destroy=function(){t.prototype.destroy.call(this),this.destroySelection(),this.changesObserver.complete(),this.changesObserver=void 0,this.addSource.complete(),this.addSource=void 0,this.removeSource.complete(),this.removeSource=void 0},e=o.c([Object(k.a)(),o.f("design:paramtypes",[s.Z,f.a,Pe.a,s.q,Jt.a])],e)}(k.b);Object.defineProperty(Cn,"name",{value:"SelectionHandler"});var Pn,wn=n("RMc3"),En=n("/nnd"),jn=n("oK6n"),In=n("Di8k"),Tn=n("T4Sa");!function(t){t.CreateComment="create-comment"}(Pn||(Pn={}));var Mn,Dn=function(t){function e(e,n){var i=t.call(this,e,n,!0,!0)||this;return i.relatedShape=null,i.setRelatedShape(n),i}return o.d(e,t),e.prototype.getShapeId=function(){return this.relatedShape?this.relatedShape.name:null},e.prototype.getPosition=function(){return{x:this.relatedMouseEvent.stageX,y:this.relatedMouseEvent.stageY}},e}(tt.a),An=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o.d(e,t),Object.defineProperty(e.prototype,"defaultCursor",{get:function(){return{cursor:"comment",tail:null,type:"svg"}},enumerable:!0,configurable:!0}),e.prototype.initialize=function(e,n,i){var r=this,o=t.prototype.initialize.call(this,e,n,i),a=this.getStageMouseDown(this.gridCanvas).pipe(Object(d.a)(function(t){return r.addComment(t)})),s=this.getClickOnShape().pipe(Object(d.a)(function(t){return r.addComment(t)}));return Object(q.a)(o,a,s)},e.prototype.getClickOnShape=function(){var t=this;return this.getShapes().pipe(Object(J.a)(function(e){return Object(W.a)(e,"mousedown").pipe(Object(I.a)(function(){return Object(W.a)(e,"pressup").pipe(Object(Q.a)(Object(W.a)(e,"pressmove")))}),Object(Q.a)(Object(W.a)(t.diagramCanvas,"childRemoved").pipe(Object(p.a)(function(t){return t.child===e}))))}))},e.prototype.addComment=function(t){var e=new Dn(Pn.CreateComment,t);this.interactionCanvas.dispatchEvent(e)},e}(nt.a),kn=n("3+4Q"),Ln=function(t){function e(e){var n=t.call(this)||this;return n.model=e,n.prepare(),n}return o.d(e,t),e.prototype.destroy=function(){},e.prototype.prepare=function(){var t=new rt.Shape;t.graphics.clear(),t.graphics.beginFill(e.ICON_COLOR),t.graphics.beginStroke("#FFFFFF"),t.graphics.setStrokeStyle(2),t.graphics.drawCircle(0,0,20),t.graphics.endStroke(),t.graphics.endFill(),t.shadow=new rt.Shadow("rgba(0, 0, 0, 0.25)",0,2,3),this.addChild(t);var n=new rt.Bitmap('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="22.84" height="17.07"><path fill="rgb(255, 255, 255)" d="M22.84,7.46C22.84,3.34,17.73,0,11.42,0S0,3.34,0,7.46s5.11,7.46,11.42,7.46a17.57,17.57,0,0,0,3.21-.3l4.3,2.43a.17.17,0,0,0,.25-.15l0-3.95C21.42,11.59,22.84,9.63,22.84,7.46Z" /></svg>');n.x=-11,n.y=-8,this.addChild(n)},e.ICON_COLOR="#F39C12",e}(rt.Container),Fn=function(t){function e(e,n,i,r,o,a){var s=t.call(this,n)||this;return s.ll=e,s.state=n,s.datastore=i,s.commandService=r,s.diagToViewport=o,s.viewToDiagram=a,s.addSource=new Se.a,s.removeSource=new Se.a,s.changeSource=new Se.a,s.shapeComments={},s.diagramComments={},s}var n;return o.d(e,t),n=e,e.prototype.initialize=function(){var t=this;this.subs.push(this.listenToOpenPanelChanges().pipe(Object(I.a)(function(e){return e?Object(q.a)(t.listenToCommentChanges(),t.listenToViewportChanges(),t.listenToDiagramChanges(),t.listenToCreateEvents()):(t.hideCommentThreadView(),t.removeAllIndicators())})).subscribe())},Object.defineProperty(e.prototype,"indicators",{get:function(){return o.j(Object(c.values)(this.diagramComments),Object(c.flatten)(Object(c.values)(this.shapeComments).map(function(t){return Object(c.values)(t)})))},enumerable:!0,configurable:!0}),e.prototype.createAddSource=function(){return this.addSource},e.prototype.createRemoveSource=function(){return this.removeSource},e.prototype.createChangeSource=function(){return this.changeSource},Object.defineProperty(e.prototype,"locator",{get:function(){return this.ll.forCurrent(!0)},enumerable:!0,configurable:!0}),e.prototype.listenToOpenPanelChanges=function(){return this.state.changes(n.SIDEBAR_STATE_KEY).pipe(Object(T.a)(function(t){return t===n.SIDEBAR_STATE_VAL}),Object(A.a)())},e.prototype.listenToCommentChanges=function(){var t=this,e=this.state.get("CurrentDiagram");return Object(q.a)(this.datastore.findLatest(kn.a,{diagramId:e}).pipe(Object(T.a)(function(t){return{type:"insert",docs:t}})),this.datastore.watch(kn.a,{diagramId:e}).pipe(Object(Qe.a)(function(t){return t.docs?s.x.build({docs:kn.a},t):Object(u.a)(t)}))).pipe(Object(d.a)(function(e){"insert"===e.type&&e.docs.filter(function(t){return!t.parentId}).forEach(function(e){return t.createCommentIndicator(e)})}))},e.prototype.listenToViewportChanges=function(){var t=this;return Object(q.a)(this.state.changes("DiagramPan"),this.state.changes("DiagramZoomLevel")).pipe(Object(I.a)(function(){return t.locator.getDiagramOnce()}),Object(d.a)(function(e){return t.updateIndicatorPositions(e)}))},e.prototype.listenToDiagramChanges=function(){var t=this;return this.locator.getDiagramChanges().pipe(Object(d.a)(function(e){var n,i,r,a;if(e.split.shapes)try{for(var s=o.k(Object.keys(e.split.shapes)),l=s.next();!l.done;l=s.next()){var c=l.value;if(t.shapeComments[c])try{for(var u=o.k(Object.keys(t.shapeComments[c])),p=u.next();!p.done;p=u.next()){var h=p.value,d=t.shapeComments[c][h];t.positionShapeCommentIndicator(d,e.model.shapes[c]),t.changeSource.next(d)}}catch(f){r={error:f}}finally{try{p&&!p.done&&(a=u.return)&&a.call(u)}finally{if(r)throw r.error}}}}catch(b){n={error:b}}finally{try{l&&!l.done&&(i=s.return)&&i.call(s)}finally{if(n)throw n.error}}}))},e.prototype.listenToCreateEvents=function(){var t=this;return Object(W.a)(this.indicatorLayer,Pn.CreateComment).pipe(Object(d.a)(function(e){t.showCommentThreadView(e.getShapeId(),e.getPosition()),t.switchToNormalState()}))},e.prototype.removeAllIndicators=function(){var t,e;try{for(var n=o.k(this.indicators),i=n.next();!i.done;i=n.next()){var r=i.value;this.removeSource.next(r)}}catch(a){t={error:a}}finally{try{i&&!i.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}return this.shapeComments={},this.diagramComments={},Object(ot.b)()},e.prototype.updateIndicatorPositions=function(t){var e,n,i,r,a,s;try{for(var l=o.k(Object.keys(this.diagramComments)),c=l.next();!c.done;c=l.next()){var u=c.value,p=this.diagramComments[u];this.positionDiagramCommentIndicator(p),this.changeSource.next(p)}}catch(v){e={error:v}}finally{try{c&&!c.done&&(n=l.return)&&n.call(l)}finally{if(e)throw e.error}}try{for(var h=o.k(Object.keys(this.shapeComments)),d=h.next();!d.done;d=h.next()){var f=d.value;try{for(var b=o.k(Object.keys(this.shapeComments[f])),g=b.next();!g.done;g=b.next()){u=g.value,p=this.shapeComments[f][u];this.positionShapeCommentIndicator(p,t.shapes[f]),this.changeSource.next(p)}}catch(y){a={error:y}}finally{try{g&&!g.done&&(s=b.return)&&s.call(b)}finally{if(a)throw a.error}}}}catch(m){i={error:m}}finally{try{d&&!d.done&&(r=h.return)&&r.call(h)}finally{if(i)throw i.error}}},e.prototype.createCommentIndicator=function(t){t.shapeId?this.createShapeCommentIndicator(t):this.createDiagramCommentIndicator(t)},e.prototype.createDiagramCommentIndicator=function(t){if(!this.diagramComments[t.id]){var e=new Ln(t);this.positionDiagramCommentIndicator(e),this.setupCommentInteractions(e),this.diagramComments[t.id]=e,this.addSource.next(e)}},e.prototype.positionDiagramCommentIndicator=function(t){t.x=this.diagToViewport.x(t.model.locOnDiagram.x),t.y=this.diagToViewport.y(t.model.locOnDiagram.y)},e.prototype.createShapeCommentIndicator=function(t){var e=this;this.locator.getShapeOnce(t.shapeId).subscribe(function(n){if(e.shapeComments[t.shapeId]||(e.shapeComments[t.shapeId]={}),!e.shapeComments[t.shapeId][t.id]){var i=new Ln(t);e.positionShapeCommentIndicator(i,n),e.setupCommentInteractions(i),e.shapeComments[t.shapeId][t.id]=i,e.addSource.next(i)}})},e.prototype.positionShapeCommentIndicator=function(t,e){if(!e)return this.positionDiagramCommentIndicator(t);var n=s.N.onRect(t.model.locOnShape,e.defaultBounds,e.transform);t.x=this.diagToViewport.x(n.x),t.y=this.diagToViewport.y(n.y)},e.prototype.setupCommentInteractions=function(t){var e=this;this.subs.push(Object(W.a)(t,"click").subscribe(function(){var n=t.model,i={visible:!0,threadId:n.id,comments:[n]};e.state.set("CommentThreadData",i)}))},e.prototype.showCommentThreadView=function(t,e){var n={visible:!0,shapeId:t,position:{x:this.viewToDiagram.x(e.x),y:this.viewToDiagram.y(e.y)}};this.state.set("CommentThreadData",n)},e.prototype.switchToNormalState=function(){this.state.set("MouseControlState",m.b.Normal)},e.prototype.hideCommentThreadView=function(){this.state.set("CommentThreadData",{})},e.SIDEBAR_STATE_KEY="RightSidebarPanel",e.SIDEBAR_STATE_VAL="diagramcomments",e=n=o.c([Object(k.a)(),o.f("design:paramtypes",[f.a,s.Z,fe.b,s.q,ze.a,$.a])],e)}(k.b),Hn=function(t){function e(e,n,i,r,o,a,s,l){var c=t.call(this,e)||this;return c.state=e,c.gridService=n,c.featureList=i,c.injector=r,c.cursorGen=o,c.keyBoardController=a,c.ll=s,c.translate=l,c.subs=[],c}return o.d(e,t),e.prototype.resolve=function(t,e){return this.state.set("EditingText",{open:!1}),this.state.set("PlusCreateState",{inProgress:!1}),this.state.set("TextToolbarState",{styles:{},takeFocus:!1}),this.state.set("TextEditorState",{styles:{}}),this.hideLoadingScreen(),this.cursorGen.addCursors(dt),this.updateInterfaceControlState(),this.updateIndicatorHandlers(),this.updateInteractionHandler(),this.setCurrentLibraries(),this.setSideBarPanels(),this.registerFeatures(),this.keyBoardController.registerFeatures(),this.state.set("MouseControlState",m.b.Normal),this.gridService.showGrid.next(!0),Object(u.a)()},e.prototype.canDeactivate=function(t,e,n,i){return this.destroy(),Object(u.a)(!0)},e.prototype.destroy=function(){for(;this.subs.length>0;)this.subs.pop().unsubscribe()},e.prototype.updateInterfaceControlState=function(){this.state.set("InterfaceControlState",m.a.Edit)},e.prototype.updateIndicatorHandlers=function(){this.state.set("IndicatorHandlerList",new Set([Cn,qe,Ue,j.a,L,Fe,Fn]))},e.prototype.updateInteractionHandler=function(){var t=this,e=this.state;this.subs.push(this.state.changes("MouseControlState").subscribe(function(n){return e.set("CurrentInteractionHandler",{injector:t.injector,type:t.getEditorInteractionHandler(n)})}))},e.prototype.getEditorInteractionHandler=function(t){return t===m.b.Normal?me:t===m.b.Pan?x.a:t===m.b.Text?He:t===m.b.Comment?An:pt},e.prototype.setCurrentLibraries=function(){var t=this.state;t.has("CurrentLibraries")||(t.initialize("CurrentLibraries",[]),this.ll.forCurrent(!1).getDiagramModel().pipe(Object(p.a)(function(t){return!!t&&!!t.name}),Object(h.a)(1),Object(d.a)(function(e){if(e.libraries&&e.libraries.length>0){var n=e.libraries.map(function(t){return{id:t,type:Re.b.Static}});t.set("CurrentLibraries",n)}else t.set("CurrentLibraries",[{id:"general",type:Re.b.Static},{id:"flowchart",type:Re.b.Static},{id:"block",type:Re.b.Static}])})).subscribe())},e.prototype.setSideBarPanels=function(){var t=this.state,e={diagraminfo:C.a,style:wn.a,diagramcomments:Tn.a,textstyle:En.a};t.set("AvialableSideBarPanels",e)},e.prototype.registerFeatures=function(){this.featureList.register({id:"selectAll",commandEvent:ie.selectAll,label:this.translate.instant("COMMANDS.SELECT_ALL"),shortcuts:[{keySequence:[l.e.Meta,l.e.A]}],data:{},shortcutText:"",context:v.a.Canvas}),this.featureList.register({id:"remove",commandEvent:R.a.removeShape,label:this.translate.instant("COMMANDS.DELETE"),shortcuts:[{keySequence:[l.e.Backspace]},{keySequence:[l.e.Delete]}],data:{},shortcutText:"",context:v.a.Canvas}),this.featureList.register({id:"copyShapes",commandEvent:R.a.copyShapes,label:this.translate.instant("COMMANDS.COPY"),shortcuts:[{keySequence:[l.e.Meta,l.e.C]}],data:{},shortcutText:"",context:v.a.Canvas}),this.featureList.register({id:"cutShapes",commandEvent:R.a.cutShapes,label:this.translate.instant("COMMANDS.CUT"),shortcuts:[{keySequence:[l.e.Meta,l.e.X]}],data:{},shortcutText:"",context:v.a.Canvas}),this.featureList.register({id:"pasteShapes",commandEvent:R.a.pasteShapes,label:this.translate.instant("COMMANDS.PASTE"),shortcuts:[{keySequence:[l.e.Meta,l.e.V],repeatOnKeyPress:300}],data:{},shortcutText:"",context:v.a.Canvas}),this.featureList.register({id:"duplicateShapes",commandEvent:R.a.duplicateShapes,label:this.translate.instant("COMMANDS.DUPLICATE"),shortcuts:[{keySequence:[l.e.Meta,l.e.D],repeatOnKeyPress:300}],data:{},shortcutText:"",context:v.a.Canvas}),this.featureList.register({id:"editText",commandEvent:R.a.openTextEditor,label:this.translate.instant("COMMANDS.EDIT_TEXT"),shortcuts:Object(c.flatten)(o.j(l.a,l.i,l.k).map(function(t){return[{keySequence:[t]},{keySequence:[l.e.Shift,t]}]})),data:{},shortcutText:"",context:v.a.CanvasSelected,attachKeyEventToData:!0,icon:"nu-ic-text"}),this.featureList.register({id:"createConnector",commandEvent:R.a.addConnector,label:this.translate.instant("COMMANDS.CREATE_CONNECTION"),shortcuts:[],data:{},shortcutText:"",context:v.a.Canvas,icon:"nu-ic-line",transformer:B.a}),this.featureList.register({id:"styleShape",dataType:l.c.CUSTOM_STYLE_PALETTES,commandEvent:R.a.applyShapeStyle,label:this.translate.instant("COMMANDS.STYLE_SHAPE"),shortcuts:[],data:{},shortcutText:"",context:v.a.Canvas,icon:"styles",transformer:jn.a}),this.featureList.register({id:"flipConnector",commandEvent:ie.flipConnector,label:this.translate.instant("COMMANDS.FLIP"),shortcuts:[],data:{},shortcutText:"",context:v.a.Canvas,icon:"nu-ic-swap",transformer:U.a}),this.featureList.register({id:"uploadShapeImage",commandEvent:R.a.uploadShapeImage,label:this.translate.instant("COMMANDS.UPLOAD_SHAPE_IMAGE"),shortcuts:[],data:{},shortcutText:"",context:v.a.Canvas,icon:"nu-ic-image"}),this.featureList.register({id:"changeLeftArrowHead",dataType:l.c.OPTION_IMAGES,commandEvent:R.a.changeArrowHeads,label:"",shortcuts:[],data:{},shortcutText:"",context:v.a.Canvas,transformer:_.a}),this.featureList.register({id:"changeRightArrowHead",dataType:l.c.OPTION_IMAGES,commandEvent:R.a.changeArrowHeads,label:"",shortcuts:[],data:{},shortcutText:"",context:v.a.Canvas,transformer:_.a}),this.featureList.register({id:"changeDrawStyle",dataType:l.c.OPTION_IMAGES,commandEvent:R.a.changeDrawStyle,label:"",shortcuts:[],data:{},shortcutText:"",context:v.a.Canvas,transformer:G.a}),this.featureList.register({id:"changeConnectorType",dataType:l.c.OPTION_IMAGES,commandEvent:R.a.setConnectorConnection,label:"",shortcuts:[],data:{},shortcutText:"",context:v.a.Canvas,transformer:V.a}),this.featureList.register({id:"keyboardSelectionMove",commandEvent:R.a.keyboardSelectionInteraction,label:this.translate.instant("COMMANDS.MOVE"),shortcuts:[{keySequence:[l.e.ArrowUp],repeatOnKeyPress:50},{keySequence:[l.e.ArrowDown],repeatOnKeyPress:50},{keySequence:[l.e.ArrowLeft],repeatOnKeyPress:50},{keySequence:[l.e.ArrowRight],repeatOnKeyPress:50}],data:{},attachKeyEventToData:!0,shortcutText:"\u2190 \u2192 \u2191 \u2193",context:v.a.CanvasSelected}),this.featureList.register({id:"keyboardSelectionScale",commandEvent:R.a.keyboardSelectionInteraction,label:this.translate.instant("COMMANDS.SCALE"),shortcuts:[{keySequence:[l.e.Shift,l.e.ArrowUp],repeatOnKeyPress:50},{keySequence:[l.e.Shift,l.e.ArrowDown],repeatOnKeyPress:50},{keySequence:[l.e.Shift,l.e.ArrowLeft],repeatOnKeyPress:50},{keySequence:[l.e.Shift,l.e.ArrowRight],repeatOnKeyPress:50}],data:{},attachKeyEventToData:!0,shortcutText:"Shift + \u2190  \u2192  \u2191  \u2193",context:v.a.CanvasSelected}),this.featureList.register({id:"undo",commandEvent:R.a.undoAction,label:this.translate.instant("COMMANDS.UNDO"),shortcuts:[{keySequence:[l.e.Meta,l.e.Z]}],data:{},shortcutText:"",context:v.a.Canvas}),this.featureList.register({id:"redo",commandEvent:R.a.redoAction,label:this.translate.instant("COMMANDS.REDO"),shortcuts:[{keySequence:[l.e.Meta,l.e.Shift,l.e.Z]}],data:{},shortcutText:"",context:v.a.Canvas}),this.featureList.register({id:"switchToPanMouseControlState",commandEvent:R.a.changeMouseControlState,label:this.translate.instant("COMMANDS.PAN"),shortcuts:[{keySequence:[l.e.Space],action:"keyup"},{keySequence:[l.e.Space],action:"keydown"}],data:{},shortcutText:"Space + Drag",attachKeyEventToData:!0,context:v.a.Canvas}),this.featureList.register({id:"boldText",commandEvent:R.a.applyTextEditorStyles,label:this.translate.instant("COMMANDS.BOLD"),shortcuts:[],data:{styles:{bold:null}},shortcutText:"",attachKeyEventToData:!1,context:v.a.Text,icon:"nu-ic-bold"}),this.featureList.register({id:"boldModelText",commandEvent:R.a.applyShapeStyle,label:this.translate.instant("COMMANDS.BOLD"),shortcuts:[],data:{style:"bold",value:null},shortcutText:"",attachKeyEventToData:!1,context:v.a.All,transformer:z.a,icon:"nu-ic-bold"}),this.featureList.register({id:"italicModelText",commandEvent:R.a.applyShapeStyle,label:this.translate.instant("COMMANDS.ITALIC"),shortcuts:[],data:{style:"italic",value:null},shortcutText:"",attachKeyEventToData:!1,context:v.a.All,transformer:z.a,icon:"nu-ic-italic"}),this.featureList.register({id:"underlineModelText",commandEvent:R.a.applyShapeStyle,label:this.translate.instant("COMMANDS.UNDERLINE"),shortcuts:[],data:{style:"underline",value:null},shortcutText:"",attachKeyEventToData:!1,context:v.a.All,transformer:z.a,icon:"nu-ic-underline"}),this.featureList.register({id:"strikeoutModelText",commandEvent:R.a.applyShapeStyle,label:this.translate.instant("COMMANDS.STRIKE_OUT"),shortcuts:[],data:{style:"strikeout",value:null},shortcutText:"",attachKeyEventToData:!1,context:v.a.All,transformer:z.a,icon:"nu-ic-strikethrough"}),this.featureList.register({id:"leftAlignModelText",commandEvent:R.a.applyShapeStyle,label:this.translate.instant("COMMANDS.LEFT_ALIGN"),shortcuts:[],data:{style:"align",value:"left"},shortcutText:"",attachKeyEventToData:!1,context:v.a.All,transformer:z.a,icon:"nu-ic-text-align-left"}),this.featureList.register({id:"centerAlignModelText",commandEvent:R.a.applyShapeStyle,label:this.translate.instant("COMMANDS.CENTER_ALIGN"),shortcuts:[],data:{style:"align",value:"center"},shortcutText:"",attachKeyEventToData:!1,context:v.a.All,transformer:z.a,icon:"nu-ic-text-align-center"}),this.featureList.register({id:"rightAlignModelText",commandEvent:R.a.applyShapeStyle,label:this.translate.instant("COMMANDS.RIGHT_ALIGN"),shortcuts:[],data:{style:"align",value:"right"},shortcutText:"",attachKeyEventToData:!1,context:v.a.All,transformer:z.a,icon:"nu-ic-text-align-right"}),this.featureList.register({id:"sizeModelText",dataType:l.c.OPTION_LIST_COMBO,commandEvent:R.a.applyShapeStyle,label:this.translate.instant("COMMANDS.SIZE"),shortcuts:[],data:{style:"size",validation:{type:l.c.NUMBER,rules:{max:500,min:1,decimal:!1}}},shortcutText:"",attachKeyEventToData:!1,context:v.a.All,transformer:z.a,icon:"nu-ic-size"}),this.featureList.register({id:"fontModelText",dataType:l.c.OPTION_LIST_COMBO,commandEvent:R.a.applyShapeStyle,label:this.translate.instant("COMMANDS.FONT"),shortcuts:[],data:{style:"font",readOnly:!0,validation:{type:l.c.STRING,rules:{}}},shortcutText:"",attachKeyEventToData:!1,context:v.a.All,transformer:z.a}),this.featureList.register({id:"colorModelText",dataType:l.c.COLOR,commandEvent:R.a.applyShapeStyle,label:this.translate.instant("COMMANDS.TEXT_COLOR"),shortcuts:[],data:{style:"color"},shortcutText:"",attachKeyEventToData:!1,context:v.a.All,transformer:z.a}),this.featureList.register({id:"colorFill",dataType:l.c.COLOR,commandEvent:R.a.applyShapeStyle,label:this.translate.instant("COMMANDS.FILL_COLOR"),shortcuts:[],data:{style:"fillColor"},shortcutText:"",attachKeyEventToData:!1,context:v.a.All,transformer:Z.a}),this.featureList.register({id:"colorLine",dataType:l.c.COLOR,commandEvent:R.a.applyShapeStyle,label:this.translate.instant("COMMANDS.LINE_COLOR"),shortcuts:[],data:{style:"lineColor"},shortcutText:"",attachKeyEventToData:!1,context:v.a.All,transformer:Z.a}),this.featureList.register({id:"styleLine",dataType:l.c.OPTION_LIST,commandEvent:R.a.applyShapeStyle,label:this.translate.instant("COMMANDS.LINE_STYLE"),dropdownDirection:"up",shortcuts:[],data:{style:"lineStyle"},shortcutText:"",attachKeyEventToData:!1,context:v.a.All,transformer:Z.a}),this.featureList.register({id:"lineThickness",dataType:l.c.NUMBER,commandEvent:R.a.applyShapeStyle,label:this.translate.instant("COMMANDS.LINE_THICKNESS"),labelPosition:"top",shortcuts:[],data:{style:"lineThickness"},shortcutText:"",attachKeyEventToData:!1,context:v.a.All,transformer:Z.a}),this.featureList.register({id:"italicText",commandEvent:R.a.applyTextEditorStyles,label:this.translate.instant("COMMANDS.ITALIC"),shortcuts:[],data:{styles:{italic:null}},shortcutText:"",attachKeyEventToData:!1,context:v.a.Text,icon:"nu-ic-italic"}),this.featureList.register({id:"strikeoutText",commandEvent:R.a.applyTextEditorStyles,label:this.translate.instant("COMMANDS.STRIKE_OUT"),shortcuts:[],data:{styles:{strikeout:null}},shortcutText:"",attachKeyEventToData:!1,context:v.a.Text,icon:"nu-ic-strikethrough"}),this.featureList.register({id:"underlineText",commandEvent:R.a.applyTextEditorStyles,label:this.translate.instant("COMMANDS.UNDERLINE"),shortcuts:[],data:{styles:{underline:null}},shortcutText:"",attachKeyEventToData:!1,context:v.a.Text,icon:"nu-ic-underline"}),this.featureList.register({id:"bringToFront",commandEvent:R.a.bringToFront,label:this.translate.instant("COMMANDS.BRING_TO_FRONT"),shortcuts:[{keySequence:[l.e.Meta,l.e.Alt,l.e.BracketRight]}],data:{},shortcutText:"",context:v.a.Canvas}),this.featureList.register({id:"sendToBack",commandEvent:R.a.sendToBack,label:this.translate.instant("COMMANDS.SEND_TO_BACK"),shortcuts:[{keySequence:[l.e.Meta,l.e.Alt,l.e.BracketLeft]}],data:{},shortcutText:"",context:v.a.Canvas}),this.featureList.register({id:"sendBackward",commandEvent:R.a.sendBackward,label:this.translate.instant("COMMANDS.SEND_BACKWARDS"),shortcuts:[{keySequence:[l.e.Meta,l.e.BracketLeft]}],data:{},shortcutText:"",context:v.a.Canvas}),this.featureList.register({id:"bringForward",commandEvent:R.a.bringForward,label:this.translate.instant("COMMANDS.BRING_FORWARD"),shortcuts:[{keySequence:[l.e.Meta,l.e.BracketRight]}],data:{},shortcutText:"",context:v.a.Canvas}),this.featureList.register({id:"alignShapes",dataType:l.c.OPTION_IMAGES,commandEvent:ie.alignShapes,label:"",icon:"align-v-center",shortcuts:[],data:{},shortcutText:"",context:v.a.Canvas,transformer:N.a}),this.featureList.register({id:"sizeText",dataType:l.c.OPTION_LIST,commandEvent:R.a.applyTextEditorStyles,label:this.translate.instant("COMMANDS.SIZE"),shortcuts:[],data:{validation:{type:l.c.NUMBER,rules:{max:500,min:1,decimal:!1}}},shortcutText:"",attachKeyEventToData:!1,context:v.a.Text,icon:"",transformer:H.a}),this.featureList.register({id:"colorText",dataType:l.c.OPTION_IMAGES,commandEvent:R.a.applyTextEditorStyles,label:this.translate.instant("COMMANDS.COLOR"),shortcuts:[],data:{},shortcutText:"",attachKeyEventToData:!1,context:v.a.Text,icon:"",transformer:F.a}),this.featureList.register({id:"textPosition",dataType:l.c.TEXT_POSITION,commandEvent:R.a.positionText,label:"Position Text",shortcuts:[],data:{},shortcutText:"",attachKeyEventToData:!1,context:v.a.Canvas,icon:"",transformer:a.a}),this.featureList.register({id:"selectionPositionX",dataType:l.c.NUMBER,commandEvent:ie.transformShapesAndConnectors,label:"X",labelPosition:"left",shortcuts:[],data:{readOnly:!0},shortcutText:"",attachKeyEventToData:!1,context:v.a.All,transformer:K.a}),this.featureList.register({id:"selectionPositionY",dataType:l.c.NUMBER,commandEvent:ie.transformShapesAndConnectors,label:"Y",labelPosition:"left",shortcuts:[],data:{readOnly:!0},shortcutText:"",attachKeyEventToData:!1,context:v.a.All,transformer:K.a}),this.featureList.register({id:"selectionWidth",dataType:l.c.NUMBER,commandEvent:ie.transformShapesAndConnectors,label:"W",labelPosition:"left",shortcuts:[],data:{readOnly:!0},shortcutText:"",attachKeyEventToData:!1,context:v.a.All,transformer:K.a}),this.featureList.register({id:"selectionHeight",dataType:l.c.NUMBER,commandEvent:ie.transformShapesAndConnectors,label:"H",labelPosition:"left",shortcuts:[],data:{readOnly:!0},shortcutText:"",attachKeyEventToData:!1,context:v.a.All,transformer:K.a}),this.featureList.register({id:"selectionAngle",dataType:l.c.NUMBER,commandEvent:ie.transformShapesAndConnectors,label:"A",labelPosition:"left",shortcuts:[],data:{readOnly:!0},shortcutText:"",attachKeyEventToData:!1,context:v.a.All,transformer:K.a}),this.featureList.register({id:"connectorStartX",dataType:l.c.NUMBER,commandEvent:ie.transformShapesAndConnectors,label:"X1",labelPosition:"left",shortcuts:[],data:{readOnly:!0},shortcutText:"",attachKeyEventToData:!1,context:v.a.All,transformer:K.a}),this.featureList.register({id:"connectorStartY",dataType:l.c.NUMBER,commandEvent:ie.transformShapesAndConnectors,label:"Y1",labelPosition:"left",shortcuts:[],data:{readOnly:!0},shortcutText:"",attachKeyEventToData:!1,context:v.a.All,transformer:K.a}),this.featureList.register({id:"connectorEndX",dataType:l.c.NUMBER,commandEvent:ie.transformShapesAndConnectors,label:"X2",labelPosition:"left",shortcuts:[],data:{readOnly:!0},shortcutText:"",attachKeyEventToData:!1,context:v.a.All,transformer:K.a}),this.featureList.register({id:"connectorEndY",dataType:l.c.NUMBER,commandEvent:ie.transformShapesAndConnectors,label:"Y2",labelPosition:"left",shortcuts:[],data:{readOnly:!0},shortcutText:"",attachKeyEventToData:!1,context:v.a.All,transformer:K.a}),this.featureList.register({id:"customShapeStyles",dataType:l.c.CUSTOM_SHAPE_STYLE,commandEvent:R.a.applyShapeStyle,label:"Custom Styles",labelPosition:"top",shortcuts:[],data:{},shortcutText:"",attachKeyEventToData:!1,context:v.a.All,transformer:Y.a}),this.featureList.register({id:"groupShapes",dataType:l.c.BINARY,commandEvent:ie.groupShapes,label:this.translate.instant("COMMANDS.GROUP"),shortcuts:[{keySequence:[l.e.Meta,l.e.G]}],data:{},icon:"nu-ic-group",shortcutText:"",context:v.a.Canvas,transformer:X.a}),this.featureList.register({id:"ungroupShapes",dataType:l.c.BINARY,commandEvent:ie.unGroupShapes,label:this.translate.instant("COMMANDS.UNGROUP"),shortcuts:[{keySequence:[l.e.Meta,l.e.Shift,l.e.G]}],data:{},icon:"nu-ic-ungroup",shortcutText:"",context:v.a.Canvas,transformer:X.a}),this.featureList.register({id:"showConnectorBumps",commandEvent:R.a.toggleConnectorLineBumps,label:this.translate.instant("COMMANDS.SHOW_LINE_BUMPS"),shortcuts:[],data:{showLineBumps:!0,selection:!0},shortcutText:"",context:v.a.Canvas,transformer:In.a}),this.featureList.register({id:"hideConnectorBumps",commandEvent:R.a.toggleConnectorLineBumps,label:this.translate.instant("COMMANDS.HIDE_LINE_BUMPS"),shortcuts:[],data:{showLineBumps:!1,selection:!0},shortcutText:"",context:v.a.Canvas,transformer:In.a}),this.featureList.register({id:"pasteItems",commandEvent:R.a.pasteItems,label:this.translate.instant("COMMANDS.PASTE"),shortcuts:[{keySequence:[l.e.Meta,l.e.V],repeatOnKeyPress:300}],data:{},shortcutText:"",context:v.a.Canvas})},e}(b.a),Rn=n("C0rp"),Bn=n("icD7"),Nn=n("XeU7"),_n=function(){function t(t,e){this.element=t,this.editor=Rn.editor.create(t,e,!1),this.eventEmitters=[]}return t.prototype.setContent=function(t,e){e&&this.editor.setDefaultStyles(e),this.editor.load(t)},t.prototype.getContent=function(){return this.editor.save()},t.prototype.applyDefaultStyles=function(t){this.editor.setDefaultStyles(t)},t.prototype.getHTMLContent=function(){return Rn.html.html(this.editor.save())},t.prototype.setWidth=function(t){this.element.style.width=t},t.prototype.listenToEvent=function(t,e){var n=this;return we.a.create(function(i){var r=function(t){return i.next(t)};return Rn.dom.handleEvent(t,e,r),n.eventEmitters.push(i),function(){Rn.dom.removeEvent(t,e,r),n.removeObserver(i)}})},t.prototype.getContentUpdate=function(){return this.listenToEvent(this.editor.canvas,"content-update")},t.prototype.getSelectionFormat=function(){var t=this;return we.a.create(function(e){return t.editor.selectionChanged(function(t){return e.next(t())}),t.eventEmitters.push(e),function(){t.removeObserver(e)}})},t.prototype.applyStyles=function(t){var e=this.editor.selectedRange();Object.keys(t.styles).forEach(function(n){e.setFormatting(n,t.styles[n],t.takeFocus)})},t.prototype.getFocusOut=function(){return this.listenToEvent(this.editor.canvas,"blur")},t.prototype.getKeyDownEvent=function(t){return this.listenToEvent(this.editor.textArea,"keydown").pipe(Object(p.a)(function(e){return e.keyCode===t}),Object(d.a)(function(t){t.stopPropagation(),t.preventDefault()}))},t.prototype.getKeyUpEvent=function(t){return this.listenToEvent(this.editor.textArea,"keyup").pipe(Object(p.a)(function(e){return e.keyCode===t}),Object(d.a)(function(t){t.stopPropagation(),t.preventDefault()}))},t.prototype.removeObserver=function(t){t.complete();var e=this.eventEmitters.findIndex(function(e){return e===t});e>-1&&this.eventEmitters.splice(e,1)},t.prototype.destroy=function(){for(;this.eventEmitters.length;)this.eventEmitters.pop().complete()},Object.defineProperty(t.prototype,"bounds",{get:function(){var t=this.element,e=t.getBoundingClientRect().top,n=t.getBoundingClientRect().left,i=this.editor.getZoomLevel();return new s.R(n,e,t.getBoundingClientRect().width/i,this.editor.frame.actualHeight())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"actualBounds",{get:function(){var t=this.element,e=parseInt(t.style.top,10),n=parseInt(t.style.left,10);return new s.R(n,e,this.editor.frame.actualWidth(),this.editor.frame.actualHeight())},enumerable:!0,configurable:!0}),t.prototype.focusAndMoveCaretToEnd=function(){this.editor.moveCaretToEnd()},t.prototype.moveCaretToPoint=function(t){this.editor.moveCaretToPoint(t)},t.prototype.selectAll=function(){this.editor.selectAll()},t.prototype.show=function(){this.element.style.display="block"},t.prototype.hide=function(){this.element.style.display="none"},t.prototype.zoom=function(t){this.element.style.transform="scale("+t+")",this.element.style.transformOrigin="0px 0px 0px",this.editor.setZoomLevel(t)},t.prototype.setBackgroundColor=function(t){this.element.style.backgroundColor=t},t}();!function(t){t[t.Init=0]="Init",t[t.ContentUpdate=1]="ContentUpdate",t[t.PanZoomChange=2]="PanZoomChange"}(Mn||(Mn={}));var Gn=function(){function t(t,e,n,i,r){this.toolbarManager=t,this.dToVcoordinate=e,this.commandService=n,this.ll=i,this.state=r,this.subs=[],this.manualCommit=new Se.a}return Object.defineProperty(t.prototype,"containerElement",{get:function(){return this.container.nativeElement},enumerable:!0,configurable:!0}),t.prototype.ngAfterViewInit=function(){var t,e=this,n=[];this.editor=new _n(this.editorElement.nativeElement,l.b),this.containerElement.style.display="none";var i=this.getEditorOpen().pipe(Object(I.a)(function(t){if(!1===t.open){for(;n.length;){var i=n.pop();i&&i.unsubscribe()}return Object(ot.b)()}var r;return n.push(Object(q.a)(e.getTextApplied().pipe(Object(lt.a)(!1)),e.manualCommit.pipe(Object(lt.a)(!1)),e.getTextCanceled().pipe(Object(lt.a)(!0))).pipe(Object(h.a)(1)).subscribe(function(n){return e.exit(t,n)}),e.switchEditor().pipe(Object(I.a)(function(n){return e.handleEditorSwitch(t,n.direction,n.caret,r)})).subscribe()),Object(q.a)(e.getContentUpdate().pipe(Object(lt.a)(Mn.ContentUpdate)),e.getPanZoomChanges().pipe(Object(lt.a)(Mn.PanZoomChange))).pipe(Object(M.a)(Mn.Init),Object(I.a)(function(n){return n!==Mn.PanZoomChange?e.getTextModel(t,!0).pipe(Object(I.a)(function(i){return n===Mn.Init?Object(St.a)(e.wordWrap(t,i),e.setEditorContent(t.text,i)).pipe(Object(Bn.a)(),Object(ke.a)(i)):Object(St.a)(e.previewEditing(t,i,!0),e.wordWrap(t,i)).pipe(Object(Bn.a)(),Object(ke.a)(i))}),Object(T.a)(function(t){return{action:n,model:t}})):Object(u.a)({action:n})}),Object(I.a)(function(n){var i=n.model,o=n.action;return o!==Mn.PanZoomChange?e.calculatePosition(t.shapeId,i).pipe(Object(T.a)(function(e){return{point:r=e,status:t,action:o}})):Object(u.a)({point:r,status:t,action:o})}))})).pipe(Object(T.a)(function(t){e.updatePosition(t.point.x,t.point.y),t.action===Mn.Init&&e.moveCaret(t.point,t.status)})).subscribe();(t=this.subs).push.apply(t,o.j([i],n,[this.listentToToolbar().subscribe(),this.preserveStyles().subscribe(),this.listentToEditor(100).subscribe()]))},t.prototype.exit=function(t,e){this.commandService.dispatch(R.a.openTextEditor,{open:!1,cancel:e,shapeId:t.shapeId,textId:t.textId,point:t.point}),this.containerElement.style.display="none"},t.prototype.moveCaret=function(t,e){e.point?this.editor.moveCaretToPoint({x:e.point.x-t.x,y:e.point.y-t.y}):"end"===e.caretPosition?this.editor.focusAndMoveCaretToEnd():e.caretPosition||this.editor.selectAll()},t.prototype.preserveStyles=function(){var t=this;return this.getContentUpdate().pipe(Object(T.a)(function(e){return t.editor.getContent()}),Object(A.a)(function(t,e){return t[0]===e[0]}),Object(ue.a)(),Object(p.a)(function(t){var e=o.h(t,2),n=(e[0],e[1]);return Object(c.isEmpty)(n)}),Object(d.a)(function(e){var n=o.h(e,2),i=n[0];n[1];i[0]&&(delete i[0].text,t.editor.setContent([],Object(c.merge)({},l.b,i[0])))}))},t.prototype.listentToToolbar=function(){var t=this;return this.state.changes("TextToolbarState").pipe(Object(d.a)(function(e){return t.editor.applyStyles(e)}))},t.prototype.listentToEditor=function(t){var e=this;return this.editor.getSelectionFormat().pipe(Object(de.a)(t),Object(d.a)(function(t){"string"!=typeof t.color&&(t.color="#FFFFFF");var n=e.editor.editor.getSelectionBounds(),i=e.editor.bounds,r=e.state.get("DiagramPan"),o=e.state.get("DiagramZoomLevel");e.state.set("TextEditorState",{styles:t,selection:n,editorBounds:i,pan:r,zoom:o})}))},t.prototype.getTextModel=function(t,e){var n=this;return this.ll.forCurrent(!0).getShapeOnce(t.shapeId).pipe(Object(I.a)(function(i){if(i.type===l.l.Connector){var r=void 0;return t.point&&e&&(r=n.getPositionOnConnector(i,t.point)),n.getConnectorTextModel(t.shapeId,t.textId,r)}return n.getShapeTextModel(t.shapeId,t.textId)}))},t.prototype.setEditorContent=function(t,e){var n=this;return this.getDefaultStyles().pipe(Object(d.a)(function(i){if(t){var r=Rn.html.parse(e.value,i),o=void 0;r[0]&&(delete r[0].text,o=r[0]),n.editor.setContent(t,o||i),n.editor.focusAndMoveCaretToEnd()}else n.editor.setContent(e.value,i)}))},t.prototype.getDefaultStyles=function(){var t=this.state.get("Selected")[0];return this.ll.forCurrent(!0).getShapeOnce(t).pipe(Object(T.a)(function(t){return Object(c.merge)({},l.b,t.defaultTextFormat||{})}))},t.prototype.wordWrap=function(t,e){var n=this,i=this.ll.forCurrent(!0);return e instanceof Nn.a?(this.editor.setWidth((e.width||0)+10+"px"),Object(u.a)({})):i.getShapeOnce(t.shapeId).pipe(Object(d.a)(function(t){var i=e.hitArea?e.hitArea.width:t.bounds.width;e.wordWrap?(i-=2*l.o,i+=1):(i=e.width,i+=10),n.editor.setWidth(i+"px")}))},t.prototype.getPositionOnConnector=function(t,e){return t.getNearestPoint(e).location},t.prototype.ngOnDestroy=function(){for(this.editor.destroy();this.subs.length;){var t=this.subs.pop();t&&t.unsubscribe()}},t.prototype.getContentUpdate=function(){var t=this;return this.editor.getContentUpdate().pipe(Object(T.a)(function(){return t.editor.getContent()}),Object(A.a)(c.isEqual))},t.prototype.getEditorOpen=function(){var t=this;return this.state.changes("EditingText").pipe(Object(I.a)(function(e){return e.open&&(e.text?t.editor.setContent(e.text):t.editor.setContent([],l.b),t.containerElement.style.display="block",!e.textId)?t.getTextModel(e,!0).pipe(Object(T.a)(function(n){return e.textId=n.id,t.completeEditing(e,n,!0),e})):!1===e.open&&e.shapeId?t.getTextModel(e,!0).pipe(Object(T.a)(function(n){return t.completeEditing(e,n,!0),e})):Object(u.a)(e)}))},t.prototype.getPanZoomChanges=function(){var t=this;return Object(q.a)(this.state.changes("DiagramPan"),this.state.changes("DiagramZoomLevel").pipe(Object(d.a)(function(e){t.editorBackground.nativeElement.style.zoom=100*e+"%",t.editor.zoom(e)})))},t.prototype.getTextApplied=function(){var t=this;return Object(q.a)(this.editor.getFocusOut().pipe(Object(p.a)(function(){var e=t.toolbarManager.get("shape-text-toolbar");return!e||!e.isFocused()})),this.editor.getKeyDownEvent(l.e.Tab))},t.prototype.getTextCanceled=function(){return this.editor.getKeyDownEvent(l.e.Escape)},t.prototype.switchEditor=function(){var t=this.editor.editor,e=Object(q.a)(this.editor.getKeyDownEvent(l.e.ArrowUp).pipe(Object(lt.a)("up")),this.editor.getKeyDownEvent(l.e.ArrowLeft).pipe(Object(lt.a)("left"))),n=Object(q.a)(this.editor.getKeyDownEvent(l.e.ArrowDown).pipe(Object(lt.a)("down")),this.editor.getKeyDownEvent(l.e.ArrowRight).pipe(Object(lt.a)("right"))),i=Object(q.a)(this.editor.getKeyUpEvent(l.e.ArrowDown).pipe(Object(p.a)(function(){return t.isCaretAtEnd()})),this.editor.getKeyUpEvent(l.e.ArrowRight).pipe(Object(p.a)(function(){return t.isCaretAtEnd()}))),r=Object(q.a)(this.editor.getKeyUpEvent(l.e.ArrowUp).pipe(Object(p.a)(function(){return t.isCaretAtStart()})),this.editor.getKeyUpEvent(l.e.ArrowLeft).pipe(Object(p.a)(function(){return t.isCaretAtStart()})));return Object(q.a)(i.pipe(Object(I.a)(function(){return n.pipe(Object(Q.a)(e))})),r.pipe(Object(I.a)(function(){return e.pipe(Object(Q.a)(n))}))).pipe(Object(T.a)(function(e){return{direction:e,caret:t.getCurrentCaret()}}))},t.prototype.handleEditorSwitch=function(t,e,n,i){var r=this;return this.ll.forCurrent(!0).getDiagramOnce().pipe(Object(T.a)(function(n){var i=n.getTextToSwitchByArrowkeys(r.state.get("Selected"),t.textId,t.shapeId,e);i&&(r.manualCommit.next(!0),r.commandService.dispatch(R.a.openTextEditor,{open:!0,point:null,caretPosition:"up"===e||"left"===e?"end":"start",shapeId:i.shapeId,textId:i.textId}))}))},t.prototype.completeEditing=function(t,e,n){if(e&&!t.cancel){var i=this.editor.getContent(),r={shapeId:t.shapeId,text:Rn.html.html(i),content:i,textId:e.id};e instanceof Nn.a&&n&&(r.positionOnConnector=e.pos),this.commandService.dispatch(R.a.applyText,r)}},t.prototype.previewEditing=function(t,e,n){var i=this.editor.getContent(),r={shapeId:t.shapeId,text:Rn.html.html(i),content:i,textId:t.textId};return e instanceof Nn.a&&n&&(r.positionOnConnector=e.pos),this.commandService.preview(R.a.applyText,r)},t.prototype.calculatePosition=function(t,e){var n=this;return this.ll.forCurrent(!0).getShapeOnce(t).pipe(Object(T.a)(function(t){return t.type===l.l.Connector?Me.z.forConnector(t,e,n.editor.bounds):Me.z.forShape(e,t.defaultBounds,n.editor.bounds,t.transform)}))},t.prototype.getShapeTextModel=function(t,e){return this.ll.forCurrent(!0).getShapeOnce(t).pipe(Object(T.a)(function(t){var n=t.getText(e);return n||(n=t.createText()),n}))},t.prototype.getConnectorTextModel=function(t,e,n){return this.ll.forCurrent(!0).getShapeOnce(t).pipe(Object(T.a)(function(t){var i=t.getTextExisting(e),r=i||t.createText();return!i&&n&&(r.pos=n),r}))},t.prototype.updatePosition=function(t,e){t=this.dToVcoordinate.x(t),e=this.dToVcoordinate.y(e);var n=this.containerElement;n.style.top=e+"px",n.style.left=t+"px"},t}(),Vn=n("z3tU"),Yn=n("5Jpj"),Un=n("6T0K"),Xn=n("lP4r"),Zn=n("wkcE"),Kn=function(){function t(t,e,n){var i=this;this.ll=t,this.collabLocator=e,this.state=n,this.subs=[],this.buttons=new Be.a([{id:"image-import",icon:"image",tooltip:"TOOLTIPS.IMAGE",visible:!0},{id:"shapes",icon:"shapes",tooltip:"TOOLTIPS.SHAPES",visible:!0},{id:"search",icon:"search",tooltip:"Search Result",visible:!1}]),this.selectedPanel=new Be.a("shapes"),this.projectId=this.ll.forCurrent(!1).getDiagramModel().pipe(Object(T.a)(function(t){return"string"==typeof t.project?t.project:t.project.id})),this.subs.push(this.state.changes("ShapeSearchResults").subscribe(function(t){t.filteredDefAndVersion.length>0?(i.showHideLeftSideButton("search",!0),i.selectedPanel.next("search")):i.showHideLeftSideButton("search",!1)}))}return t.prototype.showHideLeftSideButton=function(t,e){var n=this.buttons.getValue();n.find(function(e){return e.id===t}).visible=e,this.buttons.next(n)},Object.defineProperty(t.prototype,"getShapeSearchResults",{get:function(){return this.state.changes("ShapeSearchResults").pipe(Object(T.a)(function(t){return t.filteredDefAndVersion.length>0}))},enumerable:!0,configurable:!0}),t.prototype.ngOnInit=function(){var t=this.state.get("CurrentUser");this.userMdl=this.collabLocator.getCollabs().pipe(Object(T.a)(function(e){return e.filter(function(e){return e.id===t})[0]}))},t.prototype.getIcon=function(t){return"./assets/icons/symbol-defs.svg#nu-ic-"+t},Object.defineProperty(t.prototype,"selectedPanelId",{get:function(){return this.selectedPanel.value},enumerable:!0,configurable:!0}),t.prototype.openUserProfile=function(){s.bb.track("left.profile.click"),window.open(s.h.get("SITE_URL")+"account/user/profile","_blank")},t.prototype.ngOnDestroy=function(){for(;this.subs.length;)this.subs.pop().unsubscribe()},t}(),zn=n("i0zf"),qn=n("yZNT"),Wn=function(){return function(t,e,n,i,r,o,a,s){this.mapper=t,this.defSumLocator=e,this.changeBindingSvc=n,this.textBoundsBinder=i,this.textDataItemBinder=r,this.shapeCodeBinder=o,this.searchService=a,this.defShapeSearchProvider=s,R.a.register(this.mapper),ie.register(this.mapper),e.load().subscribe(),this.changeBindingSvc.register(r),this.changeBindingSvc.register(i),this.changeBindingSvc.register(o),this.searchService.register(s)}}(),Jn=n("C9Ky"),Qn=n("XE7i"),$n=n("jHi0"),ti=n("zZcu"),ei=n("l81r"),ni=n("rwb9"),ii=n("K0+f"),ri=n("WT9V"),oi=n("LyVN"),ai=n("aT6q"),si=n("pYIu"),li=n("r78O"),ci=n("Wrqg"),ui=n("SUEH"),pi=n("NNJu"),hi=function(t){function e(e,n){var i=t.call(this,e)||this;return i.searchService=n,i.keydown=new Se.a,i.subs=[],i.inputChanged=new Se.a,i.focusOut=new Se.a,i.inputValueChanged=new Se.a,i.subs.push(i.inputValueChanged.pipe(Object(I.a)(function(t){return i.searchService.search(t,["shape"]).pipe(Object(h.a)(1),Object(T.a)(function(e){e?i.inputChanged.next({value:e.length,results:e,searchQuery:t}):i.inputChanged.next({})}))})).subscribe()),i}return o.d(e,t),e.prototype.ngOnDestroy=function(){for(;this.subs.length;)this.subs.pop().unsubscribe()},e.prototype.handleFocusOut=function(){this.focusOut.next(!0)},e}(pi.b),di=i.Db({encapsulation:2,styles:[],data:{}});function fi(t){return i.Zb(2,[(t()(),i.Fb(0,0,null,null,3,"a",[["class","sidebar-dd-button-container"]],null,null,null,null,null)),(t()(),i.Fb(1,0,null,null,2,"text-input",[["icon","search-thin"]],null,[[null,"focusout"],[null,"updateText"],[null,"keydown"]],function(t,e,n){var i=!0,r=t.component;"focusout"===e&&(i=!1!==r.handleFocusOut()&&i);"updateText"===e&&(i=!1!==r.inputValueChanged.next(n)&&i);"keydown"===e&&(i=!1!==r.keydown.next(n)&&i);return i},li.b,li.a)),i.Eb(2,245760,[["inputElement",4]],0,ci.a,[],{icon:[0,"icon"],showClearButton:[1,"showClearButton"],placeholder:[2,"placeholder"],emitForInputChange:[3,"emitForInputChange"],debounce:[4,"debounce"]},{updateText:"updateText",keydown:"keydown"}),i.Rb(131072,ti.j,[ti.k,i.i])],function(t,e){t(e,2,0,"search-thin",!0,i.Hb(1,"",i.Yb(e,2,2,i.Pb(e,3).transform("PLACEHOLDERS.SHAPE_SEARCH")),""),!0,200)},null)}i.Bb("shape-search-dropdown-input",hi,function(t){return i.Zb(0,[(t()(),i.Fb(0,0,null,null,2,"shape-search-dropdown-input",[],null,null,null,fi,di)),i.Ub(6144,null,ui.a,null,[hi]),i.Eb(2,180224,null,0,hi,[i.o,qn.a],null,null)],null,null)},{items:"items",readOnly:"readOnly"},{clicked:"clicked",inputChanged:"inputChanged",focusOut:"focusOut",keydown:"keydown"},[]);var bi=n("YztW"),gi=function(t){function e(e){var n=t.call(this,e)||this;return n.click=new Se.a,n}return o.d(e,t),e}(pi.c),vi=[[".shape-search-dd-list-item{display:flex;flex-direction:column;margin-bottom:10px;padding-left:10px;padding-right:10px;cursor:pointer;outline:0}.shape-search-dd-list-item:hover .shape-search-item-result-heading{color:#f6aa00}"]],yi=i.Db({encapsulation:2,styles:vi,data:{}});function mi(t){return i.Zb(0,[(t()(),i.Fb(0,0,null,null,1,"div",[["class","shape-search-item-result-heading"]],null,null,null,null,null)),(t()(),i.Xb(1,null,[" ",""]))],null,function(t,e){var n=e.component;t(e,1,0,n.item&&n.item.searchQuery?n.item.searchQuery:"")})}function Oi(t){return i.Zb(0,[(t()(),i.Fb(0,0,null,null,2,"div",[["class","fx-margin-top-5"]],null,[[null,"click"]],function(t,e,n){var i=!0,r=t.component;"click"===e&&(i=!1!==r.click.next(r.$evet)&&i);return i},null,null)),(t()(),i.Fb(1,0,null,null,1,"label",[["class","grey nu-text-xsmall"]],null,null,null,null,null)),(t()(),i.Xb(2,null,[""," results on Creately"]))],null,function(t,e){t(e,2,0,e.component.item.value)})}function Si(t){return i.Zb(0,[(t()(),i.Fb(0,0,null,null,2,"label",[["translate",""]],null,null,null,null,null)),i.Eb(1,8536064,null,0,ti.e,[ti.k,i.o,i.i],{translate:[0,"translate"]},null),(t()(),i.Xb(-1,null,["LABELS.NO_SEARCH_RESULTS"]))],function(t,e){t(e,1,0,"")},null)}function xi(t){return i.Zb(2,[(t()(),i.Fb(0,0,null,null,6,"li",[["class","shape-search-dd-list-item"],["tabindex","-1"]],null,null,null,null,null)),(t()(),i.wb(16777216,null,null,1,null,mi)),i.Eb(2,16384,null,0,ri.k,[i.db,i.Y],{ngIf:[0,"ngIf"]},null),(t()(),i.wb(16777216,null,null,1,null,Oi)),i.Eb(4,16384,null,0,ri.k,[i.db,i.Y],{ngIf:[0,"ngIf"]},null),(t()(),i.wb(16777216,null,null,1,null,Si)),i.Eb(6,16384,null,0,ri.k,[i.db,i.Y],{ngIf:[0,"ngIf"]},null)],function(t,e){var n=e.component;t(e,2,0,!n.item||n.item&&n.item.value>0),t(e,4,0,n.item&&n.item.value>0),t(e,6,0,!n.item||n.item&&0===n.item.value)},null)}i.Bb("shape-search-dropdown-item",gi,function(t){return i.Zb(0,[(t()(),i.Fb(0,0,null,null,2,"shape-search-dropdown-item",[],null,null,null,xi,yi)),i.Ub(6144,null,bi.a,null,[gi]),i.Eb(2,180224,null,0,gi,[i.o],null,null)],null,null)},{item:"item"},{changed:"changed",click:"click"},[]);var Ci=n("ZC55"),Pi=function(){function t(t,e){var n=this;this.modalController=t,this.state=e,this.change=new Be.a(null),this.close=new Be.a(!1),this.subs=[],this.subs.push(this.close.pipe(Object(D.a)(200)).subscribe(function(t){t&&n.absDropdown.close()}))}return t.prototype.handleKeydown=function(t){t.keyCode===l.e.Enter&&this.setState()},t.prototype.setState=function(){var t=[];this.change.value.results.forEach(function(e){t.push({defId:e.id,version:e.version})}),this.state.set("ShapeSearchResults",{filteredDefAndVersion:t,searchQuery:this.change.getValue().searchQuery})},t.prototype.openLibBrowser=function(){this.modalController.show(Ci.a)},t.prototype.ngOnDestroy=function(){for(;this.subs.length>0;)this.subs.pop().unsubscribe()},t}(),wi=n("cV4H"),Ei=n("24h1"),ji=[oi.a],Ii=i.Db({encapsulation:0,styles:ji,data:{}});function Ti(t){return i.Zb(2,[i.Vb(402653184,1,{absDropdown:0}),(t()(),i.Fb(1,0,null,null,15,"abs-dropdown",[["class","dropdown-item shape-search-dropdown"]],null,null,null,ai.b,ai.a)),i.Eb(2,1228800,[[1,4]],2,si.a,[i.o],{autoPosition:[0,"autoPosition"],settings:[1,"settings"]},null),i.Vb(603979776,2,{dropDownItems:1}),i.Vb(335544320,3,{dropDownButton:0}),i.Sb(5,{closeOnItemClicked:0,openOnHover:1,closeOnBlur:2}),(t()(),i.Fb(6,0,null,0,2,"shape-search-dropdown-input",[["ddbutton",""]],null,[[null,"focusOut"],[null,"keydown"],[null,"inputChanged"]],function(t,e,n){var i=!0,r=t.component;"focusOut"===e&&(i=!1!==r.close.next(!0)&&i);"keydown"===e&&(i=!1!==r.handleKeydown(n)&&i);"inputChanged"===e&&(i=!1!==r.change.next(n)&&i);return i},fi,di)),i.Eb(7,180224,null,0,hi,[i.o,qn.a],{readOnly:[0,"readOnly"]},{inputChanged:"inputChanged",focusOut:"focusOut",keydown:"keydown"}),i.Ub(2048,[[3,4]],ui.a,null,[hi]),(t()(),i.Fb(9,0,null,1,3,"shape-search-dropdown-item",[["dditem",""]],null,[[null,"click"]],function(t,e,n){var i=!0,r=t.component;"click"===e&&(i=!1!==r.setState()&&i);return i},xi,yi)),i.Eb(10,180224,null,0,gi,[i.o],{item:[0,"item"]},{click:"click"}),i.Rb(131072,ri.b,[i.i]),i.Ub(2048,[[2,4]],bi.a,null,[gi]),(t()(),i.Fb(13,0,null,1,3,"div",[["class","shape-search-browse-more-btn fx-center-all"],["dditem",""]],null,null,null,null,null)),(t()(),i.Fb(14,0,null,null,2,"button",[["class","nu-btn-med fx-span-width secondary fx-no-margin fx-no-padding fx-not-round"],["translate",""]],null,[[null,"click"]],function(t,e,n){var i=!0,r=t.component;"click"===e&&(i=!1!==r.openLibBrowser()&&i);return i},null,null)),i.Eb(15,8536064,null,0,ti.e,[ti.k,i.o,i.i],{translate:[0,"translate"]},null),(t()(),i.Xb(-1,null,[" BUTTONS.BROWSE_MORE_LIBS "]))],function(t,e){var n=e.component,r=t(e,5,0,!0,!1,!1);t(e,2,0,!1,r);t(e,7,0,!1),t(e,10,0,i.Yb(e,10,0,i.Pb(e,11).transform(n.change)));t(e,15,0,"")},null)}i.Bb("shape-search-sidebar-input-list-dropdown",Pi,function(t){return i.Zb(0,[(t()(),i.Fb(0,0,null,null,1,"shape-search-sidebar-input-list-dropdown",[],null,null,null,Ti,Ii)),i.Eb(1,180224,null,0,Pi,[wi.a,Ei.a],null,null)],null,null)},{},{},[]);var Mi=n("1OUs"),Di=function(){function t(t){this.state=t}return t.prototype.setMouseControlState=function(t){t!==this.state.get("MouseControlState")?this.state.set("MouseControlState",t):this.state.set("MouseControlState",m.b.Normal)},t}(),Ai=[[".insert-btn[_ngcontent-%COMP%]{height:40px;width:40px;border:1px dashed #d7d7d7}"]],ki=i.Db({encapsulation:0,styles:Ai,data:{}});function Li(t){return i.Zb(2,[(t()(),i.Fb(0,0,null,null,60,"div",[["class","ibc-btns-container fx-justify-space-between no-gutters fx-margin-top-10"]],null,null,null,null,null)),(t()(),i.Fb(1,0,null,null,11,"div",[["class","insert-btn fx-center-all"],["placement","bottom"],["tooltip",""]],null,null,null,null,null)),i.Eb(2,81920,null,0,$n.a,[i.o],{placement:[0,"placement"]},null),(t()(),i.Fb(3,0,null,null,6,"button",[["class","nu-btn-med nu-btn-icon"]],null,[[null,"click"]],function(t,e,n){var r=!0,o=t.component;"click"===e&&(r=!1!==i.Pb(t,6).onClick(n)&&r);"click"===e&&(r=!1!==o.setMouseControlState("text")&&r);return r},null,null)),i.Eb(4,212992,null,0,Mi.a,[Ei.a,i.P,i.o],{ifStateClass:[0,"ifStateClass"]},null),i.Qb(5,3),i.Eb(6,16384,null,0,ii.a,[],{trackAction:[0,"trackAction"]},null),i.Sb(7,{event:0}),(t()(),i.Fb(8,0,null,null,1,":svg:svg",[["class","nu-icon nu-ic-text"]],null,null,null,null,null)),(t()(),i.Fb(9,0,null,null,0,":svg:use",[[":xlink:href","./assets/icons/symbol-defs.svg#nu-ic-text"]],null,null,null,null,null)),(t()(),i.Fb(10,0,null,null,2,"span",[["class","tooltip-content"],["translate",""]],null,null,null,null,null)),i.Eb(11,8536064,null,0,ti.e,[ti.k,i.o,i.i],{translate:[0,"translate"]},null),(t()(),i.Xb(-1,null,["LABELS.TEXT"])),(t()(),i.Fb(13,0,null,null,11,"div",[["class","insert-btn fx-center-all"],["placement","bottom"],["tooltip",""]],null,null,null,null,null)),i.Eb(14,81920,null,0,$n.a,[i.o],{placement:[0,"placement"]},null),(t()(),i.Fb(15,0,null,null,6,"button",[["class","nu-btn-med nu-btn-icon"]],null,[[null,"click"]],function(t,e,n){var r=!0,o=t.component;"click"===e&&(r=!1!==i.Pb(t,18).onClick(n)&&r);"click"===e&&(r=!1!==o.setMouseControlState("connector")&&r);return r},null,null)),i.Eb(16,212992,null,0,Mi.a,[Ei.a,i.P,i.o],{ifStateClass:[0,"ifStateClass"]},null),i.Qb(17,3),i.Eb(18,16384,null,0,ii.a,[],{trackAction:[0,"trackAction"]},null),i.Sb(19,{event:0}),(t()(),i.Fb(20,0,null,null,1,":svg:svg",[["class","nu-icon nu-ic-line"]],null,null,null,null,null)),(t()(),i.Fb(21,0,null,null,0,":svg:use",[[":xlink:href","./assets/icons/symbol-defs.svg#nu-ic-line"]],null,null,null,null,null)),(t()(),i.Fb(22,0,null,null,2,"span",[["class","tooltip-content"],["translate",""]],null,null,null,null,null)),i.Eb(23,8536064,null,0,ti.e,[ti.k,i.o,i.i],{translate:[0,"translate"]},null),(t()(),i.Xb(-1,null,["TOOLTIPS.LINE"])),(t()(),i.Fb(25,0,null,null,17,"div",[["class","insert-btn fx-center-all"],["placement","bottom"],["tooltip",""]],null,null,null,null,null)),i.Eb(26,81920,null,0,$n.a,[i.o],{placement:[0,"placement"]},null),(t()(),i.Fb(27,0,null,null,4,"button",[["class","nu-btn-med nu-btn-icon"],["disabled",""]],null,[[null,"click"]],function(t,e,n){var r=!0;"click"===e&&(r=!1!==i.Pb(t,28).onClick(n)&&r);return r},null,null)),i.Eb(28,16384,null,0,ii.a,[],{trackAction:[0,"trackAction"]},null),i.Sb(29,{event:0}),(t()(),i.Fb(30,0,null,null,1,":svg:svg",[["class","nu-icon nu-ic-templates"]],null,null,null,null,null)),(t()(),i.Fb(31,0,null,null,0,":svg:use",[[":xlink:href","./assets/icons/symbol-defs.svg#nu-ic-note"]],null,null,null,null,null)),(t()(),i.Fb(32,0,null,null,10,"div",[["class","coming-soon-tooltip-container tooltip-content"]],null,null,null,null,null)),(t()(),i.Fb(33,0,null,null,6,"div",[["class","coming-soon-header"]],null,null,null,null,null)),(t()(),i.Fb(34,0,null,null,2,"span",[["class","tooltip-header"],["translate",""]],null,null,null,null,null)),i.Eb(35,8536064,null,0,ti.e,[ti.k,i.o,i.i],{translate:[0,"translate"]},null),(t()(),i.Xb(-1,null,["FAKE_TOOLTIPS.NOTE"])),(t()(),i.Fb(37,0,null,null,2,"div",[["class","coming-soon-header-ribbon"],["translate",""]],null,null,null,null,null)),i.Eb(38,8536064,null,0,ti.e,[ti.k,i.o,i.i],{translate:[0,"translate"]},null),(t()(),i.Xb(-1,null,["LABELS.COMING_SOON"])),(t()(),i.Fb(40,0,null,null,2,"div",[["class","coming-soon-feature-text"],["translate",""]],null,null,null,null,null)),i.Eb(41,8536064,null,0,ti.e,[ti.k,i.o,i.i],{translate:[0,"translate"]},null),(t()(),i.Xb(-1,null,["FAKE_TOOLTIPS.NOTE_DESC"])),(t()(),i.Fb(43,0,null,null,17,"div",[["class","insert-btn fx-center-all"],["placement","bottom"],["tooltip",""]],null,null,null,null,null)),i.Eb(44,81920,null,0,$n.a,[i.o],{placement:[0,"placement"]},null),(t()(),i.Fb(45,0,null,null,4,"button",[["class","nu-btn-med nu-btn-icon"],["disabled",""]],null,[[null,"click"]],function(t,e,n){var r=!0;"click"===e&&(r=!1!==i.Pb(t,46).onClick(n)&&r);return r},null,null)),i.Eb(46,16384,null,0,ii.a,[],{trackAction:[0,"trackAction"]},null),i.Sb(47,{event:0}),(t()(),i.Fb(48,0,null,null,1,":svg:svg",[["class","nu-icon nu-ic-templates"]],null,null,null,null,null)),(t()(),i.Fb(49,0,null,null,0,":svg:use",[[":xlink:href","./assets/icons/symbol-defs.svg#nu-ic-rectangle"]],null,null,null,null,null)),(t()(),i.Fb(50,0,null,null,10,"div",[["class","coming-soon-tooltip-container tooltip-content"]],null,null,null,null,null)),(t()(),i.Fb(51,0,null,null,6,"div",[["class","coming-soon-header"]],null,null,null,null,null)),(t()(),i.Fb(52,0,null,null,2,"span",[["class","tooltip-header"],["translate",""]],null,null,null,null,null)),i.Eb(53,8536064,null,0,ti.e,[ti.k,i.o,i.i],{translate:[0,"translate"]},null),(t()(),i.Xb(-1,null,["FAKE_TOOLTIPS.RECT"])),(t()(),i.Fb(55,0,null,null,2,"div",[["class","coming-soon-header-ribbon"],["translate",""]],null,null,null,null,null)),i.Eb(56,8536064,null,0,ti.e,[ti.k,i.o,i.i],{translate:[0,"translate"]},null),(t()(),i.Xb(-1,null,["LABELS.COMING_SOON"])),(t()(),i.Fb(58,0,null,null,2,"div",[["class","coming-soon-feature-text"],["translate",""]],null,null,null,null,null)),i.Eb(59,8536064,null,0,ti.e,[ti.k,i.o,i.i],{translate:[0,"translate"]},null),(t()(),i.Xb(-1,null,["FAKE_TOOLTIPS.RECT_DESC"]))],function(t,e){t(e,2,0,"bottom");var n=t(e,5,0,"MouseControlState","text","active");t(e,4,0,n);var i=t(e,7,0,"left.toolbar.text.click");t(e,6,0,i);t(e,11,0,"");t(e,14,0,"bottom");var r=t(e,17,0,"MouseControlState","connector","active");t(e,16,0,r);var o=t(e,19,0,"left.toolbar.connector.click");t(e,18,0,o);t(e,23,0,"");t(e,26,0,"bottom");var a=t(e,29,0,"left.toolbar.templates.click");t(e,28,0,a);t(e,35,0,"");t(e,38,0,"");t(e,41,0,"");t(e,44,0,"bottom");var s=t(e,47,0,"left.toolbar.templates.click");t(e,46,0,s);t(e,53,0,"");t(e,56,0,"");t(e,59,0,"")},null)}i.Bb("insert-buttons-container",Di,function(t){return i.Zb(0,[(t()(),i.Fb(0,0,null,null,1,"insert-buttons-container",[],null,null,null,Li,ki)),i.Eb(1,49152,null,0,Di,[Ei.a],null,null)],null,null)},{},{},[]);var Fi=n("7pFi"),Hi=n("YEP7"),Ri=n("Ownj"),Bi=[[".col-menu-container[_ngcontent-%COMP%]{height:100%;display:flex;flex-direction:column;overflow:hidden;padding-top:10px}"]],Ni=i.Db({encapsulation:0,styles:Bi,data:{}});function _i(t){return i.Zb(2,[i.Vb(402653184,1,{componentContainer:0}),(t()(),i.Fb(1,0,null,null,1,"div",[["class","col-menu-container"]],null,null,null,null,null)),(t()(),i.Fb(2,16777216,[[1,3],["componentContainer",1]],null,0,"div",[["class","fx-invisible-item"]],null,null,null,null,null))],null,null)}i.Bb("collapsible-menu",Ri.a,function(t){return i.Zb(0,[(t()(),i.Fb(0,0,null,null,1,"collapsible-menu",[],null,null,null,_i,Ni)),i.Eb(1,180224,null,0,Ri.a,[i.l,i.x],null,null)],null,null)},{},{childRemoved:"childRemoved"},[]);var Gi=n("0jHB"),Vi=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o.d(e,t),Object.defineProperty(e.prototype,"libId",{get:function(){return this.id},set:function(t){this.id=t},enumerable:!0,configurable:!0}),e}(Re.a),Yi=n("kgIF"),Ui=function(){function t(t,e,n){this.resourceLoader=t,this.defLocator=e,this.connectorRegistry=n}return Object.defineProperty(t.prototype,"libraryLocation",{get:function(){return s.h.get("RESOURCE_LOCATION")+s.h.get("LIBRARY_RESOURCE_BASE")},enumerable:!0,configurable:!0}),t.prototype.load=function(t){var e=this;return this.getShapeLibrary(t).pipe(Object(I.a)(function(t){if(!t.defs.length)return Object(u.a)(t);var n=t.defs.map(function(t){return e.loadDefinition(t)});return Je.a.apply(void 0,o.j(n)).pipe(Object(T.a)(function(n){return t.defs=n,n.forEach(function(t){return e.registerConnector(t)}),t}))}))},t.prototype.registerConnector=function(t){"connector"===t.type&&this.connectorRegistry.register(t)},t.prototype.getShapeLibrary=function(t){var e=this,n=this.getLibDefLocation(t);return this.resourceLoader.load(n).pipe(Object(I.a)(function(t){return e.createShapeLibrary(t)}))},t.prototype.getLibDefLocation=function(t){return this.libraryLocation+t+".json"},t.prototype.createShapeLibrary=function(t){return s.x.create(t).structure(Vi).build()},t.prototype.loadDefinition=function(t){var e=t.split("."),n=parseInt(e.pop(),10),i=e.join(".");return this.defLocator.getDefinition(i,n)},t}(),Xi=function(){function t(t){this.state=t,this.mouseEnterStream=new Se.a,this.mouseLeaveStream=new Se.a,this.subs=[]}return t.prototype.mouseEnter=function(t,e){this.mouseEnterStream.next({item:t,event:e})},t.prototype.mouseLeave=function(t){this.mouseLeaveStream.next(t)},t.prototype.ngAfterViewInit=function(){var t=this;this.subs.push(Object(q.a)(this.mouseEnterStream,this.mouseLeaveStream.pipe(Object(lt.a)(!1))).pipe(Object(I.a)(function(e){return e?t.handleMouseEnter(e):t.handleMouseOut()})).subscribe())},t.prototype.ngOnDestroy=function(){for(;this.subs.length;)this.subs.pop().unsubscribe()},t.prototype.handleMouseEnter=function(t){var e=t.event.target.getBoundingClientRect(),n=t.event.target.offsetParent.getBoundingClientRect();return this.state.set("CurrentLibraryPreview",{id:t.item.id,x:n.width+n.x,y:e.top,item:t.item}),Object(ot.b)()},t.prototype.handleMouseOut=function(){var t=this;return Object(Xe.a)(10).pipe(Object(d.a)(function(){Object(c.isEqual)(t.state.get("CurrentLibraryPreview"),{})||t.state.set("CurrentLibraryPreview",{})}))},t.prototype.handleDragStart=function(t,e){Object(c.isEqual)(this.state.get("CurrentLibraryPreview"),{})||this.state.set("CurrentLibraryPreview",{});var n=t.target.querySelector(".shape-thumbnail-image");t.dataTransfer.effectAllowed="move",t.dataTransfer.setData("Text",JSON.stringify(e)),t.dataTransfer.setDragImage(n,n.width/2,n.height/2)},t.prototype.createTemplateLibraryItem=function(t){return{id:t.defId,title:t.name,type:"template",data:t,thumbnailType:"image",thumbnailUrl:t.thumbnail}},t}(),Zi=n("fa4O"),Ki=function(t){function e(e,n,i){var r=t.call(this,i)||this;return r.loader=e,r.dataStore=n,r.state=i,r}return o.d(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this._id},set:function(t){var e=this;this._id=t;var n=this.loader.load(this._id).pipe(Object(Zi.a)());this.title=n.pipe(Object(T.a)(function(t){return t.name})),this.items=n.pipe(Object(T.a)(function(t){return t.defs.filter(function(t){return t.type!==l.l.Connector}).map(function(t){return e.createLibraryItem(t)})}))},enumerable:!0,configurable:!0}),e.prototype.createLibraryItem=function(t){return"template"===t.type?this.createTemplateLibraryItem(t):this.createShapeLibraryItem(t)},e.prototype.createShapeLibraryItem=function(t){return{id:t.defId,title:t.name,type:"shape",data:t,thumbnailType:"canvas",canvasIdPrefix:"thumb"}},e}(Xi),zi=function(){function t(t,e){this.state=t,this.modalController=e,this.defaultLibraryId="flowchart",this.subs=[]}return t.prototype.ngOnInit=function(){var t=this;this.state.changes("CurrentLibraries").pipe(Object(h.a)(1)).subscribe(function(e){return t.updateMenu(e,e.find(function(e){return e.id===t.defaultLibraryId}))});var e=this.state.changes("CurrentLibraries").pipe(Object(Ve.a)(1)).subscribe(function(e){return t.updateMenu(e)}),n=this.onChildRemoved().subscribe();this.subs.push(e),this.subs.push(n)},t.prototype.onChildRemoved=function(){var t=this;return this.collapsbileMenu.childRemoved.pipe(Object(de.a)(1),Object(d.a)(function(e){s.bb.track("left.library.section.header.close",{value1Type:"libraryId",value1:e});var n=t.state.get("CurrentLibraries").filter(function(t){return t.id!==e});t.state.set("CurrentLibraries",n)}))},t.prototype.updateMenu=function(t,e){this.addLibrariesToMenu(t,e),this.removeLibrariesFromMenu(t)},t.prototype.addLibrariesToMenu=function(t,e){var n=this;if(t.length<=0)return Object(ot.b)();var i=[];t.forEach(function(t){n.collapsbileMenu.has(t.id)||t.type===Re.b.Static&&i.push(n.collapsbileMenu.add(Ki,{id:t.id}))})},t.prototype.removeLibrariesFromMenu=function(t){var e=this;this.collapsbileMenu.panels.forEach(function(n){t.find(function(t){return t.id===n.id})||e.collapsbileMenu.detachById(n.id).subscribe()})},t.prototype.openLibBrowser=function(){this.modalController.show(Ci.a)},t.prototype.ngOnDestroy=function(){for(;this.subs.length>0;)this.subs.pop().unsubscribe()},t}(),qi=[[".lib-container[_ngcontent-%COMP%]{height:100vh}.lib-container[_ngcontent-%COMP%]  .ps--active-y .ps-content{width:calc(100% - 10px)}.lib-shapes[_ngcontent-%COMP%]{height:calc(100% - 135px)}.left-bar-message[_ngcontent-%COMP%]{display:none}.lib-get-more-btn[_ngcontent-%COMP%]{margin-top:5px}.lib-padding[_ngcontent-%COMP%]{padding-left:10px;padding-right:10px}"]],Wi=i.Db({encapsulation:0,styles:qi,data:{}});function Ji(t){return i.Zb(2,[i.Vb(402653184,1,{collapsbileMenu:0}),(t()(),i.Fb(1,0,null,null,20,"div",[["class","lib-container"]],null,null,null,null,null)),(t()(),i.Fb(2,0,null,null,2,"div",[["class","lib-search lib-padding"]],null,null,null,null,null)),(t()(),i.Fb(3,0,null,null,1,"shape-search-sidebar-input-list-dropdown",[],null,null,null,Ti,Ii)),i.Eb(4,180224,null,0,Pi,[wi.a,Ei.a],null,null),(t()(),i.Fb(5,0,null,null,2,"div",[["class","lib-insert-btn-section lib-padding"]],null,null,null,null,null)),(t()(),i.Fb(6,0,null,null,1,"insert-buttons-container",[],null,null,null,Li,ki)),i.Eb(7,49152,null,0,Di,[Ei.a],null,null),(t()(),i.Fb(8,0,null,null,4,"div",[["class","lib-shapes"]],null,null,null,null,null)),(t()(),i.Fb(9,0,null,null,3,"perfect-scrollbar",[["class","col-menu-scrollbar"]],[[2,"ps-show-limits",null],[2,"ps-show-active",null]],null,null,Fi.b,Fi.a)),i.Eb(10,507904,null,0,Hi.b,[i.H,i.i,i.K],null,null),(t()(),i.Fb(11,0,null,0,1,"collapsible-menu",[],null,null,null,_i,Ni)),i.Eb(12,180224,[[1,4]],0,Ri.a,[i.l,i.x],null,null),(t()(),i.Fb(13,0,null,null,2,"p",[["class","left-bar-message grey"],["translate",""]],null,null,null,null,null)),i.Eb(14,8536064,null,0,ti.e,[ti.k,i.o,i.i],{translate:[0,"translate"]},null),(t()(),i.Xb(-1,null,["LABELS.YOU_HAVE_NOT_ADDED_ANY_SHAPES"])),(t()(),i.Fb(16,0,null,null,5,"div",[["class","lib-get-more-btn lib-padding"]],null,null,null,null,null)),(t()(),i.Fb(17,0,null,null,4,"button",[["class","nu-btn-med fx-span-width secondary fx-no-margin fx-no-padding"],["translate",""]],null,[[null,"click"]],function(t,e,n){var r=!0,o=t.component;"click"===e&&(r=!1!==i.Pb(t,18).onClick(n)&&r);"click"===e&&(r=!1!==o.openLibBrowser()&&r);return r},null,null)),i.Eb(18,16384,null,0,ii.a,[],{trackAction:[0,"trackAction"]},null),i.Sb(19,{event:0}),i.Eb(20,8536064,null,0,ti.e,[ti.k,i.o,i.i],{translate:[0,"translate"]},null),(t()(),i.Xb(-1,null,[" BUTTONS.BROWSE_MORE_LIBS "]))],function(t,e){t(e,10,0);t(e,14,0,"");var n=t(e,19,0,"left.browseShapes.button.click");t(e,18,0,n);t(e,20,0,"")},function(t,e){t(e,9,0,i.Pb(e,10).autoPropagation,i.Pb(e,10).scrollIndicators)})}i.Bb("library-container",zi,function(t){return i.Zb(0,[(t()(),i.Fb(0,0,null,null,1,"library-container",[],null,null,null,Ji,Wi)),i.Eb(1,245760,null,0,zi,[Ei.a,wi.a],null,null)],function(t,e){t(e,1,0)},null)},{},{},[]);var Qi=function(){function t(t){var e=this;this.state=t,this.hasOpenLibraries=new Be.a(!1),this.subs=this.state.changes("CurrentLibraries").pipe(Object(T.a)(function(t){return t&&t.length>0}),Object(A.a)()).subscribe(function(t){e.hasOpenLibraries.next(t)})}return t.prototype.ngOnDestroy=function(){this.subs.unsubscribe()},t.prototype.mouseLeave=function(){this.state.get("CurrentLibraryPreview")!=={}&&this.state.set("CurrentLibraryPreview",{})},t}(),$i=[[".left-bar-container[_ngcontent-%COMP%]{width:215px}.left-bar-container.no-libraries[_ngcontent-%COMP%]  .lib-shapes{height:0}.left-bar-container.no-libraries[_ngcontent-%COMP%]  .left-bar-message{display:block;padding:10px 10px 0}"]],tr=i.Db({encapsulation:0,styles:$i,data:{}});function er(t){return i.Zb(2,[(t()(),i.Fb(0,0,null,null,4,"div",[["class","left-bar-container fx-span-height-100vh fx-pointer-events-auto white"]],[[2,"no-libraries",null]],[[null,"mouseleave"]],function(t,e,n){var i=!0,r=t.component;"mouseleave"===e&&(i=!1!==r.mouseLeave()&&i);return i},null,null)),i.Rb(131072,ri.b,[i.i]),(t()(),i.Fb(2,0,null,null,2,"div",[["class","left-bar-lib"]],null,null,null,null,null)),(t()(),i.Fb(3,0,null,null,1,"library-container",[],null,null,null,Ji,Wi)),i.Eb(4,245760,null,0,zi,[Ei.a,wi.a],null,null)],function(t,e){t(e,4,0)},function(t,e){var n=e.component;t(e,0,0,!i.Yb(e,0,0,i.Pb(e,1).transform(n.hasOpenLibraries)))})}i.Bb("left-bar",Qi,function(t){return i.Zb(0,[(t()(),i.Fb(0,0,null,null,1,"left-bar",[],null,null,null,er,tr)),i.Eb(1,180224,null,0,Qi,[Ei.a],null,null)],null,null)},{},{},[]);var nr=n("o+Mh"),ir=function(){function t(t,e,n){this.modalController=t,this.translate=e,this.commandService=n}return t.prototype.openImportImageWindow=function(){var t=this,e={note:this.translate.instant("FILE_IMPORTS.FILE_MAX_MSG")};this.modalController.show(nr.a,{inputs:{importOptions:{allowMultipleUploads:!1,restrictions:{maxFileSize:2e6,maxNumberOfFiles:1,minNumberOfFiles:1,allowedFileTypes:[".jpg",".jpeg",".bmp",".gif",".ico",".svg",".png"]}},uiOptions:e,onComplete:function(e){return t.onImageUploadCompletion(e)}}})},t.prototype.onImageUploadCompletion=function(t){this.commandService.dispatch(R.a.importImage,void 0,{files:t})},t}(),rr=n("2Lc/"),or=[[".left-sidebar-panel[_ngcontent-%COMP%]{padding-left:10px;padding-right:10px;padding-top:10px}"]],ar=i.Db({encapsulation:0,styles:or,data:{}});function sr(t){return i.Zb(2,[(t()(),i.Fb(0,0,null,null,8,"div",[["class","left-sidebar-panel"]],null,null,null,null,null)),(t()(),i.Fb(1,0,null,null,4,"button",[["class","nu-btn-med primary fx-span-width fx-no-padding fx-no-margin"],["translate",""]],null,[[null,"click"]],function(t,e,n){var r=!0,o=t.component;"click"===e&&(r=!1!==i.Pb(t,2).onClick(n)&&r);"click"===e&&(r=!1!==o.openImportImageWindow()&&r);return r},null,null)),i.Eb(2,16384,null,0,ii.a,[],{trackAction:[0,"trackAction"]},null),i.Sb(3,{event:0}),i.Eb(4,8536064,null,0,ti.e,[ti.k,i.o,i.i],{translate:[0,"translate"]},null),(t()(),i.Xb(-1,null,[" BUTTONS.IMPORT_IMAGE "])),(t()(),i.Fb(6,0,null,null,2,"p",[["class","grey fx-margin-top-10"],["translate",""]],null,null,null,null,null)),i.Eb(7,8536064,null,0,ti.e,[ti.k,i.o,i.i],{translate:[0,"translate"]},null),(t()(),i.Xb(-1,null,["FILE_IMPORTS.FILE_MAX_MSG"]))],function(t,e){var n=t(e,3,0,"left.toolbar.import.click");t(e,2,0,n);t(e,4,0,"");t(e,7,0,"")},null)}i.Bb("image-import-panel",ir,function(t){return i.Zb(0,[(t()(),i.Fb(0,0,null,null,1,"image-import-panel",[],null,null,null,sr,ar)),i.Eb(1,49152,null,0,ir,[wi.a,ti.k,rr.a],null,null)],null,null)},{},{},[]);var lr=["library-tile[_ngcontent-%COMP%]{width:25%;display:inline-block;text-align:center;margin-bottom:15px}"],cr=function(){return function(){}}(),ur=[[".thumbnail-loader-container[_ngcontent-%COMP%]{width:100%;height:40px;text-align:center}"]],pr=i.Db({encapsulation:0,styles:ur,data:{}});function hr(t){return i.Zb(2,[(t()(),i.Fb(0,0,null,null,4,"div",[["class","thumbnail-loader-container white"]],null,null,null,null,null)),(t()(),i.Fb(1,0,null,null,3,":svg:svg",[["viewBox","0 0 50 40"],["xmlns","http://www.w3.org/2000/svg"]],null,null,null,null,null)),(t()(),i.Fb(2,0,null,null,0,":svg:polygon",[["points","12.06 17.32 9.96 17.32 9.96 4.98 29.78 4.98 29.78 17.2 27.68 17.2 27.68 7.08 12.06 7.08 12.06 17.32"],["style","fill:#f1f0f0"]],null,null,null,null,null)),(t()(),i.Fb(3,0,null,null,0,":svg:polygon",[["points","44.13 28.92 24.64 28.92 24.64 26.82 40.5 26.82 32.45 12.89 25.72 24.55 23.91 23.5 32.45 8.7 44.13 28.92"],["style","fill:#f1f0f0"]],null,null,null,null,null)),(t()(),i.Fb(4,0,null,null,0,":svg:path",[["d","M15.78,35a9.91,9.91,0,1,1,9.91-9.91A9.92,9.92,0,0,1,15.78,35Zm0-17.72a7.82,7.82,0,1,0,7.82,7.81A7.81,7.81,0,0,0,15.78,17.3Z"],["style","fill:#f1f0f0"]],null,null,null,null,null))],null,null)}i.Bb("shape-thumbnail-loader",cr,function(t){return i.Zb(0,[(t()(),i.Fb(0,0,null,null,1,"shape-thumbnail-loader",[],null,null,null,hr,pr)),i.Eb(1,49152,null,0,cr,[],null,null)],null,null)},{},{},[]);var dr=function(){function t(){this.isPreview=!1,this.loading=new Be.a(!0)}return t.prototype.imageLoaded=function(){this.loading.next(!1)},t}(),fr=[[".thumb-img-container[_ngcontent-%COMP%]{position:relative}.thumb-img-container.loading[_ngcontent-%COMP%]   .thumb-img-loader-container[_ngcontent-%COMP%]{display:block}.thumb-img-container[_ngcontent-%COMP%]   .thumb-img-image-container.preview[_ngcontent-%COMP%]   img[_ngcontent-%COMP%], .thumb-img-container.loading[_ngcontent-%COMP%]   .thumb-img-image-container[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-width:80px;max-height:80px}.thumb-img-container[_ngcontent-%COMP%]   .thumb-img-image-container[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-width:40px;max-height:40px}.thumb-img-image-container[_ngcontent-%COMP%], .thumb-img-loader-container[_ngcontent-%COMP%]{width:100%;height:40px}.thumb-img-loader-container[_ngcontent-%COMP%]{position:absolute;top:0;left:0;display:none}"]],br=i.Db({encapsulation:0,styles:fr,data:{}});function gr(t){return i.Zb(2,[(t()(),i.Fb(0,0,null,null,6,"div",[["class","thumb-img-container fx-center-all"]],[[2,"loading",null]],null,null,null,null)),i.Rb(131072,ri.b,[i.i]),(t()(),i.Fb(2,0,null,null,2,"div",[["class","thumb-img-loader-container white"]],null,null,null,null,null)),(t()(),i.Fb(3,0,null,null,1,"shape-thumbnail-loader",[],null,null,null,hr,pr)),i.Eb(4,49152,null,0,cr,[],null,null),(t()(),i.Fb(5,0,null,null,1,"div",[["class","thumb-img-image-container fx-center-all"]],[[2,"preview",null]],null,null,null,null)),(t()(),i.Fb(6,0,[["thumbnail",1]],null,0,"img",[["draggable","false"]],[[8,"src",4]],[[null,"load"]],function(t,e,n){var i=!0,r=t.component;"load"===e&&(i=!1!==r.imageLoaded()&&i);return i},null,null))],null,function(t,e){var n=e.component;t(e,0,0,i.Yb(e,0,0,i.Pb(e,1).transform(n.loading))),t(e,5,0,n.isPreview),t(e,6,0,n.url)})}i.Bb("thumbnail-image",dr,function(t){return i.Zb(0,[(t()(),i.Fb(0,0,null,null,1,"thumbnail-image",[],null,null,null,gr,br)),i.Eb(1,49152,null,0,dr,[],null,null)],null,null)},{url:"url",isPreview:"isPreview"},{},[]);var vr=function(t){function e(e){var n=t.call(this,e)||this;return n._zoom=1,n}return o.d(e,t),e.prototype.destroy=function(){this.canvas=null,this._eventListeners=null},e.prototype.setupStage=function(){this.snapToPixelEnabled=!0,this.updateCanvasSize()},e.prototype.updateCanvasSize=function(){var t=this.canvas,e=t.width!==t.offsetWidth*window.devicePixelRatio,n=t.height!==t.offsetHeight*window.devicePixelRatio;(e||n)&&(e&&(t.width=t.offsetWidth*window.devicePixelRatio),n&&(t.height=t.offsetHeight*window.devicePixelRatio),this.setCanvasScale(),this.update())},e.prototype.setCanvasScale=function(){this.scaleX=window.devicePixelRatio*this._zoom,this.scaleY=window.devicePixelRatio*this._zoom},e}(rt.Stage),yr=function(){function t(t){this.rendered=t,this.isPreview=!1,this.canvasIdPrefix="thumb",this.loading=new Be.a(!0),this.focusSubject=new Be.a(!1),this.subs=[]}return Object.defineProperty(t.prototype,"canvasId",{get:function(){return this.canvasIdPrefix+"-"+this.defId+"-"+this.version},enumerable:!0,configurable:!0}),t.prototype.ngAfterViewInit=function(){var t=this;this.canvas=new vr(this.canvasId),this.canvas.setupStage(),this.canvas.preventSelection=!1,this.canvas.enableDOMEvents(!1),this.thumbnail=new rt.Shape,this.canvas.addChild(this.thumbnail),this.focusSubject.next(this.focus),this.subs.push(this.focusSubject.pipe(Object(I.a)(function(e){return t.draw(e).pipe(Object(d.a)({complete:function(){return t.loading.next(!1)}}))})).subscribe())},t.prototype.ngOnChanges=function(t){(t.focus&&!t.focus.firstChange||t.defId&&!t.defId.firstChange)&&this.focusSubject.next(this.focus)},t.prototype.ngOnDestroy=function(){for(this.canvas&&this.canvas.destroy();this.subs.length;)this.subs.pop().unsubscribe()},t.prototype.draw=function(t){var e=this;void 0===t&&(t=!1);var n=this.thumbnail.graphics,i=new s.R(5,5,70,70),r=this.getStyles();return t&&(r.lineColor=$e.a.primarySelectionColor),this.isPreview||(r.lineThickness=1.6*r.lineThickness),n.clear(),n.beginStroke(r.lineColor),n.setStrokeStyle(r.lineThickness),n.beginFill(r.fillColor),this.rendered.renderThumbnail(n,this.defId,this.version,i).pipe(Object(d.a)({complete:function(){n.endFill(),n.endStroke(),e.canvas.update()}}))},t.prototype.getStyles=function(){return this.style||(this.style={}),Object(c.merge)({fillStyle:l.d.Solid,fillColor:$e.a.defaultShapeFillColor,fillAlpha:1,lineAlpha:1,lineColor:$e.a.defaultShapeThumbnailLineColor,lineThickness:$e.a.defaultShapeLineThickness},this.style)},t}(),mr=n("UHsG"),Or=[[".thumb-img-container[_ngcontent-%COMP%]{position:relative}.thumb-img-container.loading[_ngcontent-%COMP%]   .thumb-img-loader-container[_ngcontent-%COMP%]{display:block}.thumb-img-container[_ngcontent-%COMP%]   .thumb-img-canvas-container.preview[_ngcontent-%COMP%]   canvas[_ngcontent-%COMP%], .thumb-img-container.loading[_ngcontent-%COMP%]   .thumb-img-canvas-container[_ngcontent-%COMP%]   canvas[_ngcontent-%COMP%]{width:80px;height:80px}.thumb-img-container[_ngcontent-%COMP%]   .thumb-img-canvas-container[_ngcontent-%COMP%]   canvas[_ngcontent-%COMP%]{width:40px;height:40px}.thumb-img-canvas-container[_ngcontent-%COMP%], .thumb-img-loader-container[_ngcontent-%COMP%]{width:100%;height:40px}.thumb-img-canvas-container.preview[_ngcontent-%COMP%]{height:auto}.thumb-img-loader-container[_ngcontent-%COMP%]{position:absolute;top:0;left:0;display:none}"]],Sr=i.Db({encapsulation:0,styles:Or,data:{}});function xr(t){return i.Zb(2,[(t()(),i.Fb(0,0,null,null,6,"div",[["class","thumb-img-container fx-center-all"],["mouseenter",""]],[[2,"loading",null]],null,null,null,null)),i.Rb(131072,ri.b,[i.i]),(t()(),i.Fb(2,0,null,null,2,"div",[["class","thumb-img-loader-container white"]],null,null,null,null,null)),(t()(),i.Fb(3,0,null,null,1,"shape-thumbnail-loader",[],null,null,null,hr,pr)),i.Eb(4,49152,null,0,cr,[],null,null),(t()(),i.Fb(5,0,null,null,1,"div",[["class","thumb-img-canvas-container"]],[[2,"preview",null]],null,null,null,null)),(t()(),i.Fb(6,0,null,null,0,"canvas",[],[[8,"id",0]],null,null,null,null))],null,function(t,e){var n=e.component;t(e,0,0,i.Yb(e,0,0,i.Pb(e,1).transform(n.loading))),t(e,5,0,n.isPreview),t(e,6,0,i.Hb(1,"",n.canvasId,""))})}i.Bb("thumbnail-canvas",yr,function(t){return i.Zb(0,[(t()(),i.Fb(0,0,null,null,1,"thumbnail-canvas",[],null,null,null,xr,Sr)),i.Eb(1,4898816,null,0,yr,[mr.a],null,null)],null,null)},{defId:"defId",version:"version",style:"style",focus:"focus",isPreview:"isPreview",canvasIdPrefix:"canvasIdPrefix"},{},[]);var Cr=function(){function t(){this.focused=new Be.a(!1),this.subs=[]}return t.prototype.ngAfterViewInit=function(){var t=this;this.subs.push(Object(q.a)(Object(u.a)(!1),Object(W.a)(this.libTileElem.nativeElement,"mouseenter").pipe(Object(lt.a)(!0)),Object(W.a)(this.libTileElem.nativeElement,"mouseleave").pipe(Object(lt.a)(!1))).subscribe(function(e){return t.focused.next(e)}))},t.prototype.ngOnDestroy=function(){for(;this.subs.length;)this.subs.pop().unsubscribe()},t}(),Pr=[[".lib-tile-container[_ngcontent-%COMP%]{color:#7e7e7e;cursor:pointer}"]],wr=i.Db({encapsulation:0,styles:Pr,data:{}});function Er(t){return i.Zb(0,[(t()(),i.Fb(0,0,null,null,1,"thumbnail-image",[["class","shape-thumbnail-image"]],null,null,null,gr,br)),i.Eb(1,49152,null,0,dr,[],{url:[0,"url"]},null)],function(t,e){t(e,1,0,e.component.item.thumbnailUrl)},null)}function jr(t){return i.Zb(0,[(t()(),i.Fb(0,0,null,null,2,"thumbnail-canvas",[["class","shape-thumbnail-image"]],null,null,null,xr,Sr)),i.Eb(1,4898816,null,0,yr,[mr.a],{defId:[0,"defId"],version:[1,"version"],style:[2,"style"],focus:[3,"focus"],canvasIdPrefix:[4,"canvasIdPrefix"]},null),i.Rb(131072,ri.b,[i.i])],function(t,e){var n=e.component;t(e,1,0,n.item.data.defId,n.item.data.version,n.item.data.style,i.Yb(e,1,3,i.Pb(e,2).transform(n.focused)),n.item.canvasIdPrefix)},null)}function Ir(t){return i.Zb(2,[i.Vb(402653184,1,{libTileElem:0}),(t()(),i.Fb(1,0,[[1,0],["libTileElem",1]],null,5,"div",[["class","lib-tile-container fx-ellipsis"],["draggable","true"]],null,null,null,null,null)),(t()(),i.wb(16777216,null,null,1,null,Er)),i.Eb(3,16384,null,0,ri.k,[i.db,i.Y],{ngIf:[0,"ngIf"]},null),(t()(),i.wb(16777216,null,null,1,null,jr)),i.Eb(5,16384,null,0,ri.k,[i.db,i.Y],{ngIf:[0,"ngIf"]},null),(t()(),i.Fb(6,0,null,null,0,"div",[],null,null,null,null,null))],function(t,e){var n=e.component;t(e,3,0,"image"===n.item.thumbnailType),t(e,5,0,"canvas"===n.item.thumbnailType)},null)}i.Bb("library-tile",Cr,function(t){return i.Zb(0,[(t()(),i.Fb(0,0,null,null,1,"library-tile",[],null,null,null,Ir,wr)),i.Eb(1,4374528,null,0,Cr,[],null,null)],null,null)},{item:"item",focused:"focused"},{},[]);var Tr=function(t){function e(e,n){var i=t.call(this,n)||this;return i.defLocator=e,i.state=n,i.items=i.state.changes("ShapeSearchResults").pipe(Object(I.a)(function(t){if(t){var n=t.filteredDefAndVersion.map(function(t){return e.getDefinition(t.defId,t.version)});return Je.a.apply(void 0,o.j(n)).pipe(Object(T.a)(function(t){return t.map(function(t){return i.createLibraryItem(t)})}))}return Object(Ze.b)()})),i}return o.d(e,t),e.prototype.createLibraryItem=function(t){return"template"===t.type?this.createTemplateLibraryItem(t):this.createShapeLibraryItem(t)},e.prototype.createShapeLibraryItem=function(t){return{id:t.defId,title:t.name,type:"shape",data:t,thumbnailType:"canvas",canvasIdPrefix:"thumb-search"}},e}(Xi),Mr=[lr],Dr=i.Db({encapsulation:0,styles:Mr,data:{}});function Ar(t){return i.Zb(0,[(t()(),i.Fb(0,0,null,null,1,"library-tile",[],null,[[null,"dragstart"],[null,"mouseenter"],[null,"mouseleave"]],function(t,e,n){var i=!0,r=t.component;"dragstart"===e&&(i=!1!==r.handleDragStart(n,t.context.$implicit.data)&&i);"mouseenter"===e&&(i=!1!==r.mouseEnter(t.context.$implicit,n)&&i);"mouseleave"===e&&(i=!1!==r.mouseLeave(n)&&i);return i},Ir,wr)),i.Eb(1,4374528,[["tile",4]],0,Cr,[],{item:[0,"item"]},null)],function(t,e){t(e,1,0,e.context.$implicit)},null)}function kr(t){return i.Zb(2,[(t()(),i.wb(16777216,null,null,2,null,Ar)),i.Eb(1,278528,null,0,ri.j,[i.db,i.Y,i.z],{ngForOf:[0,"ngForOf"]},null),i.Rb(131072,ri.b,[i.i])],function(t,e){var n=e.component;t(e,1,0,i.Yb(e,1,0,i.Pb(e,2).transform(n.items)))},null)}i.Bb("search-library-panel",Tr,function(t){return i.Zb(0,[(t()(),i.Fb(0,0,null,null,1,"search-library-panel",[],null,null,null,kr,Dr)),i.Eb(1,4374528,null,0,Tr,[Gi.a,Ei.a],null,null)],null,null)},{},{mouseEnterStream:"mouseEnterStream",mouseLeaveStream:"mouseLeaveStream"},[]);var Lr=function(){function t(t){this.state=t}return t.prototype.getShapeResultChanges=function(){return this.state.changes("ShapeSearchResults")},t}(),Fr=[[".lib-panel-search-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100vh}.lib-panel-search-results[_ngcontent-%COMP%]{flex:1;height:calc(100% - 57px);overflow:auto}.lib-panel-search-heading[_ngcontent-%COMP%]{padding-top:10px;margin-bottom:10px}.lib-panel-padding[_ngcontent-%COMP%], .lib-panel-search-scrollbar[_ngcontent-%COMP%]  .ps-content{padding-left:10px;padding-right:10px}"]],Hr=i.Db({encapsulation:0,styles:Fr,data:{}});function Rr(t){return i.Zb(0,[(t()(),i.Fb(0,0,null,null,16,"div",[["class","lib-panel-search-container"]],null,null,null,null,null)),(t()(),i.Fb(1,0,null,null,10,"div",[["class","lib-panel-search-heading lib-panel-padding"]],null,null,null,null,null)),(t()(),i.Fb(2,0,null,null,3,"div",[],null,null,null,null,null)),(t()(),i.Xb(3,null,["Search For ",""])),i.Rb(131072,ri.b,[i.i]),i.Rb(131072,ri.b,[i.i]),(t()(),i.Fb(6,0,null,null,5,"div",[["class","fx-margin-top-5"]],null,null,null,null,null)),(t()(),i.Fb(7,0,null,null,4,"label",[["class","grey nu-text-xsmall"]],null,null,null,null,null)),(t()(),i.Xb(8,null,[" Showing "," results "])),i.Rb(131072,ri.b,[i.i]),i.Rb(131072,ri.b,[i.i]),i.Rb(131072,ri.b,[i.i]),(t()(),i.Fb(12,0,null,null,4,"div",[["class","lib-panel-search-results"]],null,null,null,null,null)),(t()(),i.Fb(13,0,null,null,3,"perfect-scrollbar",[["class","lib-panel-search-scrollbar"]],[[2,"ps-show-limits",null],[2,"ps-show-active",null]],null,null,Fi.b,Fi.a)),i.Eb(14,507904,null,0,Hi.b,[i.H,i.i,i.K],null,null),(t()(),i.Fb(15,0,null,0,1,"search-library-panel",[],null,null,null,kr,Dr)),i.Eb(16,4374528,null,0,Tr,[Gi.a,Ei.a],null,null)],function(t,e){t(e,14,0)},function(t,e){var n=e.component;t(e,3,0,i.Yb(e,3,0,i.Pb(e,4).transform(n.getShapeResultChanges()))&&i.Yb(e,3,0,i.Pb(e,5).transform(n.getShapeResultChanges())).searchQuery),t(e,8,0,i.Yb(e,8,0,i.Pb(e,9).transform(n.getShapeResultChanges()))&&i.Yb(e,8,0,i.Pb(e,10).transform(n.getShapeResultChanges())).filteredDefAndVersion&&i.Yb(e,8,0,i.Pb(e,11).transform(n.getShapeResultChanges())).filteredDefAndVersion.length),t(e,13,0,i.Pb(e,14).autoPropagation,i.Pb(e,14).scrollIndicators)})}i.Bb("library-panel-shape-search",Lr,function(t){return i.Zb(0,[(t()(),i.Fb(0,0,null,null,1,"library-panel-shape-search",[],null,null,null,Rr,Hr)),i.Eb(1,49152,null,0,Lr,[Ei.a],null,null)],null,null)},{},{},[]);var Br=function(){function t(t){this.state=t,this.showPopover=new Be.a(!1),this.preparePopover=new Be.a(!1),this.libraryItemSubject=new Be.a(null),this.subs=[]}return t.prototype.ngOnInit=function(){var t=this;this.subs.push(this.preparePopover.pipe(Object(p.a)(function(t){return!!t}),Object(D.a)(0),Object(d.a)(function(e){var n=t.state.get("CurrentLibraryPreview");t.position(n.x,n.y),t.showPopover.next(!0)})).subscribe(),this.state.changes("CurrentLibraryPreview").subscribe(function(e){e&&Object.keys(e).length>0?(t.libraryItemSubject.next(e.item),t.title=e.item.title,t.prepare()):(t.showPopover.next(!1),t.preparePopover.next(!1))}))},t.prototype.prepare=function(){this.preparePopover.next(!0)},t.prototype.position=function(t,e){if(this.popoverOuter){var n=this.popoverOuter.nativeElement.getBoundingClientRect();n.height+e>=window.innerHeight?e=window.innerHeight-n.height-60:e<0?e=20:e-=75,this.popoverOuter.nativeElement.style.left=t+"px",this.popoverOuter.nativeElement.style.top=e+"px"}},t.prototype.ngOnDestroy=function(){for(;this.subs.length;)this.subs.pop().unsubscribe()},t}(),Nr=[[".lib-preview-container[_ngcontent-%COMP%]{position:absolute;border:1px solid #dcdcdc;opacity:0;transition:opacity .3s linear;background-color:#fff;z-index:2}.lib-preview-container[_ngcontent-%COMP%]   .lib-preview-tile-container[_ngcontent-%COMP%]{margin:auto;display:flex;flex-direction:column;width:200px;height:170px}.lib-preview-container[_ngcontent-%COMP%]   .lib-preview-thumbnail[_ngcontent-%COMP%]{flex:1}.lib-preview-container[_ngcontent-%COMP%]   .lib-preview-text[_ngcontent-%COMP%]{text-align:center;padding:10px 15px 15px;word-break:break-all;line-height:20px}.lib-preview-container.show[_ngcontent-%COMP%]{opacity:1}"]],_r=i.Db({encapsulation:0,styles:Nr,data:{}});function Gr(t){return i.Zb(0,[(t()(),i.Fb(0,0,null,null,2,"thumbnail-image",[["class","shape-thumbnail-image"]],null,null,null,gr,br)),i.Eb(1,49152,null,0,dr,[],{url:[0,"url"],isPreview:[1,"isPreview"]},null),i.Rb(131072,ri.b,[i.i])],function(t,e){var n=e.component;t(e,1,0,i.Yb(e,1,0,i.Pb(e,2).transform(n.libraryItemSubject)).thumbnailUrl,!0)},null)}function Vr(t){return i.Zb(0,[(t()(),i.Fb(0,0,null,null,4,"thumbnail-canvas",[["canvasIdPrefix","thumb-preview"],["class","shape-thumbnail-image"]],null,null,null,xr,Sr)),i.Eb(1,4898816,null,0,yr,[mr.a],{defId:[0,"defId"],version:[1,"version"],style:[2,"style"],focus:[3,"focus"],isPreview:[4,"isPreview"],canvasIdPrefix:[5,"canvasIdPrefix"]},null),i.Rb(131072,ri.b,[i.i]),i.Rb(131072,ri.b,[i.i]),i.Rb(131072,ri.b,[i.i])],function(t,e){var n=e.component;t(e,1,0,i.Yb(e,1,0,i.Pb(e,2).transform(n.libraryItemSubject)).data.defId,i.Yb(e,1,1,i.Pb(e,3).transform(n.libraryItemSubject)).data.version,i.Yb(e,1,2,i.Pb(e,4).transform(n.libraryItemSubject)).data.style,!1,!0,"thumb-preview")},null)}function Yr(t){return i.Zb(0,[(t()(),i.Fb(0,0,[[1,0],["popoverOuter",1]],null,13,"div",[["class","lib-preview-container"]],null,null,null,null,null)),i.Eb(1,278528,null,0,ri.i,[i.z,i.A,i.o,i.P],{klass:[0,"klass"],ngClass:[1,"ngClass"]},null),i.Rb(131072,ri.b,[i.i]),i.Sb(3,{show:0}),(t()(),i.Fb(4,0,null,null,9,"div",[["class","lib-preview-tile-container fx-ellipsis"]],null,null,null,null,null)),(t()(),i.Fb(5,0,null,null,6,"div",[["class","lib-preview-thumbnail fx-center-all"]],null,null,null,null,null)),(t()(),i.wb(16777216,null,null,2,null,Gr)),i.Eb(7,16384,null,0,ri.k,[i.db,i.Y],{ngIf:[0,"ngIf"]},null),i.Rb(131072,ri.b,[i.i]),(t()(),i.wb(16777216,null,null,2,null,Vr)),i.Eb(10,16384,null,0,ri.k,[i.db,i.Y],{ngIf:[0,"ngIf"]},null),i.Rb(131072,ri.b,[i.i]),(t()(),i.Fb(12,0,null,null,1,"div",[["class","lib-preview-text"]],null,null,null,null,null)),(t()(),i.Xb(13,null,[" "," "]))],function(t,e){var n=e.component,r=t(e,3,0,i.Yb(e,1,1,i.Pb(e,2).transform(n.showPopover)));t(e,1,0,"lib-preview-container",r),t(e,7,0,"image"===i.Yb(e,7,0,i.Pb(e,8).transform(n.libraryItemSubject)).thumbnailType),t(e,10,0,"canvas"===i.Yb(e,10,0,i.Pb(e,11).transform(n.libraryItemSubject)).thumbnailType)},function(t,e){t(e,13,0,e.component.title)})}function Ur(t){return i.Zb(2,[i.Vb(671088640,1,{popoverOuter:0}),(t()(),i.wb(16777216,null,null,2,null,Yr)),i.Eb(2,16384,null,0,ri.k,[i.db,i.Y],{ngIf:[0,"ngIf"]},null),i.Rb(131072,ri.b,[i.i])],function(t,e){var n=e.component;t(e,2,0,i.Yb(e,2,0,i.Pb(e,3).transform(n.preparePopover)))},null)}i.Bb("library-preview-popover",Br,function(t){return i.Zb(0,[(t()(),i.Fb(0,0,null,null,1,"library-preview-popover",[],null,null,null,Ur,_r)),i.Eb(1,245760,null,0,Br,[Ei.a],null,null)],function(t,e){t(e,1,0)},null)},{},{},[]);var Xr=[[".left-sidebar-container[_ngcontent-%COMP%]{height:100vh;width:265px;display:flex;border-right:1px solid #ececec}.left-sidebar-buttons-container[_ngcontent-%COMP%]{width:50px;height:inherit;background-color:#444b58}.left-sidebar-buttons-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{border-radius:0;width:100%;margin-top:5px;margin-bottom:5px;border-left:3px solid #444b58;opacity:.5}.left-sidebar-buttons-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{opacity:1}.left-sidebar-buttons-container[_ngcontent-%COMP%]   button.selected[_ngcontent-%COMP%]{border-left:3px solid #f6aa00;opacity:1}.left-sidebar-panels-container[_ngcontent-%COMP%]{width:215px;height:inherit;background-color:#fff}.left-sidebar-logo[_ngcontent-%COMP%]{width:100%;display:block;text-align:center}.left-sidebar-logo[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:45px}.left-sidebar-user[_ngcontent-%COMP%]{position:fixed;bottom:12px;width:50px}"]],Zr=i.Db({encapsulation:0,styles:Xr,data:{}});function Kr(t){return i.Zb(0,[(t()(),i.Fb(0,0,null,null,6,"button",[["class","left-sidebar-btns nu-btn-med nu-btn-icon fx-no-padding fx-no-margin"],["placement","right"],["tooltip",""]],[[8,"hidden",0],[2,"selected",null]],[[null,"click"]],function(t,e,n){var i=!0,r=t.component;"click"===e&&(i=!1!==r.selectedPanel.next(t.context.$implicit.id)&&i);return i},null,null)),i.Eb(1,81920,null,0,$n.a,[i.o],{placement:[0,"placement"]},null),(t()(),i.Fb(2,0,null,null,1,":svg:svg",[["class","nu-icon nu-ic-expand-thin white"]],null,null,null,null,null)),(t()(),i.Fb(3,0,null,null,0,":svg:use",[],[[1,":xlink:href",0]],null,null,null,null)),(t()(),i.Fb(4,0,null,null,2,"span",[["class","tooltip-content"],["translate",""]],null,null,null,null,null)),i.Eb(5,8536064,null,0,ti.e,[ti.k,i.o,i.i],{translate:[0,"translate"]},null),(t()(),i.Xb(6,null,["",""]))],function(t,e){t(e,1,0,"right");t(e,5,0,"")},function(t,e){var n=e.component;t(e,0,0,!e.context.$implicit.visible,n.selectedPanelId===e.context.$implicit.id),t(e,3,0,n.getIcon(e.context.$implicit.icon)),t(e,6,0,e.context.$implicit.tooltip)})}function zr(t){return i.Zb(0,[(t()(),i.Fb(0,0,null,null,7,"div",[["class","left-sidebar-user fx-center-all"],["placement","right"],["tooltip",""]],null,null,null,null,null)),i.Eb(1,81920,null,0,$n.a,[i.o],{placement:[0,"placement"]},null),(t()(),i.Fb(2,0,null,null,2,"a",[],null,[[null,"click"]],function(t,e,n){var i=!0,r=t.component;"click"===e&&(i=!1!==r.openUserProfile()&&i);return i},null,null)),(t()(),i.Fb(3,0,null,null,1,"user-image",[["imageSize","small"]],null,null,null,ei.b,ei.a)),i.Eb(4,49152,null,0,ni.a,[],{imageSize:[0,"imageSize"],hasImage:[1,"hasImage"],imagePath:[2,"imagePath"],userRegistered:[3,"userRegistered"],userColor:[4,"userColor"],userInitials:[5,"userInitials"],userOnlineStatus:[6,"userOnlineStatus"]},null),(t()(),i.Fb(5,0,null,null,2,"div",[["class","tooltip-content"]],null,null,null,null,null)),(t()(),i.Fb(6,0,null,null,1,"span",[],null,null,null,null,null)),(t()(),i.Xb(7,null,["",""]))],function(t,e){t(e,1,0,"right");t(e,4,0,"small",e.context.ngIf.hasImage,e.context.ngIf.image,e.context.ngIf.isRegistered,e.context.ngIf.displayColor,e.context.ngIf.initial,!0)},function(t,e){t(e,7,0,e.context.ngIf.fullName)})}function qr(t){return i.Zb(2,[(t()(),i.Fb(0,0,null,null,30,"div",[["class","left-sidebar-container fx-pointer-events-auto"]],null,null,null,null,null)),(t()(),i.Fb(1,0,null,null,15,"div",[["class","left-sidebar-buttons-container"]],null,null,null,null,null)),(t()(),i.Fb(2,0,null,null,8,"a",[["class","left-sidebar-logo fx-margin-top-10 fx-margin-bottom-5"],["placement","right"],["tooltip",""]],[[8,"href",4]],[[null,"click"]],function(t,e,n){var r=!0;"click"===e&&(r=!1!==i.Pb(t,4).onClick(n)&&r);return r},null,null)),i.Eb(3,81920,null,0,$n.a,[i.o],{placement:[0,"placement"]},null),i.Eb(4,16384,null,0,ii.a,[],{trackAction:[0,"trackAction"]},null),i.Sb(5,{event:0}),i.Rb(131072,ri.b,[i.i]),(t()(),i.Fb(7,0,null,null,0,"img",[["alt","Creately"],["src","./assets/images/bulb-on-dark-50X50.svg"]],null,null,null,null,null)),(t()(),i.Fb(8,0,null,null,2,"span",[["class","tooltip-content"],["translate",""]],null,null,null,null,null)),i.Eb(9,8536064,null,0,ti.e,[ti.k,i.o,i.i],{translate:[0,"translate"]},null),(t()(),i.Xb(-1,null,["TOOLTIPS.BACK_DIAGRAM"])),(t()(),i.wb(16777216,null,null,2,null,Kr)),i.Eb(12,278528,null,0,ri.j,[i.db,i.Y,i.z],{ngForOf:[0,"ngForOf"]},null),i.Rb(131072,ri.b,[i.i]),(t()(),i.wb(16777216,null,null,2,null,zr)),i.Eb(15,16384,null,0,ri.k,[i.db,i.Y],{ngIf:[0,"ngIf"]},null),i.Rb(131072,ri.b,[i.i]),(t()(),i.Fb(17,0,null,null,11,"div",[["class","left-sidebar-panels-container"]],null,null,null,null,null)),(t()(),i.Fb(18,0,null,null,2,"left-bar",[],[[2,"fx-hidden",null]],null,null,er,tr)),i.Eb(19,180224,null,0,Qi,[Ei.a],null,null),i.Rb(131072,ri.b,[i.i]),(t()(),i.Fb(21,0,null,null,1,"div",[],[[2,"fx-hidden",null]],null,null,null,null)),i.Rb(131072,ri.b,[i.i]),(t()(),i.Fb(23,0,null,null,2,"image-import-panel",[],[[2,"fx-hidden",null]],null,null,sr,ar)),i.Eb(24,49152,null,0,ir,[wi.a,ti.k,rr.a],null,null),i.Rb(131072,ri.b,[i.i]),(t()(),i.Fb(26,0,null,null,2,"library-panel-shape-search",[],[[2,"fx-hidden",null]],null,null,Rr,Hr)),i.Eb(27,49152,null,0,Lr,[Ei.a],null,null),i.Rb(131072,ri.b,[i.i]),(t()(),i.Fb(29,0,null,null,1,"library-preview-popover",[],null,null,null,Ur,_r)),i.Eb(30,245760,null,0,Br,[Ei.a],null,null)],function(t,e){var n=e.component;t(e,3,0,"right");var r=t(e,5,0,"header.left.logoButton.click");t(e,4,0,r);t(e,9,0,""),t(e,12,0,i.Yb(e,12,0,i.Pb(e,13).transform(n.buttons))),t(e,15,0,i.Yb(e,15,0,i.Pb(e,16).transform(n.userMdl))),t(e,30,0)},function(t,e){var n=e.component;t(e,2,0,i.Hb(1,"/manage/project/",i.Yb(e,2,0,i.Pb(e,6).transform(n.projectId)),"")),t(e,18,0,"shapes"!==i.Yb(e,18,0,i.Pb(e,20).transform(n.selectedPanel))),t(e,21,0,"folders"!==i.Yb(e,21,0,i.Pb(e,22).transform(n.selectedPanel))),t(e,23,0,"image-import"!==i.Yb(e,23,0,i.Pb(e,25).transform(n.selectedPanel))),t(e,26,0,"search"!==i.Yb(e,26,0,i.Pb(e,28).transform(n.selectedPanel)))})}var Wr=i.Bb("left-sidebar",Kn,function(t){return i.Zb(0,[(t()(),i.Fb(0,0,null,null,1,"left-sidebar",[],null,null,null,qr,Zr)),i.Eb(1,245760,null,0,Kn,[f.a,Zn.a,Ei.a],null,null)],function(t,e){t(e,1,0)},null)},{},{},[]),Jr=[[".text-editor[_ngcontent-%COMP%]:focus{outline:transparent solid 0}.text-editor[_ngcontent-%COMP%]{z-index:1;background-color:transparent;text-align:center;word-wrap:break-word;line-height:normal;overflow:hidden!important}.text-editor-container[_ngcontent-%COMP%]{position:absolute;cursor:text}.text-editor-bg[_ngcontent-%COMP%]{position:absolute;top:0;left:0}"]],Qr=i.Db({encapsulation:0,styles:Jr,data:{}});function $r(t){return i.Zb(2,[i.Vb(402653184,1,{container:0}),i.Vb(402653184,2,{editorBackground:0}),i.Vb(402653184,3,{editorElement:0}),(t()(),i.Fb(3,0,[[1,0],["container",1]],null,2,"div",[["class","text-editor-container"]],null,null,null,null,null)),(t()(),i.Fb(4,0,[[3,0],["editor",1]],null,0,"div",[["class","text-editor"],["id","shapetexteditor"]],null,null,null,null,null)),(t()(),i.Fb(5,0,[[2,0],["editorBackground",1]],null,0,"div",[["class","text-editor-bg"]],null,null,null,null,null))],null,null)}var to=i.Bb("shape-text-editor",Gn,function(t){return i.Zb(0,[(t()(),i.Fb(0,0,null,null,1,"shape-text-editor",[],null,null,null,$r,Qr)),i.Eb(1,4374528,null,0,Gn,[Te.a,ze.a,rr.a,f.a,Ei.a],null,null)],null,null)},{},{},[]),eo=n("1gc2"),no=[lr],io=i.Db({encapsulation:0,styles:no,data:{}});function ro(t){return i.Zb(0,[(t()(),i.Fb(0,0,null,null,1,"library-tile",[],null,[[null,"dragstart"],[null,"mouseenter"],[null,"mouseleave"]],function(t,e,n){var i=!0,r=t.component;"dragstart"===e&&(i=!1!==r.handleDragStart(n,t.context.$implicit.data)&&i);"mouseenter"===e&&(i=!1!==r.mouseEnter(t.context.$implicit,n)&&i);"mouseleave"===e&&(i=!1!==r.mouseLeave(n)&&i);return i},Ir,wr)),i.Eb(1,4374528,[["tile",4]],0,Cr,[],{item:[0,"item"]},null)],function(t,e){t(e,1,0,e.context.$implicit)},null)}function oo(t){return i.Zb(2,[(t()(),i.wb(16777216,null,null,2,null,ro)),i.Eb(1,278528,null,0,ri.j,[i.db,i.Y,i.z],{ngForOf:[0,"ngForOf"]},null),i.Rb(131072,ri.b,[i.i])],function(t,e){var n=e.component;t(e,1,0,i.Yb(e,1,0,i.Pb(e,2).transform(n.items)))},null)}var ao=i.Bb("ng-component",Ki,function(t){return i.Zb(0,[(t()(),i.Fb(0,0,null,null,1,"ng-component",[],null,null,null,oo,io)),i.Eb(1,4374528,null,0,Ki,[Ui,eo.a,Ei.a],null,null)],null,null)},{},{mouseEnterStream:"mouseEnterStream",mouseLeaveStream:"mouseLeaveStream"},[]),so=n("IfiR"),lo=n("EO1a"),co=n("JavN"),uo=n("hCs3"),po=n("981U"),ho=n("M2ad"),fo=n("fBq2"),bo=n("8mvU"),go=n("ciK7");n.d(e,"EditorModuleNgFactory",function(){return vo});var vo=i.Cb(Wn,[],function(t){return i.Mb([i.Nb(512,i.l,i.qb,[[8,[Jn.a,Qn.a,Wr,to,ao]],[3,i.l],i.F]),i.Nb(4608,ri.m,ri.l,[i.B,[2,ri.x]]),i.Nb(4608,so.j,so.j,[]),i.Nb(4608,Hn,Hn,[Ei.a,"GridService",g.a,i.x,S.a,y.a,f.a,ti.k]),i.Nb(4608,me,me,[rr.a,f.a,lo.a,Ei.a,eo.a,Pt.a,$.a,ye.a]),i.Nb(4608,pt,pt,[rr.a,f.a,lo.a,Ei.a,$.a]),i.Nb(4608,He,He,[rr.a,f.a,lo.a,Ei.a,$.a]),i.Nb(4608,An,An,[rr.a,$.a]),i.Nb(4608,Ui,Ui,[co.a,Gi.a,Yi.a]),i.Nb(4608,j.a,j.a,[i.x,rr.a,g.a,Ei.a,f.a,Te.a,ze.a]),i.Nb(4608,L,L,[i.x,rr.a,g.a,Ei.a,f.a,Te.a,ze.a]),i.Nb(4608,uo.a,uo.a,[eo.a,Ei.a]),i.Nb(1073742336,po.o,po.o,[[2,po.u],[2,po.m]]),i.Nb(1073742336,ri.c,ri.c,[]),i.Nb(1073742336,so.i,so.i,[]),i.Nb(1073742336,so.d,so.d,[]),i.Nb(1073742336,ho.b,ho.b,[]),i.Nb(1073742336,Hi.d,Hi.d,[]),i.Nb(1073742336,fo.b,fo.b,[]),i.Nb(1073742336,bo.c,bo.c,[]),i.Nb(1073742336,ti.h,ti.h,[]),i.Nb(512,Vn.a,Vn.a,[co.a]),i.Nb(1073742336,Wn,Wn,[go.a,Vn.a,Yn.a,r.a,Un.a,Xn.a,qn.a,zn.a]),i.Nb(256,Hi.a,fo.c,[]),i.Nb(1024,po.k,function(){return[[{path:"",resolve:[Hn],canDeactivate:[Hn],children:[{component:Kn,path:""},{outlet:"shape-text-editor",component:Gn,path:""}]}]]},[])])})}}]);